/*!
* Crafty v0.5.2
* http://craftyjs.com
*
* Copyright 2010, Louis Stowasser
* Dual licensed under the MIT or GPL licenses.
*/

/**@
* #Particles
* @category Graphics
* Based on Parcycle by Mr. Speaker, licensed under the MIT, Ported by Leo Koppelkamm
* **This is canvas only & won't do anything if the browser doesn't support it!**
* To see how this works take a look in https://github.com/craftyjs/Crafty/blob/master/src/particles.js
*/

/*!
		  * $script.js Async loader & dependency manager
		  * https://github.com/ded/script.js
		  * (c) Dustin Diaz, Jacob Thornton 2011
		  * License: MIT
		  */

/*
* Copyright (c) 2006-2007 Erin Catto http://www.gphysics.com
*
* This software is provided 'as-is', without any express or implied
* warranty.  In no event will the authors be held liable for any damages
* arising from the use of this software.
* Permission is granted to anyone to use this software for any purpose,
* including commercial applications, and to alter it and redistribute it
* freely, subject to the following restrictions:
* 1. The origin of this software must not be misrepresented; you must not
* claim that you wrote the original software. If you use this software
* in a product, an acknowledgment in the product documentation would be
* appreciated but is not required.
* 2. Altered source versions must be plainly marked as such, and must not be
* misrepresented as being the original software.
* 3. This notice may not be removed or altered from any source distribution.
*/

define("crafty",[],function(){var Crafty;return function(e,t,n){function E(){var e=i++;return e in o?E():e}function S(e){if(e===null||typeof e!="object")return e;var t=e.constructor();for(var n in e)t[n]=S(e[n]);return t}Crafty=function(e){return new Crafty.fn.init(e)};var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w=function(){i=1,r=50,a=1,s={},o={},u={},f={},d=[],b,v,p,l=0,c=1e3/r,h=(new Date).getTime(),y=Array.prototype.slice,m=/\s*,\s*/,g=/\s+/};w(),Crafty.fn=Crafty.prototype={init:function(e){if(typeof e!="string")return e||(e=0,e in o||(o[e]=this)),e in o?(this[0]=e,this.length=1,this.__c||(this.__c={}),o[e]||(o[e]=this),o[e]):(this.length=0,this);var t=0,n,r,i=!1,u=!1,a,f,l,c,h;if(e==="*"){for(n in o)this[+n]=o[n],t++;return this.length=t,this}e.indexOf(",")!==-1?(u=!0,a=m):e.indexOf(" ")!==-1&&(i=!0,a=g);for(n in o){if(!o.hasOwnProperty(n))continue;r=o[n];if(i||u){f=e.split(a),c=0,h=f.length,l=0;for(;c<h;c++)r.__c[f[c]]&&l++;if(i&&l===h||u&&l>0)this[t++]=+n}else r.__c[e]&&(this[t++]=+n)}t>0&&!i&&!u&&this.extend(s[e]);if(f&&i)for(c=0;c<h;c++)this.extend(s[f[c]]);return this.length=t,this},setName:function(e){var t=String(e);return this._entityName=t,this.trigger("NewEntityName",t),this},addComponent:function(e){var t=[],n=0,r,i=0,o,u;if(arguments.length>1){o=arguments.length;for(;i<o;i++)this.__c[arguments[i]]=!0,t.push(arguments[i])}else if(e.indexOf(",")!==-1){u=e.split(m),o=u.length;for(;i<o;i++)this.__c[u[i]]=!0,t.push(u[i])}else this.__c[e]=!0,t.push(e);r=t.length;for(;n<r;n++)comp=s[t[n]],this.extend(comp),comp&&"init"in comp&&comp.init.call(this);return this.trigger("NewComponent",r),this},toggleComponent:function(e){var t=0,n,r;if(arguments.length>1){n=arguments.length;for(;t<n;t++)this.has(arguments[t])?this.removeComponent(arguments[t]):this.addComponent(arguments[t])}else if(e.indexOf(",")!==-1){r=e.split(m),n=r.length;for(;t<n;t++)this.has(r[t])?this.removeComponent(r[t]):this.addComponent(r[t])}else this.has(e)?this.removeComponent(e):this.addComponent(e);return this},requires:function(e){var t=e.split(m),n=0,r=t.length,i;for(;n<r;++n)i=t[n],this.has(i)||this.addComponent(i);return this},removeComponent:function(e,t){if(t===!1){var n=s[e],r;for(r in n)delete this[r]}return delete this.__c[e],this.trigger("RemoveComponent",e),this},has:function(e){return!!this.__c[e]},attr:function(e,t){if(arguments.length===1)return typeof e=="string"?this[e]:(this.extend(e),this.trigger("Change",e),this);this[e]=t;var n={};return n[e]=t,this.trigger("Change",n),this},toArray:function(){return y.call(this,0)},timeout:function(e,t){return this.each(function(){var n=this;setTimeout(function(){e.call(n)},t)}),this},bind:function(e,t){if(this.length===1){f[e]||(f[e]={});var n=f[e];return n[this[0]]||(n[this[0]]=[]),n[this[0]].push(t),this}return this.each(function(){f[e]||(f[e]={});var n=f[e];n[this[0]]||(n[this[0]]=[]),n[this[0]].push(t)}),this},unbind:function(e,t){return this.each(function(){var n=f[e],r=0,i,s;if(!n||!n[this[0]])return this;i=n[this[0]].length;if(!t)return delete n[this[0]],this;for(;r<i;r++)s=n[this[0]],s[r]==t&&(s.splice(r,1),r--)}),this},trigger:function(e,t){if(this.length===1){if(f[e]&&f[e][this[0]]){var n=f[e][this[0]],r=0,i=n.length;for(;r<i;r++)n[r].call(this,t)}return this}return this.each(function(){if(f[e]&&f[e][this[0]]){var n=f[e][this[0]],r=0,i=n.length;for(;r<i;r++)n[r].call(this,t)}}),this},each:function(e){var t=0,n=this.length;for(;t<n;t++){if(!o[this[t]])continue;e.call(o[this[t]],t)}return this},clone:function(){var e=this.__c,t,n,r=Crafty.e();for(t in e)r.addComponent(t);for(n in this)n!="0"&&n!="_global"&&n!="_changed"&&typeof this[n]!="function"&&typeof this[n]!="object"&&(r[n]=this[n]);return r},setter:function(e,t){return Crafty.support.setter?this.__defineSetter__(e,t):Crafty.support.defineProperty?Object.defineProperty(this,e,{set:t,configurable:!0}):p.push({prop:e,obj:this,fn:t}),this},destroy:function(){this.each(function(){this.trigger("Remove");for(var e in f)this.unbind(e);delete o[this[0]]})}},Crafty.fn.init.prototype=Crafty.fn,Crafty.extend=Crafty.fn.extend=function(e){var t=this,n;if(!e)return t;for(n in e){if(t===e[n])continue;t[n]=e[n]}return t},Crafty.extend({init:function(e,t){return Crafty.viewport.init(e,t),this.trigger("Load"),this.timer.init(),this},getVersion:function(){return"0.5.2"},stop:function(n){this.timer.stop();if(n){if(Crafty.stage&&Crafty.stage.elem.parentNode){var r=document.createElement("div");r.id="cr-stage",Crafty.stage.elem.parentNode.replaceChild(r,Crafty.stage.elem)}w(),t(Crafty,e,e.document)}return Crafty.trigger("CraftyStop"),this},pause:function(e){return(arguments.length==1?e:!this._paused)?(this.trigger("Pause"),this._paused=!0,setTimeout(function(){Crafty.timer.stop()},0),Crafty.keydown={}):(this.trigger("Unpause"),this._paused=!1,setTimeout(function(){Crafty.timer.init()},0)),this},isPaused:function(){return this._paused},timer:{prev:+(new Date),current:+(new Date),currentTime:+(new Date),frames:0,frameTime:0,init:function(){var t=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||null;t?(b=function(){Crafty.timer.step(),v=t(b)},b()):b=setInterval(function(){Crafty.timer.step()},1e3/r)},stop:function(){Crafty.trigger("CraftyStopTimer"),typeof b=="number"&&clearInterval(b);var t=e.cancelRequestAnimationFrame||e.webkitCancelRequestAnimationFrame||e.mozCancelRequestAnimationFrame||e.oCancelRequestAnimationFrame||e.msCancelRequestAnimationFrame||null;t&&t(v),b=null},step:function(){l=0,this.currentTime=+(new Date),this.currentTime-h>60*c&&(h=this.currentTime-c);while(this.currentTime>h)Crafty.trigger("EnterFrame",{frame:a++}),h+=c,l++;l&&Crafty.DrawManager.draw(),this.currentTime>this.frameTime?(Crafty.trigger("MessureFPS",{value:this.frame}),this.frame=0,this.frameTime=this.currentTime+1e3):this.frame++},getFPS:function(){return r},simulateFrames:function(e){while(e-->0)Crafty.trigger("EnterFrame",{frame:a++});Crafty.DrawManager.draw()}},addEntityFactory:function(e,t){this.entityFactories[e]=t},newFactoryEntity:function(e){return this.entityTemplates[e]()},e:function(){var e=E(),t;return o[e]=null,o[e]=t=Crafty(e),arguments.length>0&&t.addComponent.apply(t,arguments),t.setName("Entity #"+e),t.addComponent("obj"),Crafty.trigger("NewEntity",{id:e}),t},c:function(e,t){s[e]=t},trigger:function(e,t){var n=f[e],r,i,s;for(r in n){if(!n.hasOwnProperty(r))continue;for(i=0,s=n[r].length;i<s;i++)n[r]&&n[r][i]&&(o[r]?n[r][i].call(Crafty(+r),t):n[r][i].call(Crafty,t))}},bind:function(e,t){f[e]||(f[e]={});var n=f[e];return n.global||(n.global=[]),n.global.push(t)-1},unbind:function(e,t){var n=f[e],r,i,s;for(r in n){if(!n.hasOwnProperty(r))continue;if(typeof t=="number")return delete n[r][t],!0;for(i=0,s=n[r].length;i<s;i++)if(n[r][i]===t)return delete n[r][i],!0}return!1},frame:function(){return a},components:function(){return s},isComp:function(e){return e in s},debug:function(){return o},settings:function(){var e={},t={};return{register:function(e,n){t[e]=n},modify:function(n,r){if(!t[n])return;t[n].call(e[n],r),e[n]=r},get:function(t){return e[t]}}}(),clone:S}),Crafty.bind("Load",function(){!Crafty.support.setter&&Crafty.support.defineProperty&&(p=[],Crafty.bind("EnterFrame",function(){var e=0,t=p.length,n;for(;e<t;++e)n=p[e],n.obj[n.prop]!==n.obj["_"+n.prop]&&n.fn.call(n.obj,n.obj[n.prop])}))}),t(Crafty,e,e.document)}(window,function(Crafty,window,document){function tweenEnterFrame(e){if(this._numProps<=0)return;var t,n;for(n in this._step)t=this._step[n],this[n]+=t.val,--t.rem==0&&(this[n]=t.prop,this.trigger("TweenEnd",n),this._step[n].rem<=0&&delete this._step[n],this._numProps--);if(this.has("Mouse")){var r=Crafty.over,i=Crafty.mousePos;r&&r[0]==this[0]&&!this.isAt(i.x,i.y)?(this.trigger("MouseOut",Crafty.lastEvent),Crafty.over=null):(!r||r[0]!=this[0])&&this.isAt(i.x,i.y)&&(Crafty.over=this,this.trigger("MouseOver",Crafty.lastEvent))}}(function(e){function i(e,t,n){this.keys=e,this.map=n,this.obj=t}var t,n=function(e){t=e||64,this.map={}},r=" ";n.prototype={insert:function(e){var t=n.key(e),s=new i(t,e,this),o=0,u,a;for(o=t.x1;o<=t.x2;o++)for(u=t.y1;u<=t.y2;u++)a=o+r+u,this.map[a]||(this.map[a]=[]),this.map[a].push(e);return s},search:function(e,t){var i=n.key(e),s,o,u,a=[];t===undefined&&(t=!0);for(s=i.x1;s<=i.x2;s++)for(o=i.y1;o<=i.y2;o++)u=s+r+o,this.map[u]&&(a=a.concat(this.map[u]));if(t){var f,c,h=[],p={};for(s=0,l=a.length;s<l;s++){f=a[s];if(!f)continue;c=f[0],!p[c]&&f.x<e._x+e._w&&f._x+f._w>e._x&&f.y<e._y+e._h&&f._h+f._y>e._y&&(p[c]=a[s])}for(f in p)h.push(p[f]);return h}return a},remove:function(e,t){var i=0,s,o;arguments.length==1&&(t=e,e=n.key(t));for(i=e.x1;i<=e.x2;i++)for(s=e.y1;s<=e.y2;s++){o=i+r+s;if(this.map[o]){var u=this.map[o],a,f=u.length;for(a=0;a<f;a++)u[a]&&u[a][0]===t[0]&&u.splice(a,1)}}},boundaries:function(){var e,t,n={max:{x:-Infinity,y:-Infinity},min:{x:Infinity,y:Infinity}},i={max:{x:-Infinity,y:-Infinity},min:{x:Infinity,y:Infinity}};for(var s in this.map){if(!this.map[s].length)continue;var o=s.split(r),u=o[0],a=o[0];if(u>=n.max.x){n.max.x=u;for(e in this.map[s])t=this.map[s][e],typeof t=="object"&&"requires"in t&&(i.max.x=Math.max(i.max.x,t.x+t.w))}if(u<=n.min.x){n.min.x=u;for(e in this.map[s])t=this.map[s][e],typeof t=="object"&&"requires"in t&&(i.min.x=Math.min(i.min.x,t.x))}if(a>=n.max.y){n.max.y=a;for(e in this.map[s])t=this.map[s][e],typeof t=="object"&&"requires"in t&&(i.max.y=Math.max(i.max.y,t.y+t.h))}if(a<=n.min.y){n.min.y=a;for(e in this.map[s])t=this.map[s][e],typeof t=="object"&&"requires"in t&&(i.min.y=Math.min(i.min.y,t.y))}}return i}},n.key=function(e){e.hasOwnProperty("mbr")&&(e=e.mbr());var n=Math.floor(e._x/t),r=Math.floor(e._y/t),i=Math.floor((e._w+e._x)/t),s=Math.floor((e._h+e._y)/t);return{x1:n,y1:r,x2:i,y2:s}},n.hash=function(e){return e.x1+r+e.y1+r+e.x2+r+e.y2},i.prototype={update:function(e){if(n.hash(n.key(e))!=n.hash(this.keys)){this.map.remove(this.keys,this.obj);var t=this.map.insert(this.obj);this.keys=t.keys}}},e.HashMap=n})(Crafty),Crafty.map=new Crafty.HashMap;var M=Math,Mc=M.cos,Ms=M.sin,PI=M.PI,DEG_TO_RAD=PI/180;Crafty.c("2D",{_x:0,_y:0,_w:0,_h:0,_z:0,_rotation:0,_alpha:1,_visible:!0,_globalZ:null,_origin:null,_mbr:null,_entry:null,_children:null,_parent:null,_changed:!1,_defineGetterSetter_setter:function(){this.__defineSetter__("x",function(e){this._attr("_x",e)}),this.__defineSetter__("y",function(e){this._attr("_y",e)}),this.__defineSetter__("w",function(e){this._attr("_w",e)}),this.__defineSetter__("h",function(e){this._attr("_h",e)}),this.__defineSetter__("z",function(e){this._attr("_z",e)}),this.__defineSetter__("rotation",function(e){this._attr("_rotation",e)}),this.__defineSetter__("alpha",function(e){this._attr("_alpha",e)}),this.__defineSetter__("visible",function(e){this._attr("_visible",e)}),this.__defineGetter__("x",function(){return this._x}),this.__defineGetter__("y",function(){return this._y}),this.__defineGetter__("w",function(){return this._w}),this.__defineGetter__("h",function(){return this._h}),this.__defineGetter__("z",function(){return this._z}),this.__defineGetter__("rotation",function(){return this._rotation}),this.__defineGetter__("alpha",function(){return this._alpha}),this.__defineGetter__("visible",function(){return this._visible}),this.__defineGetter__("parent",function(){return this._parent}),this.__defineGetter__("numChildren",function(){return this._children.length})},_defineGetterSetter_defineProperty:function(){Object.defineProperty(this,"x",{set:function(e){this._attr("_x",e)},get:function(){return this._x},configurable:!0}),Object.defineProperty(this,"y",{set:function(e){this._attr("_y",e)},get:function(){return this._y},configurable:!0}),Object.defineProperty(this,"w",{set:function(e){this._attr("_w",e)},get:function(){return this._w},configurable:!0}),Object.defineProperty(this,"h",{set:function(e){this._attr("_h",e)},get:function(){return this._h},configurable:!0}),Object.defineProperty(this,"z",{set:function(e){this._attr("_z",e)},get:function(){return this._z},configurable:!0}),Object.defineProperty(this,"rotation",{set:function(e){this._attr("_rotation",e)},get:function(){return this._rotation},configurable:!0}),Object.defineProperty(this,"alpha",{set:function(e){this._attr("_alpha",e)},get:function(){return this._alpha},configurable:!0}),Object.defineProperty(this,"visible",{set:function(e){this._attr("_visible",e)},get:function(){return this._visible},configurable:!0})},_defineGetterSetter_fallback:function(){this.x=this._x,this.y=this._y,this.w=this._w,this.h=this._h,this.z=this._z,this.rotation=this._rotation,this.alpha=this._alpha,this.visible=this._visible,this.bind("EnterFrame",function(){if(this.x!==this._x||this.y!==this._y||this.w!==this._w||this.h!==this._h||this.z!==this._z||this.rotation!==this._rotation||this.alpha!==this._alpha||this.visible!==this._visible){var e=this.mbr()||this.pos();if(this.rotation!==this._rotation)this._rotate(this.rotation);else{var t=this._mbr,n=!1;t&&(this.x!==this._x?(t._x-=this.x-this._x,n=!0):this.y!==this._y?(t._y-=this.y-this._y,n=!0):this.w!==this._w?(t._w-=this.w-this._w,n=!0):this.h!==this._h?(t._h-=this.h-this._h,n=!0):this.z!==this._z&&(t._z-=this.z-this._z,n=!0)),n&&this.trigger("Move",e)}this._x=this.x,this._y=this.y,this._w=this.w,this._h=this.h,this._z=this.z,this._rotation=this.rotation,this._alpha=this.alpha,this._visible=this.visible,this.trigger("Change",e),this.trigger("Move",e)}})},init:function(){this._globalZ=this[0],this._origin={x:0,y:0},this._children=[],Crafty.support.setter?this._defineGetterSetter_setter():Crafty.support.defineProperty?this._defineGetterSetter_defineProperty():this._defineGetterSetter_fallback(),this._entry=Crafty.map.insert(this),this.bind("Move",function(e){var t=this._mbr||this;this._entry.update(t),this._cascade(e)}),this.bind("Rotate",function(e){var t=this._mbr||this;this._entry.update(t),this._cascade(e)}),this.bind("Remove",function(){if(this._children){for(var e=0;e<this._children.length;e++)this._children[e].destroy&&this._children[e].destroy();this._children=[]}Crafty.map.remove(this),this.detach()})},_rotate:function(e){var t=-1*(e%360),n=t*DEG_TO_RAD,r=Math.cos(n),i=Math.sin(n),s={x:this._origin.x+this._x,y:this._origin.y+this._y};if(!t){this._mbr=null;if(!this._rotation%360)return}var o=s.x+(this._x-s.x)*r+(this._y-s.y)*i,u=s.y-(this._x-s.x)*i+(this._y-s.y)*r,a=s.x+(this._x+this._w-s.x)*r+(this._y-s.y)*i,f=s.y-(this._x+this._w-s.x)*i+(this._y-s.y)*r,l=s.x+(this._x+this._w-s.x)*r+(this._y+this._h-s.y)*i,c=s.y-(this._x+this._w-s.x)*i+(this._y+this._h-s.y)*r,h=s.x+(this._x-s.x)*r+(this._y+this._h-s.y)*i,p=s.y-(this._x-s.x)*i+(this._y+this._h-s.y)*r,d=Math.floor(Math.min(o,a,l,h)),v=Math.floor(Math.min(u,f,c,p)),m=Math.ceil(Math.max(o,a,l,h)),g=Math.ceil(Math.max(u,f,c,p));this._mbr={_x:d,_y:v,_w:m-d,_h:g-v};var y=this._rotation-e,b=y*DEG_TO_RAD;this.trigger("Rotate",{cos:Math.cos(b),sin:Math.sin(b),deg:y,rad:b,o:{x:s.x,y:s.y},matrix:{M11:r,M12:i,M21:-i,M22:r}})},area:function(){return this._w*this._h},intersect:function(e,t,n,r){var i,s=this._mbr||this;return typeof e=="object"?i=e:i={x:e,y:t,w:n,h:r},s._x<i.x+i.w&&s._x+s._w>i.x&&s._y<i.y+i.h&&s._h+s._y>i.y},within:function(e,t,n,r){var i;return typeof e=="object"?i=e:i={x:e,y:t,w:n,h:r},i.x<=this.x&&i.x+i.w>=this.x+this.w&&i.y<=this.y&&i.y+i.h>=this.y+this.h},contains:function(e,t,n,r){var i;return typeof e=="object"?i=e:i={x:e,y:t,w:n,h:r},i.x>=this.x&&i.x+i.w<=this.x+this.w&&i.y>=this.y&&i.y+i.h<=this.y+this.h},pos:function(){return{_x:this._x,_y:this._y,_w:this._w,_h:this._h}},mbr:function(){return this._mbr?{_x:this._mbr._x,_y:this._mbr._y,_w:this._mbr._w,_h:this._mbr._h}:this.pos()},isAt:function(e,t){return this.mapArea?this.mapArea.containsPoint(e,t):this.map?this.map.containsPoint(e,t):this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t},move:function(e,t){e.charAt(0)==="n"&&(this.y-=t),e.charAt(0)==="s"&&(this.y+=t);if(e==="e"||e.charAt(1)==="e")this.x+=t;if(e==="w"||e.charAt(1)==="w")this.x-=t;return this},shift:function(e,t,n,r){return e&&(this.x+=e),t&&(this.y+=t),n&&(this.w+=n),r&&(this.h+=r),this},_cascade:function(e){if(!e)return;var t=0,n=this._children,r=n.length,i;if(e.cos)for(;t<r;++t)i=n[t],"rotate"in i&&i.rotate(e);else{var s=this._mbr||this,o=s._x-e._x,u=s._y-e._y,a=s._w-e._w,f=s._h-e._h;for(;t<r;++t)i=n[t],i.shift(o,u,a,f)}},attach:function(){var e=0,t=arguments,n=arguments.length,r;for(;e<n;++e)r=t[e],r._parent&&r._parent.detach(r),r._parent=this,this._children.push(r);return this},detach:function(e){if(!e){for(var t=0;t<this._children.length;t++)this._children[t]._parent=null;return this._children=[],this}for(var t=0;t<this._children.length;t++)this._children[t]==e&&this._children.splice(t,1);return e._parent=null,this},origin:function(e,t){if(typeof e=="string")if(e==="centre"||e==="center"||e.indexOf(" ")===-1)e=this._w/2,t=this._h/2;else{var n=e.split(" ");if(n[0]==="top")t=0;else if(n[0]==="bottom")t=this._h;else if(n[0]==="middle"||n[1]==="center"||n[1]==="centre")t=this._h/2;n[1]==="center"||n[1]==="centre"||n[1]==="middle"?e=this._w/2:n[1]==="left"?e=0:n[1]==="right"&&(e=this._w)}return this._origin.x=e,this._origin.y=t,this},flip:function(e){e=e||"X",this["_flip"+e]||(this["_flip"+e]=!0,this.trigger("Change"))},unflip:function(e){e=e||"X",this["_flip"+e]&&(this["_flip"+e]=!1,this.trigger("Change"))},rotate:function(e){this._origin.x=e.o.x-this._x,this._origin.y=e.o.y-this._y,this._attr("_rotation",e.theta)},_attr:function(e,t){var n=this.pos(),r=this.mbr()||n;if(e==="_rotation")this._rotate(t),this.trigger("Rotate");else if(e==="_z")this._globalZ=parseInt(t+Crafty.zeroFill(this[0],5),10),this.trigger("reorder");else if(e=="_x"||e==="_y"||e==="_w"||e==="_h"){var i=this._mbr;i&&(i[e]-=this[e]-t),this[e]=t,this.trigger("Move",r)}this[e]=t,this.trigger("Change",r)}}),Crafty.c("Physics",{_gravity:.4,_friction:.2,_bounce:.5,gravity:function(e){this._gravity=e}}),Crafty.c("Gravity",{_gravityConst:.2,_gy:0,_falling:!0,_anti:null,init:function(){this.requires("2D")},gravity:function(e){return e&&(this._anti=e),this.bind("EnterFrame",this._enterFrame),this},gravityConst:function(e){return this._gravityConst=e,this},_enterFrame:function(){this._falling?(this._gy+=this._gravityConst,this.y+=this._gy):this._gy=0;var e,t=!1,n=this.pos(),r,i=0,s;n._y++,n.x=n._x,n.y=n._y,n.w=n._w,n.h=n._h,r=Crafty.map.search(n),s=r.length;for(;i<s;++i){e=r[i];if(e!==this&&e.has(this._anti)&&e.intersect(n)){t=e;break}}t?this._falling&&this.stopFalling(t):this._falling=!0},stopFalling:function(e){e&&(this.y=e._y-this._h),this._falling=!1,this._up&&(this._up=!1),this.trigger("hit")},antigravity:function(){this.unbind("EnterFrame",this._enterFrame)}}),Crafty.polygon=function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments,0)),this.points=e},Crafty.polygon.prototype={containsPoint:function(e,t){var n=this.points,r,i,s=!1;for(r=0,i=n.length-1;r<n.length;i=r++)n[r][1]>t!=n[i][1]>t&&e<(n[i][0]-n[r][0])*(t-n[r][1])/(n[i][1]-n[r][1])+n[r][0]&&(s=!s);return s},shift:function(e,t){var n=0,r=this.points.length,i;for(;n<r;n++)i=this.points[n],i[0]+=e,i[1]+=t},rotate:function(e){var t=0,n=this.points.length,r,i,s;for(;t<n;t++)r=this.points[t],i=e.o.x+(r[0]-e.o.x)*e.cos+(r[1]-e.o.y)*e.sin,s=e.o.y-(r[0]-e.o.x)*e.sin+(r[1]-e.o.y)*e.cos,r[0]=i,r[1]=s}},Crafty.circle=function(e,t,n){this.x=e,this.y=t,this.radius=n,this.points=[];var r;for(var i=0;i<8;i++)r=i*Math.PI/4,this.points[i]=[this.x+Math.sin(r)*n,this.y+Math.cos(r)*n]},Crafty.circle.prototype={containsPoint:function(e,t){var n=this.radius,r=Math.sqrt,i=this.x-e,s=this.y-t;return i*i+s*s<n*n},shift:function(e,t){this.x+=e,this.y+=t;var n=0,r=this.points.length,i;for(;n<r;n++)i=this.points[n],i[0]+=e,i[1]+=t},rotate:function(){}},Crafty.matrix=function(e){this.mtx=e,this.width=e[0].length,this.height=e.length},Crafty.matrix.prototype={x:function(e){if(this.width!=e.height)return;var t=[];for(var n=0;n<this.height;n++){t[n]=[];for(var r=0;r<e.width;r++){var i=0;for(var s=0;s<this.width;s++)i+=this.mtx[n][s]*e.mtx[s][r];t[n][r]=i}}return new Crafty.matrix(t)},e:function(e,t){return e<1||e>this.mtx.length||t<1||t>this.mtx[0].length?null:this.mtx[e-1][t-1]}},Crafty.c("Collision",{init:function(){this.requires("2D");var e=this._mbr||this;poly=new Crafty.polygon([0,0],[e._w,0],[e._w,e._h],[0,e._h]),this.map=poly,this.attach(this.map),this.map.shift(e._x,e._y)},collision:function(e){var t=this._mbr||this;e||(e=new Crafty.polygon([0,0],[t._w,0],[t._w,t._h],[0,t._h]));if(arguments.length>1){var n=Array.prototype.slice.call(arguments,0);e=new Crafty.polygon(n)}return this.map=e,this.attach(this.map),this.map.shift(t._x,t._y),this},hit:function(e){var t=this._mbr||this,n=Crafty.map.search(t,!1),r=0,i=n.length,s={},o,u,a,f,l="map"in this&&"containsPoint"in this.map,c=[];if(!i)return!1;for(;r<i;++r){u=n[r],a=u._mbr||u;if(!u)continue;o=u[0],!s[o]&&this[0]!==o&&u.__c[e]&&a._x<t._x+t._w&&a._x+a._w>t._x&&a._y<t._y+t._h&&a._h+a._y>t._y&&(s[o]=u)}for(f in s){u=s[f];if(l&&"map"in u){var h=this._SAT(this.map,u.map);h.obj=u,h.type="SAT",h&&c.push(h)}else c.push({obj:u,type:"MBR"})}return c.length?c:!1},onHit:function(e,t,n){var r=!1;return this.bind("EnterFrame",function(){var i=this.hit(e);i?(r=!0,t.call(this,i)):r&&(typeof n=="function"&&n.call(this),r=!1)}),this},_SAT:function(e,t){var n=e.points,r=t.points,i=0,s=n.length,o,u=r.length,a={x:0,y:0},f,l,c,h,p,d,v=null,m=null,g=null,y,b,w;for(;i<s;i++){b=n[i==s-1?0:i+1],w=n[i],a.x=-(b[1]-w[1]),a.y=b[0]-w[0],f=Math.sqrt(a.x*a.x+a.y*a.y),a.x/=f,a.y/=f,l=c=-1,h=p=-1;for(o=0;o<s;++o){y=n[o][0]*a.x+n[o][1]*a.y;if(y>h||h===-1)h=y;if(y<l||l===-1)l=y}for(o=0;o<u;++o){y=r[o][0]*a.x+r[o][1]*a.y;if(y>p||p===-1)p=y;if(y<c||c===-1)c=y}l<c?(d=c-h,a.x=-a.x,a.y=-a.y):d=l-p;if(d>=0)return!1;if(v===null||d>v)v=d,g={x:a.x,y:a.y}}for(i=0;i<u;i++){b=r[i==u-1?0:i+1],w=r[i],a.x=-(b[1]-w[1]),a.y=b[0]-w[0],f=Math.sqrt(a.x*a.x+a.y*a.y),a.x/=f,a.y/=f,l=c=-1,h=p=-1;for(o=0;o<s;++o){y=n[o][0]*a.x+n[o][1]*a.y;if(y>h||h===-1)h=y;if(y<l||l===-1)l=y}for(o=0;o<u;++o){y=r[o][0]*a.x+r[o][1]*a.y;if(y>p||p===-1)p=y;if(y<c||c===-1)c=y}l<c?(d=c-h,a.x=-a.x,a.y=-a.y):d=l-p;if(d>=0)return!1;if(v===null||d>v)v=d;if(d>m||m===null)m=d,g={x:a.x,y:a.y}}return{overlap:m,normal:g}}}),Crafty.c("WiredHitBox",{init:function(){if(Crafty.support.canvas){var e=document.getElementById("HitBox");e||(e=document.createElement("canvas"),e.id="HitBox",e.width=Crafty.viewport.width,e.height=Crafty.viewport.height,e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.zIndex="1000",Crafty.stage.elem.appendChild(e));var t=e.getContext("2d"),n=0,r=Crafty("WiredHitBox").length;this.requires("Collision").bind("EnterFrame",function(){n==r&&(t.clearRect(0,0,Crafty.viewport.width,Crafty.viewport.height),n=0),t.beginPath();for(var e in this.map.points)t.lineTo(Crafty.viewport.x+this.map.points[e][0],Crafty.viewport.y+this.map.points[e][1]);t.closePath(),t.stroke(),n++})}return this}}),Crafty.c("SolidHitBox",{init:function(){if(Crafty.support.canvas){var e=document.getElementById("HitBox");e||(e=document.createElement("canvas"),e.id="HitBox",e.width=Crafty.viewport.width,e.height=Crafty.viewport.height,e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.zIndex="1000",Crafty.stage.elem.appendChild(e));var t=e.getContext("2d"),n=0,r=Crafty("SolidHitBox").length;this.requires("Collision").bind("EnterFrame",function(){n==r&&(t.clearRect(0,0,Crafty.viewport.width,Crafty.viewport.height),n=0),t.beginPath();for(var e in this.map.points)t.lineTo(Crafty.viewport.x+this.map.points[e][0],Crafty.viewport.y+this.map.points[e][1]);t.closePath(),t.fill(),n++})}return this}}),Crafty.c("DOM",{_element:null,_cssStyles:null,init:function(){function e(){var e=0,t=this.__c,n="";for(e in t)n+=" "+e;n=n.substr(1),this._element.className=n}this._cssStyles={visibility:"",left:"",top:"",width:"",height:"",zIndex:"",opacity:"",transformOrigin:"",transform:""},this._element=document.createElement("div"),Crafty.stage.inner.appendChild(this._element),this._element.style.position="absolute",this._element.id="ent"+this[0],this.bind("Change",function(){this._changed||(this._changed=!0,Crafty.DrawManager.add(this))}),this.bind("NewComponent",e).bind("RemoveComponent",e),Crafty.support.prefix==="ms"&&Crafty.support.version<9&&(this._filters={},this.bind("Rotate",function(e){var t=e.matrix,n=this._element.style,r=t.M11.toFixed(8),i=t.M12.toFixed(8),s=t.M21.toFixed(8),o=t.M22.toFixed(8);this._filters.rotation="progid:DXImageTransform.Microsoft.Matrix(M11="+r+", M12="+i+", M21="+s+", M22="+o+",sizingMethod='auto expand')"})),this.bind("Remove",this.undraw),this.bind("RemoveComponent",function(e){e==="DOM"&&this.undraw()})},getDomId:function(){return this._element.id},DOM:function(e){return e&&e.nodeType&&(this.undraw(),this._element=e,this._element.style.position="absolute"),this},draw:function(){var e=this._element.style,t=this.__coord||[0,0,0,0],n={x:t[0],y:t[1]},r=Crafty.support.prefix,i=[];this._cssStyles.visibility!=this._visible&&(this._cssStyles.visibility=this._visible,this._visible?e.visibility="visible":e.visibility="hidden"),Crafty.support.css3dtransform?i.push("translate3d("+~~this._x+"px,"+~~this._y+"px,0)"):(this._cssStyles.left!=this._x&&(this._cssStyles.left=this._x,e.left=~~this._x+"px"),this._cssStyles.top!=this._y&&(this._cssStyles.top=this._y,e.top=~~this._y+"px")),this._cssStyles.width!=this._w&&(this._cssStyles.width=this._w,e.width=~~this._w+"px"),this._cssStyles.height!=this._h&&(this._cssStyles.height=this._h,e.height=~~this._h+"px"),this._cssStyles.zIndex!=this._z&&(this._cssStyles.zIndex=this._z,e.zIndex=this._z),this._cssStyles.opacity!=this._alpha&&(this._cssStyles.opacity=this._alpha,e.opacity=this._alpha,e[r+"Opacity"]=this._alpha),r==="ms"&&Crafty.support.version<9&&(Crafty.support.version===8?this._filters.alpha="progid:DXImageTransform.Microsoft.Alpha(Opacity="+this._alpha*100+")":this._filters.alpha="alpha(opacity="+this._alpha*100+")");if(this._mbr){var s=this._origin.x+"px "+this._origin.y+"px";e.transformOrigin=s,e[r+"TransformOrigin"]=s,Crafty.support.css3dtransform?i.push("rotateZ("+this._rotation+"deg)"):i.push("rotate("+this._rotation+"deg)")}return this._flipX&&(i.push("scaleX(-1)"),r==="ms"&&Crafty.support.version<9&&(this._filters.flipX="fliph")),this._flipY&&(i.push("scaleY(-1)"),r==="ms"&&Crafty.support.version<9&&(this._filters.flipY="flipv")),r==="ms"&&Crafty.support.version<9&&this.applyFilters(),this._cssStyles.transform!=i.join(" ")&&(this._cssStyles.transform=i.join(" "),e.transform=this._cssStyles.transform,e[r+"Transform"]=this._cssStyles.transform),this.trigger("Draw",{style:e,type:"DOM",co:n}),this},applyFilters:function(){this._element.style.filter="";var e="";for(var t in this._filters){if(!this._filters.hasOwnProperty(t))continue;e+=this._filters[t]+" "}this._element.style.filter=e},undraw:function(){return this._element&&Crafty.stage.inner.removeChild(this._element),this},css:function(e,t){var n,r=this._element,i,s=r.style;if(typeof e=="object")for(n in e){if(!e.hasOwnProperty(n))continue;i=e[n],typeof i=="number"&&(i+="px"),s[Crafty.DOM.camelize(n)]=i}else{if(!t)return Crafty.DOM.getStyle(r,e);typeof t=="number"&&(t+="px"),s[Crafty.DOM.camelize(e)]=t}return this.trigger("Change"),this}});try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e){}Crafty.extend({DOM:{window:{init:function(){this.width=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,this.height=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight},width:0,height:0},inner:function(e){var t=e.getBoundingClientRect(),n=t.left+(window.pageXOffset?window.pageXOffset:document.body.scrollLeft),r=t.top+(window.pageYOffset?window.pageYOffset:document.body.scrollTop),i=parseInt(this.getStyle(e,"border-left-width")||0,10)||parseInt(this.getStyle(e,"borderLeftWidth")||0,10)||0,s=parseInt(this.getStyle(e,"border-top-width")||0,10)||parseInt(this.getStyle(e,"borderTopWidth")||0,10)||0;return n+=i,r+=s,{x:n,y:r}},getStyle:function(e,t){var n;return e.currentStyle?n=e.currentStyle[this.camelize(t)]:window.getComputedStyle&&(n=document.defaultView.getComputedStyle(e,null).getPropertyValue(this.csselize(t))),n},camelize:function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},csselize:function(e){return e.replace(/[A-Z]/g,function(e){return e?"-"+e.toLowerCase():""})},translate:function(e,t){return{x:(e-Crafty.stage.x+document.body.scrollLeft+document.documentElement.scrollLeft-Crafty.viewport._x)/Crafty.viewport._zoom,y:(t-Crafty.stage.y+document.body.scrollTop+document.documentElement.scrollTop-Crafty.viewport._y)/Crafty.viewport._zoom}}}}),Crafty.c("HTML",{inner:"",init:function(){this.requires("2D, DOM")},replace:function(e){return this.inner=e,this._element.innerHTML=e,this},append:function(e){return this.inner+=e,this._element.innerHTML+=e,this},prepend:function(e){return this.inner=e+this.inner,this._element.innerHTML=e+this.inner,this}}),Crafty.storage=function(){function process(e){if(e.c){var t=Crafty.e(e.c).attr(e.attr).trigger("LoadData",e,process);return t}if(typeof e=="object")for(var n in e)e[n]=process(e[n]);return e}function unserialize(str){if(typeof str!="string")return null;var data=JSON?JSON.parse(str):eval("("+str+")");return process(data)}function prep(e){if(e.__c){var t={c:[],attr:{}};e.trigger("SaveData",t,prep);for(var n in e.__c)t.c.push(n);t.c=t.c.join(", "),e=t}else if(typeof e=="object")for(var r in e)e[r]=prep(e[r]);return e}function serialize(e){if(JSON){var t=prep(e);return JSON.stringify(t)}return alert("Crafty does not support saving on your browser. Please upgrade to a newer browser."),!1}function external(e){url=e}function openExternal(){if(typeof url=="undefined")return;var xml=new XMLHttpRequest;xhr.open("POST",url),xhr.onreadystatechange=function(evt){if(xhr.readyState==4&&xhr.status==200){var data=eval("("+xhr.responseText+")");for(var i in data)Crafty.storage.check(data[i].key,data[i].timestamp)&&loadExternal(data[i].key)}},xhr.send("mode=timestamps&game="+gameName)}function saveExternal(e,t,n){if(typeof url=="undefined")return;var r=new XMLHttpRequest;r.open("POST",url),r.send("mode=save&key="+e+"&data="+encodeURIComponent(t)+"&ts="+n+"&game="+gameName)}function loadExternal(key){if(typeof url=="undefined")return;var xhr=new XMLHttpRequest;xhr.open("POST",url),xhr.onreadystatechange=function(evt){if(xhr.readyState==4&&xhr.status==200){var data=eval("("+xhr.responseText+")");Crafty.storage.save(key,"save",data)}},xhr.send("mode=load&key="+key+"&game="+gameName)}function ts(){var e=new Date;return e.getTime()}var db=null,url,gameName,timestamps={},transactionType={READ:"readonly",READ_WRITE:"readwrite"};return typeof indexedDB!="object"&&(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction,typeof IDBTransaction=="object"&&(transactionType.READ=IDBTransaction.READ||IDBTransaction.readonly||transactionType.READ,transactionType.READ_WRITE=IDBTransaction.READ_WRITE||IDBTransaction.readwrite||transactionType.READ_WRITE)),typeof indexedDB=="object"?{open:function(e){function r(){try{var e=db.transaction(["save"],transactionType.READ),t=e.objectStore("save"),n=t.getAll();n.onsuccess=function(e){var t=0,n=event.target.result,r=n.length;for(;t<r;t++)timestamps[n[t].key]=n[t].timestamp}}catch(r){}}function i(){var e=db.setVersion("1.0");e.onsuccess=function(e){for(var n=0;n<t.length;n++){var r=t[n];if(db.objectStoreNames.contains(r))continue;db.createObjectStore(r,{keyPath:"key"})}}}gameName=e;var t=[];arguments.length==1?(t.push("save"),t.push("cache")):(t=arguments,t.shift(),t.push("save"),t.push("cache"));if(db==null){var n=indexedDB.open(gameName);n.onsuccess=function(e){db=e.target.result,i(),r(),openExternal()}}else i(),r(),openExternal()},save:function(e,t,n){if(db==null){setTimeout(function(){Crafty.storage.save(e,t,n)},1);return}var r=serialize(n),i=ts();t=="save"&&saveExternal(e,r,i);try{var s=db.transaction([t],transactionType.READ_WRITE),o=s.objectStore(t),u=o.put({data:r,timestamp:i,key:e})}catch(a){console.error(a)}},load:function(e,t,n){if(db==null){setTimeout(function(){Crafty.storage.load(e,t,n)},1);return}try{var r=db.transaction([t],transactionType.READ),i=r.objectStore(t),s=i.get(e);s.onsuccess=function(e){n(unserialize(e.target.result.data))}}catch(o){console.error(o)}},getAllKeys:function(e,t){db==null&&setTimeout(function(){Crafty.storage.getAllkeys(e,t)},1);try{var n=db.transaction([e],transactionType.READ),r=n.objectStore(e),i=r.getCursor(),s=[];i.onsuccess=function(e){var n=e.target.result;n?(s.push(n.key),n["continue"]()):t(s)}}catch(o){console.error(o)}},check:function(e,t){return timestamps[e]>t},external:external}:typeof openDatabase=="function"?{open:function(e){gameName=e;if(arguments.length==1)db={save:openDatabase(e+"_save","1.0","Saves games for "+e,5242880),cache:openDatabase(e+"_cache","1.0","Cache for "+e,5242880)};else{var t=arguments,n=0;t.shift();for(;n<t.length;n++)typeof db[t[n]]=="undefined"&&(db[t[n]]=openDatabase(gameName+"_"+t[n],"1.0",type,5242880))}db.save.transaction(function(e){e.executeSql("SELECT key, timestamp FROM data",[],function(e,t){var n=0,r=t.rows,i=r.length;for(;n<i;n++)timestamps[r.item(n).key]=r.item(n).timestamp})})},save:function(e,t,n){typeof db[t]=="undefined"&&gameName!=""&&this.open(gameName,t);var r=serialize(n),i=ts();t=="save"&&saveExternal(e,r,i),db[t].transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS data (key unique, text, timestamp)"),t.executeSql("SELECT * FROM data WHERE key = ?",[e],function(t,n){n.rows.length?t.executeSql("UPDATE data SET text = ?, timestamp = ? WHERE key = ?",[r,i,e]):t.executeSql("INSERT INTO data VALUES (?, ?, ?)",[e,r,i])})})},load:function(e,t,n){if(db[t]==null){setTimeout(function(){Crafty.storage.load(e,t,n)},1);return}db[t].transaction(function(t){t.executeSql("SELECT text FROM data WHERE key = ?",[e],function(e,t){t.rows.length&&(res=unserialize(t.rows.item(0).text),n(res))})})},getAllKeys:function(e,t){if(db[e]==null){setTimeout(function(){Crafty.storage.getAllKeys(e,t)},1);return}db[e].transaction(function(e){e.executeSql("SELECT key FROM data",[],function(e,n){t(n.rows)})})},check:function(e,t){return timestamps[e]>t},external:external}:typeof window.localStorage=="object"?{open:function(e){gameName=e},save:function(e,t,n){var r=gameName+"."+t+"."+e,i=serialize(n),s=ts();t=="save"&&saveExternal(e,i,s),window.localStorage[r]=i,t=="save"&&(window.localStorage[r+".ts"]=s)},load:function(e,t,n){var r=gameName+"."+t+"."+e,i=window.localStorage[r];n(unserialize(i))},getAllKeys:function(e,t){var n={},r=[],i=gameName+"."+e;for(var s in window.localStorage)if(s.indexOf(i)!=-1){var o=s.replace(i,"").replace(".ts","");n[o]=!0}for(s in n)r.push(s);t(r)},check:function(e,t){var n=window.localStorage[gameName+".save."+e+".ts"];return parseInt(t)>parseInt(n)},external:external}:{open:function(e){gameName=e},save:function(e,t,n){if(t!="save")return;var r=serialize(n),i=ts();t=="save"&&saveExternal(e,r,i),document.cookie=gameName+"_"+e+"="+r+"; "+gameName+"_"+e+"_ts="+i+"; expires=Thur, 31 Dec 2099 23:59:59 UTC; path=/"},load:function(e,t,n){if(t!="save")return;var r=new RegExp(gameName+"_"+e+"=[^;]*"),i=r.exec(document.cookie),s=unserialize(i[0].replace(gameName+"_"+e+"=",""));n(s)},getAllKeys:function(e,t){if(e!="save")return;var n=new RegExp(gameName+"_[^_=]","g"),r=n.exec(document.cookie),i=0,s=r.length,o={},u=[];for(;i<s;i++){var a=r[i].replace(gameName+"_","");o[a]=!0}for(i in o)u.push(i);t(u)},check:function(e,t){var n=gameName+"_"+e+"_ts",r=new RegExp(n+"=[^;]"),i=r.exec(document.cookie),s=i[0].replace(n+"=","");return parseInt(t)>parseInt(s)},external:external}}(),function(){var t=Crafty.support={},n=navigator.userAgent.toLowerCase(),r=/(webkit)[ \/]([\w.]+)/.exec(n)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(n)||/(ms)ie ([\w.]+)/.exec(n)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(n)||[],i=/iPad|iPod|iPhone|Android|webOS|IEMobile/i.exec(n);i&&(Crafty.mobile=i[0]),t.setter="__defineSetter__"in this&&"__defineGetter__"in this,t.defineProperty=function(){if(!1 in Object)return!1;try{Object.defineProperty({},"x",{})}catch(e){return!1}return!0}(),t.audio="Audio"in window,t.prefix=r[1]||r[0],t.prefix==="moz"&&(t.prefix="Moz"),t.prefix==="o"&&(t.prefix="O"),r[2]&&(t.versionName=r[2],t.version=+r[2].split(".")[0]),t.canvas="getContext"in document.createElement("canvas");if(t.canvas){var s;try{s=document.createElement("canvas").getContext("experimental-webgl"),s.viewportWidth=canvas.width,s.viewportHeight=canvas.height}catch(o){}t.webgl=!!s}else t.webgl=!1;t.css3dtransform=typeof document.createElement("div").style.Perspective!="undefined"||typeof document.createElement("div").style[t.prefix+"Perspective"]!="undefined",t.deviceorientation=typeof window.DeviceOrientationEvent!="undefined"||typeof window.OrientationEvent!="undefined",t.devicemotion=typeof window.DeviceMotionEvent!="undefined"}(),Crafty.extend({zeroFill:function(e,t){return t-=e.toString().length,t>0?(new Array(t+(/\./.test(e)?2:1))).join("0")+e:e.toString()},sprite:function(e,t,n,r,i,s){var o,u,a,f,l,c,h;typeof e=="string"&&(s=i,i=r,r=t,n=e,e=1,t=1),typeof t=="string"&&(s=i,i=r,r=n,n=t,t=e),!s&&i&&(s=i),i=parseInt(i||0,10),s=parseInt(s||0,10),h=Crafty.asset(n),h||(h=new Image,h.src=n,Crafty.asset(n,h),h.onload=function(){for(o in r)Crafty(o).each(function(){this.ready=!0,this.trigger("Change")})});for(o in r){if(!r.hasOwnProperty(o))continue;u=r[o],a=u[0]*(e+i),f=u[1]*(t+s),l=u[2]*e||e,c=u[3]*t||t,Crafty.c(o,{ready:!1,__coord:[a,f,l,c],init:function(){this.requires("Sprite"),this.__trim=[0,0,0,0],this.__image=n,this.__coord=[this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]],this.__tile=e,this.__tileh=t,this.__padding=[i,s],this.img=h,this.img.complete&&this.img.width>0&&(this.ready=!0,this.trigger("Change")),this.w=this.__coord[2],this.h=this.__coord[3]}})}return this},_events:{},addEvent:function(e,t,n,r){arguments.length===3&&(r=n,n=t,t=window.document);var i=function(t){var t=t||window.event;typeof r=="function"&&r.call(e,t)},s=e[0]||"";if(!!this._events[s+t+n+r])return;this._events[s+t+n+r]=i,t.attachEvent?t.attachEvent("on"+n,i):t.addEventListener(n,i,!1)},removeEvent:function(e,t,n,r){arguments.length===3&&(r=n,n=t,t=window.document);var i=e[0]||"",s=this._events[i+t+n+r];s&&(t.detachEvent?t.detachEvent("on"+n,s):t.removeEventListener(n,s,!1),delete this._events[i+t+n+r])},background:function(e){Crafty.stage.elem.style.background=e},viewport:{clampToEntities:!0,width:0,height:0,_x:0,_y:0,scroll:function(e,t){t=Math.floor(t);var n=t-this[e],r=Crafty.canvas.context,i=Crafty.stage.inner.style,s;this[e]=t,r&&(e=="_x"?r.translate(n,0):r.translate(0,n),Crafty.DrawManager.drawAll()),i[e=="_x"?"left":"top"]=t+"px"},rect:function(){return{_x:-this._x,_y:-this._y,_w:this.width,_h:this.height}},pan:function(){function r(n){var r=0;for(t in e){var s=e[t];s.remTime>0?(s.current+=s.diff,s.remTime--,Crafty.viewport[t]=Math.floor(s.current),r++):delete e[t]}r&&Crafty.viewport._clamp()}var e={},t,n=!1;return function(s,o,u){Crafty.viewport.follow();if(s=="reset"){for(t in e)e[t].remTime=0;return}u==0&&(u=1),e[s]={diff:-o/u,current:Crafty.viewport[s],remTime:u},n||(Crafty.bind("EnterFrame",r),n=!0)}}(),follow:function(){function r(){Crafty.viewport.scroll("_x",-(this.x+this.w/2-Crafty.viewport.width/2-t)),Crafty.viewport.scroll("_y",-(this.y+this.h/2-Crafty.viewport.height/2-n)),Crafty.viewport._clamp()}var e,t,n;return function(i,s,o){e&&e.unbind("Change",r);if(!i||!i.has("2D"))return;Crafty.viewport.pan("reset"),e=i,t=typeof s!="undefined"?s:0,n=typeof o!="undefined"?o:0,i.bind("Change",r),r.call(i)}}(),centerOn:function(e,t){var n=e.x,r=e.y,i=e.w/2,s=e.h/2,o=Crafty.viewport.width/2,u=Crafty.viewport.height/2,a=n+i-o,f=r+s-u;Crafty.viewport.pan("reset"),Crafty.viewport.pan("x",a,t),Crafty.viewport.pan("y",f,t)},_zoom:1,zoom:function(){function u(){if(n>0){isFinite(Crafty.viewport._zoom)&&(e=Crafty.viewport._zoom);var i={width:s.width*e,height:s.height*e};e+=t,Crafty.viewport._zoom=e;var u={width:s.width*e,height:s.height*e},a={width:u.width-i.width,height:u.height-i.height};Crafty.stage.inner.style[r]="scale("+e+","+e+")";if(Crafty.canvas._canvas){var f=e/(e-t);Crafty.canvas.context.scale(f,f),Crafty.DrawManager.drawAll()}Crafty.viewport.x-=a.width*o.width,Crafty.viewport.y-=a.height*o.height,n--}}var e=1,t=0,n=0,r=Crafty.support.prefix+"Transform",i=!1,s={},o={};return function(r,a,f,l){var c=this.bounds||Crafty.map.boundaries(),h=r?e*r:1;r||(e=1,this._zoom=1),s.width=c.max.x-c.min.x,s.height=c.max.y-c.min.y,o.width=a/s.width,o.height=f/s.height,l==0&&(l=1),t=(h-e)/l,n=l,Crafty.viewport.pan("reset"),i||(Crafty.bind("EnterFrame",u),i=!0)}}(),scale:function(){var e=Crafty.support.prefix+"Transform",t={};return function(n){var r=this.bounds||Crafty.map.boundaries(),i=n?this._zoom*n:1,s=i/this._zoom;this._zoom=i,t.width=r.max.x-r.min.x,t.height=r.max.y-r.min.y;var o={width:t.width*i,height:t.height*i};Crafty.viewport.pan("reset"),Crafty.stage.inner.style.transform=Crafty.stage.inner.style[e]="scale("+this._zoom+","+this._zoom+")",Crafty.canvas._canvas&&(Crafty.canvas.context.scale(s,s),Crafty.DrawManager.drawAll())}}(),mouselook:function(){var e=!1,t=!1,n={};return old={},function(r,i){if(typeof r=="boolean"){e=r,e?Crafty.mouseObjs++:Crafty.mouseObjs=Math.max(0,Crafty.mouseObjs-1);return}if(!e)return;switch(r){case"move":case"drag":if(!t)return;diff={x:i.clientX-n.x,y:i.clientY-n.y},Crafty.viewport.x+=diff.x,Crafty.viewport.y+=diff.y,Crafty.viewport._clamp();case"start":n.x=i.clientX,n.y=i.clientY,t=!0;break;case"stop":t=!1}}}(),_clamp:function(){if(!this.clampToEntities)return;var e=this.bounds||Crafty.map.boundaries();e.max.x*=this._zoom,e.min.x*=this._zoom,e.max.y*=this._zoom,e.min.y*=this._zoom,e.max.x-e.min.x>Crafty.viewport.width?(e.max.x-=Crafty.viewport.width,Crafty.viewport.x<-e.max.x?Crafty.viewport.x=-e.max.x:Crafty.viewport.x>-e.min.x&&(Crafty.viewport.x=-e.min.x)):Crafty.viewport.x=-1*(e.min.x+(e.max.x-e.min.x)/2-Crafty.viewport.width/2),e.max.y-e.min.y>Crafty.viewport.height?(e.max.y-=Crafty.viewport.height,Crafty.viewport.y<-e.max.y?Crafty.viewport.y=-e.max.y:Crafty.viewport.y>-e.min.y&&(Crafty.viewport.y=-e.min.y)):Crafty.viewport.y=-1*(e.min.y+(e.max.y-e.min.y)/2-Crafty.viewport.height/2)},init:function(e,t){Crafty.DOM.window.init(),this.width=!e||Crafty.mobile?Crafty.DOM.window.width:e,this.height=!t||Crafty.mobile?Crafty.DOM.window.height:t;var n=document.getElementById("cr-stage");Crafty.stage={x:0,y:0,fullscreen:!1,elem:n?n:document.createElement("div"),inner:document.createElement("div")};if(!e&&!t||Crafty.mobile)document.body.style.overflow="hidden",Crafty.stage.fullscreen=!0;Crafty.addEvent(this,window,"resize",Crafty.viewport.reload),Crafty.addEvent(this,window,"blur",function(){Crafty.settings.get("autoPause")&&(Crafty._paused||Crafty.pause())}),Crafty.addEvent(this,window,"focus",function(){Crafty._paused&&Crafty.settings.get("autoPause")&&Crafty.pause()}),Crafty.settings.register("stageSelectable",function(e){Crafty.stage.elem.onselectstart=e?function(){return!0}:function(){return!1}}),Crafty.settings.modify("stageSelectable",!1),Crafty.settings.register("stageContextMenu",function(e){Crafty.stage.elem.oncontextmenu=e?function(){return!0}:function(){return!1}}),Crafty.settings.modify("stageContextMenu",!1),Crafty.settings.register("autoPause",function(){}),Crafty.settings.modify("autoPause",!1),n||(document.body.appendChild(Crafty.stage.elem),Crafty.stage.elem.id="cr-stage");var r=Crafty.stage.elem.style,i;Crafty.stage.elem.appendChild(Crafty.stage.inner),Crafty.stage.inner.style.position="absolute",Crafty.stage.inner.style.zIndex="1",r.width=this.width+"px",r.height=this.height+"px",r.overflow="hidden";if(Crafty.mobile){r.position="absolute",r.left="0px",r.top="0px",typeof r.webkitTapHighlightColor!=undefined&&(r.webkitTapHighlightColor="rgba(0,0,0,0)");var s=document.createElement("meta"),o=document.getElementsByTagName("HEAD")[0];s.setAttribute("name","viewport"),s.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"),o.appendChild(s),s=document.createElement("meta"),s.setAttribute("name","apple-mobile-web-app-capable"),s.setAttribute("content","yes"),o.appendChild(s),setTimeout(function(){window.scrollTo(0,1)},0),Crafty.addEvent(this,window,"touchmove",function(e){e.preventDefault()}),Crafty.stage.x=0,Crafty.stage.y=0}else r.position="relative",i=Crafty.DOM.inner(Crafty.stage.elem),Crafty.stage.x=i.x,Crafty.stage.y=i.y;Crafty.support.setter?(this.__defineSetter__("x",function(e){this.scroll("_x",e)}),this.__defineSetter__("y",function(e){this.scroll("_y",e)}),this.__defineGetter__("x",function(){return this._x}),this.__defineGetter__("y",function(){return this._y})):Crafty.support.defineProperty?(Object.defineProperty(this,"x",{set:function(e){this.scroll("_x",e)},get:function(){return this._x}}),Object.defineProperty(this,"y",{set:function(e){this.scroll("_y",e)},get:function(){return this._y}})):(this.x=this._x,this.y=this._y,Crafty.e("viewport"))},reload:function(){Crafty.DOM.window.init();var e=Crafty.DOM.window.width,t=Crafty.DOM.window.height,n;Crafty.stage.fullscreen&&(this.width=e,this.height=t,Crafty.stage.elem.style.width=e+"px",Crafty.stage.elem.style.height=t+"px",Crafty.canvas._canvas&&(Crafty.canvas._canvas.width=e,Crafty.canvas._canvas.height=t,Crafty.DrawManager.drawAll())),n=Crafty.DOM.inner(Crafty.stage.elem),Crafty.stage.x=n.x,Crafty.stage.y=n.y},reset:function(){Crafty.viewport.pan("reset"),Crafty.viewport.follow(),Crafty.viewport.mouselook("stop"),Crafty.viewport.scale()}},keys:{BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190},mouseButtons:{LEFT:0,MIDDLE:1,RIGHT:2}}),Crafty.c("viewport",{init:function(){this.bind("EnterFrame",function(){Crafty.viewport._x!==Crafty.viewport.x&&Crafty.viewport.scroll("_x",Crafty.viewport.x),Crafty.viewport._y!==Crafty.viewport.y&&Crafty.viewport.scroll("_y",Crafty.viewport.y)})}}),Crafty.extend({device:{_deviceOrientationCallback:!1,_deviceMotionCallback:!1,_normalizeDeviceOrientation:function(e){var t;window.DeviceOrientationEvent?t={tiltLR:e.gamma,tiltFB:e.beta,dir:e.alpha,motUD:null}:window.OrientationEvent&&(t={tiltLR:e.x*90,tiltFB:e.y*-90,dir:null,motUD:e.z}),Crafty.device._deviceOrientationCallback(t)},_normalizeDeviceMotion:function(e){var t=e.accelerationIncludingGravity,n=t.z>0?1:-1,r={acceleration:t,rawAcceleration:"["+Math.round(t.x)+", "+Math.round(t.y)+", "+Math.round(t.z)+"]",facingUp:n,tiltLR:Math.round(t.x/9.81*-90),tiltFB:Math.round((t.y+9.81)/9.81*90*n)};Crafty.device._deviceMotionCallback(r)},deviceOrientation:function(e){this._deviceOrientationCallback=e,Crafty.support.deviceorientation&&(window.DeviceOrientationEvent?Crafty.addEvent(this,window,"deviceorientation",this._normalizeDeviceOrientation):window.OrientationEvent&&Crafty.addEvent(this,window,"MozOrientation",this._normalizeDeviceOrientation))},deviceMotion:function(e){this._deviceMotionCallback=e,Crafty.support.devicemotion&&window.DeviceMotionEvent&&Crafty.addEvent(this,window,"devicemotion",this._normalizeDeviceMotion)}}}),Crafty.c("Sprite",{__image:"",__tile:0,__tileh:0,__padding:null,__trim:null,img:null,ready:!1,init:function(){this.__trim=[0,0,0,0];var e=function(e){var t=e.co,n=e.pos,r=e.ctx;e.type==="canvas"?r.drawImage(this.img,t.x,t.y,t.w,t.h,n._x,n._y,n._w,n._h):e.type==="DOM"&&(this._element.style.background="url('"+this.__image+"') no-repeat -"+t.x+"px -"+t.y+"px")};this.bind("Draw",e).bind("RemoveComponent",function(t){t==="Sprite"&&this.unbind("Draw",e)})},sprite:function(e,t,n,r){return this.__coord=[e*this.__tile+this.__padding[0]+this.__trim[0],t*this.__tileh+this.__padding[1]+this.__trim[1],this.__trim[2]||n*this.__tile||this.__tile,this.__trim[3]||r*this.__tileh||this.__tileh],this.trigger("Change"),this},crop:function(e,t,n,r){var i=this._mbr||this.pos();return this.__trim=[],this.__trim[0]=e,this.__trim[1]=t,this.__trim[2]=n,this.__trim[3]=r,this.__coord[0]+=e,this.__coord[1]+=t,this.__coord[2]=n,this.__coord[3]=r,this._w=n,this._h=r,this.trigger("Change",i),this}}),Crafty.c("Canvas",{init:function(){Crafty.canvas.context||Crafty.canvas.init(),Crafty.DrawManager.total2D++,this.bind("Change",function(e){this._changed===!1?this._changed=Crafty.DrawManager.add(e||this,this):e&&(this._changed=Crafty.DrawManager.add(e,this))}),this.bind("Remove",function(){Crafty.DrawManager.total2D--,Crafty.DrawManager.add(this,this)})},draw:function(e,t,n,r,i){if(!this.ready)return;arguments.length===4&&(i=r,r=n,n=t,t=e,e=Crafty.canvas.context);var s={_x:this._x+(t||0),_y:this._y+(n||0),_w:r||this._w,_h:i||this._h},o=e||Crafty.canvas.context,u=this.__coord||[0,0,0,0],a={x:u[0]+(t||0),y:u[1]+(n||0),w:r||u[2],h:i||u[3]};this._mbr&&(o.save(),o.translate(this._origin.x+this._x,this._origin.y+this._y),s._x=-this._origin.x,s._y=-this._origin.y,o.rotate(this._rotation%360*(Math.PI/180)));if(this._flipX||this._flipY)o.save(),o.scale(this._flipX?-1:1,this._flipY?-1:1),this._flipX&&(s._x=-(s._x+s._w)),this._flipY&&(s._y=-(s._y+s._h));if(this._alpha<1){var f=o.globalAlpha;o.globalAlpha=this._alpha}return this.trigger("Draw",{type:"canvas",pos:s,co:a,ctx:o}),(this._mbr||this._flipX||this._flipY)&&o.restore(),f&&(o.globalAlpha=f),this}}),Crafty.extend({canvas:{context:null,init:function(){if(!Crafty.support.canvas){Crafty.trigger("NoCanvas"),Crafty.stop();return}var e;e=document.createElement("canvas"),e.width=Crafty.viewport.width,e.height=Crafty.viewport.height,e.style.position="absolute",e.style.left="0px",e.style.top="0px",Crafty.stage.elem.appendChild(e),Crafty.canvas.context=e.getContext("2d"),Crafty.canvas._canvas=e}}}),Crafty.extend({over:null,mouseObjs:0,mousePos:{},lastEvent:null,keydown:{},selected:!1,detectBlur:function(e){var t=e.clientX>Crafty.stage.x&&e.clientX<Crafty.stage.x+Crafty.viewport.width&&e.clientY>Crafty.stage.y&&e.clientY<Crafty.stage.y+Crafty.viewport.height;!Crafty.selected&&t&&Crafty.trigger("CraftyFocus"),Crafty.selected&&!t&&Crafty.trigger("CraftyBlur"),Crafty.selected=t},mouseDispatch:function(e){if(!Crafty.mouseObjs)return;Crafty.lastEvent=e;var t=-1,n,r,i=0,s,o=Crafty.DOM.translate(e.clientX,e.clientY),u,a,f={},l=e.target?e.target:e.srcElement,c=e.type;e.which==null?e.mouseButton=e.button<2?Crafty.mouseButtons.LEFT:e.button==4?Crafty.mouseButtons.MIDDLE:Crafty.mouseButtons.RIGHT:e.mouseButton=e.which<2?Crafty.mouseButtons.LEFT:e.which==2?Crafty.mouseButtons.MIDDLE:Crafty.mouseButtons.RIGHT,e.realX=u=Crafty.mousePos.x=o.x,e.realY=a=Crafty.mousePos.y=o.y;if(l.nodeName!="CANVAS"){while(typeof l.id!="string"&&l.id.indexOf("ent")==-1)l=l.parentNode;ent=Crafty(parseInt(l.id.replace("ent",""))),ent.has("Mouse")&&ent.isAt(u,a)&&(n=ent)}if(!n){r=Crafty.map.search({_x:u,_y:a,_w:1,_h:1},!1);for(s=r.length;i<s;++i){if(!r[i].__c.Mouse||!r[i]._visible)continue;var h=r[i],p=!1;if(f[h[0]])continue;f[h[0]]=!0,h.mapArea?h.mapArea.containsPoint(u,a)&&(p=!0):h.isAt(u,a)&&(p=!0);if(p&&(h._z>=t||t===-1)){if(h._z===t&&h[0]<n[0])continue;t=h._z,n=h}}}n?c==="mousedown"?n.trigger("MouseDown",e):c==="mouseup"?n.trigger("MouseUp",e):c=="dblclick"?n.trigger("DoubleClick",e):c=="click"?n.trigger("Click",e):c==="mousemove"?(n.trigger("MouseMove",e),this.over!==n&&(this.over&&(this.over.trigger("MouseOut",e),this.over=null),this.over=n,n.trigger("MouseOver",e))):n.trigger(c,e):(c==="mousemove"&&this.over&&(this.over.trigger("MouseOut",e),this.over=null),c==="mousedown"?Crafty.viewport.mouselook("start",e):c==="mousemove"?Crafty.viewport.mouselook("drag",e):c=="mouseup"&&Crafty.viewport.mouselook("stop")),c==="mousemove"&&(this.lastEvent=e)},touchDispatch:function(e){var t,n=Crafty.lastEvent;e.type==="touchstart"?t="mousedown":e.type==="touchmove"?t="mousemove":e.type==="touchend"?t="mouseup":e.type==="touchcancel"?t="mouseup":e.type==="touchleave"&&(t="mouseup"),e.touches&&e.touches.length?first=e.touches[0]:e.changedTouches&&e.changedTouches.length&&(first=e.changedTouches[0]);var r=document.createEvent("MouseEvent");r.initMouseEvent(t,!0,!0,window,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,e.relatedTarget),first.target.dispatchEvent(r);if(n!=null&&n.type=="mousedown"&&t=="mouseup"){t="click";var r=document.createEvent("MouseEvent");r.initMouseEvent(t,!0,!0,window,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,e.relatedTarget),first.target.dispatchEvent(r)}e.preventDefault?e.preventDefault():e.returnValue=!1},keyboardDispatch:function(e){e.key=e.keyCode||e.which,e.type==="keydown"?Crafty.keydown[e.key]!==!0&&(Crafty.keydown[e.key]=!0,Crafty.trigger("KeyDown",e)):e.type==="keyup"&&(delete Crafty.keydown[e.key],Crafty.trigger("KeyUp",e));if(Crafty.selected&&!(e.key==8||e.key>=112&&e.key<=135))return e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1,!1}}),Crafty.bind("Load",function(){Crafty.addEvent(this,"keydown",Crafty.keyboardDispatch),Crafty.addEvent(this,"keyup",Crafty.keyboardDispatch),Crafty.addEvent(this,Crafty.stage.elem,"mousedown",Crafty.mouseDispatch),Crafty.addEvent(this,Crafty.stage.elem,"mouseup",Crafty.mouseDispatch),Crafty.addEvent(this,document.body,"mouseup",Crafty.detectBlur),Crafty.addEvent(this,Crafty.stage.elem,"mousemove",Crafty.mouseDispatch),Crafty.addEvent(this,Crafty.stage.elem,"click",Crafty.mouseDispatch),Crafty.addEvent(this,Crafty.stage.elem,"dblclick",Crafty.mouseDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchstart",Crafty.touchDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchmove",Crafty.touchDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchend",Crafty.touchDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchcancel",Crafty.touchDispatch),Crafty.addEvent(this,Crafty.stage.elem,"touchleave",Crafty.touchDispatch)}),Crafty.bind("CraftyStop",function(){Crafty.removeEvent(this,"keydown",Crafty.keyboardDispatch),Crafty.removeEvent(this,"keyup",Crafty.keyboardDispatch),Crafty.stage&&(Crafty.removeEvent(this,Crafty.stage.elem,"mousedown",Crafty.mouseDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"mouseup",Crafty.mouseDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"mousemove",Crafty.mouseDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"click",Crafty.mouseDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"dblclick",Crafty.mouseDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"touchstart",Crafty.touchDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"touchmove",Crafty.touchDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"touchend",Crafty.touchDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"touchcancel",Crafty.touchDispatch),Crafty.removeEvent(this,Crafty.stage.elem,"touchleave",Crafty.touchDispatch)),Crafty.removeEvent(this,document.body,"mouseup",Crafty.detectBlur)}),Crafty.c("Mouse",{init:function(){Crafty.mouseObjs++,this.bind("Remove",function(){Crafty.mouseObjs--})},areaMap:function(e){if(arguments.length>1){var t=Array.prototype.slice.call(arguments,0);e=new Crafty.polygon(t)}return e.shift(this._x,this._y),this.mapArea=e,this.attach(this.mapArea),this}}),Crafty.c("Draggable",{_origMouseDOMPos:null,_oldX:null,_oldY:null,_dragging:!1,_dir:null,_ondrag:null,_ondown:null,_onup:null,init:function(){this.requires("Mouse"),this._ondrag=function(e){var t=Crafty.DOM.translate(e.clientX,e.clientY);if(t.x==0||t.y==0)return!1;if(this._dir){var n=(t.x-this._origMouseDOMPos.x)*this._dir.x+(t.y-this._origMouseDOMPos.y)*this._dir.y;this.x=this._oldX+n*this._dir.x,this.y=this._oldY+n*this._dir.y}else this.x=this._oldX+(t.x-this._origMouseDOMPos.x),this.y=this._oldY+(t.y-this._origMouseDOMPos.y);this.trigger("Dragging",e)},this._ondown=function(e){if(e.mouseButton!==Crafty.mouseButtons.LEFT)return;this._startDrag(e)},this._onup=function(t){this._dragging==1&&(Crafty.removeEvent(this,Crafty.stage.elem,"mousemove",this._ondrag),Crafty.removeEvent(this,Crafty.stage.elem,"mouseup",this._onup),this._dragging=!1,this.trigger("StopDrag",t))},this.enableDrag()},dragDirection:function(e){if(typeof e=="undefined")this._dir=null;else if(""+parseInt(e)==e)this._dir={x:Math.cos(e/180*Math.PI),y:Math.sin(e/180*Math.PI)};else{var t=Math.sqrt(e.x*e.x+e.y*e.y);this._dir={x:e.x/t,y:e.y/t}}},_startDrag:function(e){this._origMouseDOMPos=Crafty.DOM.translate(e.clientX,e.clientY),this._oldX=this._x,this._oldY=this._y,this._dragging=!0,Crafty.addEvent(this,Crafty.stage.elem,"mousemove",this._ondrag),Crafty.addEvent(this,Crafty.stage.elem,"mouseup",this._onup),this.trigger("StartDrag",e)},stopDrag:function(){return Crafty.removeEvent(this,Crafty.stage.elem,"mousemove",this._ondrag),Crafty.removeEvent(this,Crafty.stage.elem,"mouseup",this._onup),this._dragging=!1,this.trigger("StopDrag"),this},startDrag:function(){return this._dragging||this._startDrag(Crafty.lastEvent),this},enableDrag:function(){return this.bind("MouseDown",this._ondown),Crafty.addEvent(this,Crafty.stage.elem,"mouseup",this._onup),this},disableDrag:function(){return this.unbind("MouseDown",this._ondown),this.stopDrag(),this}}),Crafty.c("Keyboard",{isDown:function(e){return typeof e=="string"&&(e=Crafty.keys[e]),!!Crafty.keydown[e]}}),Crafty.c("Multiway",{_speed:3,_keydown:function(e){this._keys[e.key]&&(this._movement.x=Math.round((this._movement.x+this._keys[e.key].x)*1e3)/1e3,this._movement.y=Math.round((this._movement.y+this._keys[e.key].y)*1e3)/1e3,this.trigger("NewDirection",this._movement))},_keyup:function(e){this._keys[e.key]&&(this._movement.x=Math.round((this._movement.x-this._keys[e.key].x)*1e3)/1e3,this._movement.y=Math.round((this._movement.y-this._keys[e.key].y)*1e3)/1e3,this.trigger("NewDirection",this._movement))},_enterframe:function(){if(this.disableControls)return;this._movement.x!==0&&(this.x+=this._movement.x,this.trigger("Moved",{x:this.x-this._movement.x,y:this.y})),this._movement.y!==0&&(this.y+=this._movement.y,this.trigger("Moved",{x:this.x,y:this.y-this._movement.y}))},multiway:function(e,t){this._keyDirection={},this._keys={},this._movement={x:0,y:0},this._speed={x:3,y:3},t?e.x&&e.y?(this._speed.x=e.x,this._speed.y=e.y):(this._speed.x=e,this._speed.y=e):t=e,this._keyDirection=t,this.speed(this._speed),this.disableControl(),this.enableControl();for(var n in t)Crafty.keydown[Crafty.keys[n]]&&this.trigger("KeyDown",{key:Crafty.keys[n]});return this},enableControl:function(){return this.bind("KeyDown",this._keydown).bind("KeyUp",this._keyup).bind("EnterFrame",this._enterframe),this},disableControl:function(){return this.unbind("KeyDown",this._keydown).unbind("KeyUp",this._keyup).unbind("EnterFrame",this._enterframe),this},speed:function(e){for(var t in this._keyDirection){var n=Crafty.keys[t]||t;this._keys[n]={x:Math.round(Math.cos(this._keyDirection[t]*(Math.PI/180))*1e3*e.x)/1e3,y:Math.round(Math.sin(this._keyDirection[t]*(Math.PI/180))*1e3*e.y)/1e3}}return this}}),Crafty.c("Fourway",{init:function(){this.requires("Multiway")},fourway:function(e){return this.multiway(e,{UP_ARROW:-90,DOWN_ARROW:90,RIGHT_ARROW:0,LEFT_ARROW:180,W:-90,S:90,D:0,A:180,Z:-90,Q:180}),this}}),Crafty.c("Twoway",{_speed:3,_up:!1,init:function(){this.requires("Fourway, Keyboard")},twoway:function(e,t){return this.multiway(e,{RIGHT_ARROW:0,LEFT_ARROW:180,D:0,A:180,Q:180}),e&&(this._speed=e),t=t||this._speed*2,this.bind("EnterFrame",function(){if(this.disableControls)return;this._up&&(this.y-=t,this._falling=!0)}).bind("KeyDown",function(){if(this.isDown("UP_ARROW")||this.isDown("W")||this.isDown("Z"))this._up=!0}),this}}),Crafty.c("SpriteAnimation",{_reels:null,_frame:null,_currentReelId:null,init:function(){this._reels={}},animate:function(e,t,n,r){var i,s,o,u,a,f;if(arguments.length<4&&typeof t=="number")return a=t,this._currentReelId=e,currentReel=this._reels[e],this._frame={currentReel:currentReel,numberOfFramesBetweenSlides:Math.ceil(a/currentReel.length),currentSlideNumber:0,frameNumberBetweenSlides:0,repeat:0},arguments.length===3&&typeof n=="number"&&(n===-1?this._frame.repeatInfinitly=!0:this._frame.repeat=n),f=this._frame.currentReel[0],this.__coord[0]=f[0],this.__coord[1]=f[1],this.bind("EnterFrame",this.updateSprite),this;if(typeof t=="number"){o=this.__tile+parseInt(this.__padding[0]||0,10),u=this.__tileh+parseInt(this.__padding[1]||0,10),i=[],s=t;if(r>t)for(;s<=r;s++)i.push([s*o,n*u]);else for(;s>=r;s--)i.push([s*o,n*u]);this._reels[e]=i}else if(typeof t=="object"){s=0,i=[],r=t.length-1,o=this.__tile+parseInt(this.__padding[0]||0,10),u=this.__tileh+parseInt(this.__padding[1]||0,10);for(;s<=r;s++)f=t[s],i.push([f[0]*o,f[1]*u]);this._reels[e]=i}return this},updateSprite:function(){var e=this._frame;if(!e)return;if(this._frame.frameNumberBetweenSlides++===e.numberOfFramesBetweenSlides){var t=e.currentReel[e.currentSlideNumber++];this.__coord[0]=t[0],this.__coord[1]=t[1],this._frame.frameNumberBetweenSlides=0}if(e.currentSlideNumber===e.currentReel.length)if(this._frame.repeatInfinitly===!0||this._frame.repeat>0)this._frame.repeat&&this._frame.repeat--,this._frame.frameNumberBetweenSlides=0,this._frame.currentSlideNumber=0;else if(this._frame.frameNumberBetweenSlides===e.numberOfFramesBetweenSlides){this.trigger("AnimationEnd",{reel:e.currentReel}),this.stop();return}this.trigger("Change")},stop:function(){return this.unbind("EnterFrame",this.updateSprite),this.unbind("AnimationEnd"),this._currentReelId=null,this._frame=null,this},reset:function(){if(!this._frame)return this;var e=this._frame.currentReel[0];return this.__coord[0]=e[0],this.__coord[1]=e[1],this.stop(),this},isPlaying:function(e){return e?this._currentReelId===e:!!this._currentReelId}}),Crafty.c("Tween",{_step:null,_numProps:0,tween:function(e,t){return this.each(function(){this._step==null&&(this._step={},this.bind("EnterFrame",tweenEnterFrame),this.bind("RemoveComponent",function(e){e=="Tween"&&this.unbind("EnterFrame",tweenEnterFrame)}));for(var n in e)this._step[n]={prop:e[n],val:(e[n]-this[n])/t,rem:t},this._numProps++}),this}}),Crafty.c("Color",{_color:"",ready:!0,init:function(){this.bind("Draw",function(e){e.type==="DOM"?(e.style.background=this._color,e.style.lineHeight=0):e.type==="canvas"&&(this._color&&(e.ctx.fillStyle=this._color),e.ctx.fillRect(e.pos._x,e.pos._y,e.pos._w,e.pos._h))})},color:function(e){return e?(this._color=e,this.trigger("Change"),this):this._color}}),Crafty.c("Tint",{_color:null,_strength:1,init:function(){var e=function(t){var n=t.ctx||Crafty.canvas.context;n.fillStyle=this._color||"rgb(0,0,0)",n.fillRect(t.pos._x,t.pos._y,t.pos._w,t.pos._h)};this.bind("Draw",e).bind("RemoveComponent",function(t){t==="Tint"&&this.unbind("Draw",e)})},tint:function(e,t){return this._strength=t,this._color=Crafty.toRGB(e,this._strength),this.trigger("Change"),this}}),Crafty.c("Image",{_repeat:"repeat",ready:!1,init:function(){var e=function(e){if(e.type==="canvas"){if(!this.ready||!this._pattern)return;var t=e.ctx;t.fillStyle=this._pattern,t.save(),t.translate(e.pos._x,e.pos._y),t.fillRect(0,0,this._w,this._h),t.restore()}else e.type==="DOM"&&this.__image&&(e.style.background="url("+this.__image+") "+this._repeat)};this.bind("Draw",e).bind("RemoveComponent",function(t){t==="Image"&&this.unbind("Draw",e)})},image:function(e,t){this.__image=e,this._repeat=t||"no-repeat",this.img=Crafty.asset(e);if(!this.img){this.img=new Image,Crafty.asset(e,this.img),this.img.src=e;var n=this;return this.img.onload=function(){n.has("Canvas")&&(n._pattern=Crafty.canvas.context.createPattern(n.img,n._repeat)),n.ready=!0,n._repeat==="no-repeat"&&(n.w=n.img.width,n.h=n.img.height),n.trigger("Change")},this}return this.ready=!0,this.has("Canvas")&&(this._pattern=Crafty.canvas.context.createPattern(this.img,this._repeat)),this._repeat==="no-repeat"&&(this.w=this.img.width,this.h=this.img.height),this.trigger("Change"),this}}),Crafty.extend({_scenes:[],_current:null,scene:function(e,t,n){if(arguments.length===1){Crafty.viewport.reset(),Crafty("2D").each(function(){this.has("Persist")||this.destroy()}),this._current!==null&&"uninitialize"in this._scenes[this._current]&&this._scenes[this._current].uninitialize.call(this),this._scenes[e].initialize.call(this);var r=this._current;this._current=e,Crafty.trigger("SceneChange",{oldScene:r,newScene:e});return}this._scenes[e]={},this._scenes[e].initialize=t,typeof n!="undefined"&&(this._scenes[e].uninitialize=n);return},toRGB:function(e,t){var e=e.charAt(0)==="#"?e.substr(1):e,n=[],r;return n[0]=parseInt(e.substr(0,2),16),n[1]=parseInt(e.substr(2,2),16),n[2]=parseInt(e.substr(4,2),16),r=t===undefined?"rgb("+n.join(",")+")":"rgba("+n.join(",")+","+t+")",r}}),Crafty.DrawManager=function(){var e=[],t=[];return{total2D:Crafty("2D").length,onScreen:function(e){return Crafty.viewport._x+e._x+e._w>0&&Crafty.viewport._y+e._y+e._h>0&&Crafty.viewport._x+e._x<Crafty.viewport.width&&Crafty.viewport._y+e._y<Crafty.viewport.height},merge:function(e){do{var t=[],n=!1,r=0,i=e.length,s,o,u;while(r<i)s=e[r],o=e[r+1],r<i-1&&s._x<o._x+o._w&&s._x+s._w>o._x&&s._y<o._y+o._h&&s._h+s._y>o._y?(u={_x:~~Math.min(s._x,o._x),_y:~~Math.min(s._y,o._y),_w:Math.max(s._x,o._x)+Math.max(s._w,o._w),_h:Math.max(s._y,o._y)+Math.max(s._h,o._h)},u._w=u._w-u._x,u._h=u._h-u._y,u._w=u._w==~~u._w?u._w:u._w+1|0,u._h=u._h==~~u._h?u._h:u._h+1|0,t.push(u),r++,n=!0):t.push(s),r++;e=t.length?Crafty.clone(t):e,n&&(r=0)}while(n);return e},add:function(r,i){if(!i){t.push(r);return}var s,o=r._mbr||r,u=i._mbr||i;return r===i?s=r.mbr()||r.pos():(s={_x:~~Math.min(o._x,u._x),_y:~~Math.min(o._y,u._y),_w:Math.max(o._w,u._w)+Math.max(o._x,u._x),_h:Math.max(o._h,u._h)+Math.max(o._y,u._y)},s._w=s._w-s._x,s._h=s._h-s._y),s._w===0||s._h===0||!this.onScreen(s)?!1:(s._x=~~s._x,s._y=~~s._y,s._w=s._w===~~s._w?s._w:s._w+1|0,s._h=s._h===~~s._h?s._h:s._h+1|0,e.push(s),!0)},debug:function(){console.log(e,t)},drawAll:function(e){var e=e||Crafty.viewport.rect(),t=Crafty.map.search(e),n=0,r=t.length,i=Crafty.canvas.context,s;i.clearRect(e._x,e._y,e._w,e._h),t.sort(function(e,t){return e._globalZ-t._globalZ});for(;n<r;n++)s=t[n],s._visible&&s.__c.Canvas&&(s.draw(),s._changed=!1)},boundingRect:function(e){if(!e||!e.length)return;var t=[],n=1,r=e.length,i,s=e[0],o;s=[s._x,s._y,s._x+s._w,s._y+s._h];while(n<r)i=e[n],o=[i._x,i._y,i._x+i._w,i._y+i._h],o[0]<s[0]&&(s[0]=o[0]),o[1]<s[1]&&(s[1]=o[1]),o[2]>s[2]&&(s[2]=o[2]),o[3]>s[3]&&(s[3]=o[3]),n++;return o=s,s={_x:o[0],_y:o[1],_w:o[2]-o[0],_h:o[3]-o[1]},s},draw:function(){if(!e.length&&!t.length)return;var r=0,i=e.length,s=t.length,o,u,a,f,l,c,h,p=[],d=Crafty.canvas.context;for(;r<s;++r)t[r].draw()._changed=!1;t.length=0;if(!i)return;if(i/this.total2D>.6){this.drawAll(),e.length=0;return}e=this.merge(e);for(r=0;r<i;++r){o=e[r];if(!o)continue;u=Crafty.map.search(o,!1),l={};for(a=0,f=u.length;a<f;++a){c=u[a];if(l[c[0]]||!c._visible||!c.__c.Canvas)continue;l[c[0]]=!0,p.push({obj:c,rect:o})}d.clearRect(o._x,o._y,o._w,o._h)}p.sort(function(e,t){return e.obj._globalZ-t.obj._globalZ});if(!p.length)return;for(r=0,i=p.length;r<i;++r){c=p[r],o=c.rect,h=c.obj;var v=h._mbr||h,m=o._x-v._x<=0?0:~~(o._x-v._x),g=o._y-v._y<0?0:~~(o._y-v._y),y=~~Math.min(v._w-m,o._w-(v._x-o._x),o._w,v._w),b=~~Math.min(v._h-g,o._h-(v._y-o._y),o._h,v._h);if(b===0||y===0)continue;d.save(),d.beginPath(),d.moveTo(o._x,o._y),d.lineTo(o._x+o._w,o._y),d.lineTo(o._x+o._w,o._h+o._y),d.lineTo(o._x,o._h+o._y),d.lineTo(o._x,o._y),d.clip(),h.draw(),d.closePath(),d.restore(),h._changed=!1}e.length=0,merged={}}}}(),Crafty.extend({isometric:{_tile:{width:0,height:0},_elements:{},_pos:{x:0,y:0},_z:0,size:function(e,t){return this._tile.width=e,this._tile.height=t>0?t:e/2,this},place:function(e,t,n,r){var i=this.pos2px(e,t);return i.top-=n*(this._tile.width/2),r.attr({x:i.left+Crafty.viewport._x,y:i.top+Crafty.viewport._y}).z+=n,this},pos2px:function(e,t){return{left:e*this._tile.width+(t&1)*(this._tile.width/2),top:t*this._tile.height/2}},px2pos:function(e,t){return{x:Math.ceil(-e/this._tile.width-(t&1)*.5),y:-t/this._tile.height*2}},centerAt:function(e,t){if(typeof e=="number"&&typeof t=="number"){var n=this.pos2px(e,t);return Crafty.viewport._x=-n.left+Crafty.viewport.width/2-this._tile.width/2,Crafty.viewport._y=-n.top+Crafty.viewport.height/2-this._tile.height/2,this}return{top:-Crafty.viewport._y+Crafty.viewport.height/2-this._tile.height/2,left:-Crafty.viewport._x+Crafty.viewport.width/2-this._tile.width/2}},area:function(){var e=this.centerAt(),t=this.px2pos(-e.left+Crafty.viewport.width/2,-e.top+Crafty.viewport.height/2),n=this.px2pos(-e.left-Crafty.viewport.width/2,-e.top-Crafty.viewport.height/2);return{x:{start:t.x,end:n.x},y:{start:t.y,end:n.y}}}}}),Crafty.extend({diamondIso:{_tile:{width:0,height:0,r:0},_map:{width:0,height:0,x:0,y:0},_origin:{x:0,y:0},init:function(e,t,n,r){return this._tile.width=parseInt(e),this._tile.height=parseInt(t)||parseInt(e)/2,this._tile.r=this._tile.width/this._tile.height,this._map.width=parseInt(n),this._map.height=parseInt(r)||parseInt(n),this._origin.x=this._map.height*this._tile.width/2,this},place:function(e,t,n,r){var i=this.pos2px(t,n);r||(r=1);var s=0,o=0;e.__margin!==undefined&&(s=e.__margin[0],o=e.__margin[1]),e.x=i.left+s,e.y=i.top+o-e.h,e.z=i.top*r},centerAt:function(e,t){var n=this.pos2px(e,t);Crafty.viewport.x=-n.left+Crafty.viewport.width/2-this._tile.width,Crafty.viewport.y=-n.top+Crafty.viewport.height/2},area:function(e){e||(e=0);var t=Crafty.viewport.rect(),n=e*this._tile.width,r=e*this._tile.height;t._x-=this._tile.width/2+n,t._y-=this._tile.height/2+r,t._w+=this._tile.width/2+n,t._h+=this._tile.height/2+r;var i=[];for(var s=t._y,o=t._y+t._h;s<o;s+=this._tile.height/2)for(var u=t._x,a=t._x+t._w;u<a;u+=this._tile.width/2){var f=this.px2pos(u,s);i.push([~~f.x,~~f.y])}return i},pos2px:function(e,t){return{left:(e-t)*this._tile.width/2+this._origin.x,top:(e+t)*this._tile.height/2}},px2pos:function(e,t){var n=(e-this._origin.x)/this._tile.r;return{x:(t+n)/this._tile.height,y:(t-n)/this._tile.height}},polygon:function(e){e.requires("Collision");var t=0,n=0;e.__margin!==undefined&&(t=e.__margin[0],n=e.__margin[1]);var r=[[t-0,e.h-n-this._tile.height/2],[t-this._tile.width/2,e.h-n-0],[t-this._tile.width,e.h-n-this._tile.height/2],[t-this._tile.width/2,e.h-n-this._tile.height]],i=new Crafty.polygon(r);return i}}}),Crafty.c("Particles",{init:function(){this._Particles=Crafty.clone(this._Particles)},particles:function(e){if(!Crafty.support.canvas||Crafty.deactivateParticles)return this;var t,n,r,i,s;t=document.createElement("canvas"),t.width=Crafty.viewport.width,t.height=Crafty.viewport.height,t.style.position="absolute",Crafty.stage.elem.appendChild(t),n=t.getContext("2d"),this._Particles.init(e),this.bind("Remove",function(){Crafty.stage.elem.removeChild(t)}).bind("RemoveComponent",function(e){e==="particles"&&Crafty.stage.elem.removeChild(t)}),r=this.x+Crafty.viewport.x,i=this.y+Crafty.viewport.y,this._Particles.position=this._Particles.vectorHelpers.create(r,i);var o={x:Crafty.viewport.x,y:Crafty.viewport.y};return this.bind("EnterFrame",function(){r=this.x+Crafty.viewport.x,i=this.y+Crafty.viewport.y,this._Particles.viewportDelta={x:Crafty.viewport.x-o.x,y:Crafty.viewport.y-o.y},o={x:Crafty.viewport.x,y:Crafty.viewport.y},this._Particles.position=this._Particles.vectorHelpers.create(r,i),typeof Crafty.DrawManager.boundingRect=="function"?(s=Crafty.DrawManager.boundingRect(this._Particles.register),s&&n.clearRect(s._x,s._y,s._w,s._h)):n.clearRect(0,0,Crafty.viewport.width,Crafty.viewport.height),this._Particles.update(),this._Particles.render(n)}),this},_Particles:{presets:{maxParticles:150,size:18,sizeRandom:4,speed:1,speedRandom:1.2,lifeSpan:29,lifeSpanRandom:7,angle:65,angleRandom:34,startColour:[255,131,0,1],startColourRandom:[48,50,45,0],endColour:[245,35,0,0],endColourRandom:[60,60,60,0],sharpness:20,sharpnessRandom:10,spread:10,duration:-1,fastMode:!1,gravity:{x:0,y:.1},jitter:0,particles:[],active:!0,particleCount:0,elapsedFrames:0,emissionRate:0,emitCounter:0,particleIndex:0},init:function(e){this.position=this.vectorHelpers.create(0,0);if(typeof e=="undefined")var e={};for(key in this.presets)typeof e[key]!="undefined"?this[key]=e[key]:this[key]=this.presets[key];this.emissionRate=this.maxParticles/this.lifeSpan,this.positionRandom=this.vectorHelpers.create(this.spread,this.spread)},addParticle:function(){if(this.particleCount==this.maxParticles)return!1;var e=new this.particle(this.vectorHelpers);return this.initParticle(e),this.particles[this.particleCount]=e,this.particleCount++,!0},RANDM1TO1:function(){return Math.random()*2-1},initParticle:function(e){e.position.x=this.position.x+this.positionRandom.x*this.RANDM1TO1(),e.position.y=this.position.y+this.positionRandom.y*this.RANDM1TO1();var t=(this.angle+this.angleRandom*this.RANDM1TO1())*(Math.PI/180),n=this.vectorHelpers.create(Math.sin(t),-Math.cos(t)),r=this.speed+this.speedRandom*this.RANDM1TO1();e.direction=this.vectorHelpers.multiply(n,r),e.size=this.size+this.sizeRandom*this.RANDM1TO1(),e.size=e.size<0?0:~~e.size,e.timeToLive=this.lifeSpan+this.lifeSpanRandom*this.RANDM1TO1(),e.sharpness=this.sharpness+this.sharpnessRandom*this.RANDM1TO1(),e.sharpness=e.sharpness>100?100:e.sharpness<0?0:e.sharpness,e.sizeSmall=~~(e.size/200*e.sharpness);var i=[this.startColour[0]+this.startColourRandom[0]*this.RANDM1TO1(),this.startColour[1]+this.startColourRandom[1]*this.RANDM1TO1(),this.startColour[2]+this.startColourRandom[2]*this.RANDM1TO1(),this.startColour[3]+this.startColourRandom[3]*this.RANDM1TO1()],s=[this.endColour[0]+this.endColourRandom[0]*this.RANDM1TO1(),this.endColour[1]+this.endColourRandom[1]*this.RANDM1TO1(),this.endColour[2]+this.endColourRandom[2]*this.RANDM1TO1(),this.endColour[3]+this.endColourRandom[3]*this.RANDM1TO1()];e.colour=i,e.deltaColour[0]=(s[0]-i[0])/e.timeToLive,e.deltaColour[1]=(s[1]-i[1])/e.timeToLive,e.deltaColour[2]=(s[2]-i[2])/e.timeToLive,e.deltaColour[3]=(s[3]-i[3])/e.timeToLive},update:function(){if(this.active&&this.emissionRate>0){var e=1/this.emissionRate;this.emitCounter++;while(this.particleCount<this.maxParticles&&this.emitCounter>e)this.addParticle(),this.emitCounter-=e;this.elapsedFrames++,this.duration!=-1&&this.duration<this.elapsedFrames&&this.stop()}this.particleIndex=0,this.register=[];var t;while(this.particleIndex<this.particleCount){var n=this.particles[this.particleIndex];if(n.timeToLive>0){n.direction=this.vectorHelpers.add(n.direction,this.gravity),n.position=this.vectorHelpers.add(n.position,n.direction),n.position=this.vectorHelpers.add(n.position,this.viewportDelta),this.jitter&&(n.position.x+=this.jitter*this.RANDM1TO1(),n.position.y+=this.jitter*this.RANDM1TO1()),n.timeToLive--;var r=n.colour[0]+=n.deltaColour[0],i=n.colour[1]+=n.deltaColour[1],s=n.colour[2]+=n.deltaColour[2],o=n.colour[3]+=n.deltaColour[3];t=[],t.push("rgba("+(r>255?255:r<0?0:~~r)),t.push(i>255?255:i<0?0:~~i),t.push(s>255?255:s<0?0:~~s),t.push((o>1?1:o<0?0:o.toFixed(2))+")"),n.drawColour=t.join(","),this.fastMode||(t[3]="0)",n.drawColourEnd=t.join(",")),this.particleIndex++}else this.particleIndex!=this.particleCount-1&&(this.particles[this.particleIndex]=this.particles[this.particleCount-1]),this.particleCount--;var u={};u._x=~~n.position.x,u._y=~~n.position.y,u._w=n.size,u._h=n.size,this.register.push(u)}},stop:function(){this.active=!1,this.elapsedFrames=0,this.emitCounter=0},render:function(e){for(var t=0,n=this.particleCount;t<n;t++){var r=this.particles[t],i=r.size,s=i>>1;if(r.position.x+i<0||r.position.y+i<0||r.position.x-i>Crafty.viewport.width||r.position.y-i>Crafty.viewport.height)continue;var o=~~r.position.x,u=~~r.position.y;if(this.fastMode)e.fillStyle=r.drawColour;else{var a=e.createRadialGradient(o+s,u+s,r.sizeSmall,o+s,u+s,s);a.addColorStop(0,r.drawColour),a.addColorStop(.9,r.drawColourEnd),e.fillStyle=a}e.fillRect(o,u,i,i)}},particle:function(e){this.position=e.create(0,0),this.direction=e.create(0,0),this.size=0,this.sizeSmall=0,this.timeToLive=0,this.colour=[],this.drawColour="",this.deltaColour=[],this.sharpness=0},vectorHelpers:{create:function(e,t){return{x:e,y:t}},multiply:function(e,t){return e.x*=t,e.y*=t,e},add:function(e,t){return e.x+=t.x,e.y+=t.y,e}}}}),Crafty.extend({audio:{sounds:{},supported:{},codecs:{ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',webma:'audio/webm; codecs="vorbis"',mp3:'audio/mpeg; codecs="mp3"',m4a:'audio/mp4; codecs="mp4a.40.2"'},volume:1,muted:!1,paused:!1,canPlay:function(){var e=this.audioElement(),t;for(var n in this.codecs)t=e.canPlayType(this.codecs[n]),t!==""&&t!=="no"?this.supported[n]=!0:this.supported[n]=!1},audioElement:function(){return typeof Audio!="undefined"?new Audio(""):document.createElement("audio")},add:function(e,t){Crafty.support.audio=!!this.audioElement().canPlayType;if(!Crafty.support.audio)return;this.canPlay();var n,r,i;if(arguments.length===1&&typeof e=="object")for(var s in e)for(var o in e[s])n=this.audioElement(),n.id=s,n.preload="auto",n.volume=Crafty.audio.volume,i=e[s][o],r=i.substr(i.lastIndexOf(".")+1).toLowerCase(),this.supported[r]&&(n.src=i,Crafty.asset(i,n),this.sounds[s]={obj:n,played:0,volume:Crafty.audio.volume});if(typeof e=="string"){n=this.audioElement(),n.id=e,n.preload="auto",n.volume=Crafty.audio.volume,typeof t=="string"&&(r=t.substr(t.lastIndexOf(".")+1).toLowerCase(),this.supported[r]&&(n.src=t,Crafty.asset(t,n),this.sounds[e]={obj:n,played:0,volume:Crafty.audio.volume}));if(typeof t=="object")for(o in t)n=this.audioElement(),n.id=e,n.preload="auto",n.volume=Crafty.audio.volume,i=t[o],r=i.substr(i.lastIndexOf(".")+1).toLowerCase(),this.supported[r]&&(n.src=i,Crafty.asset(i,n),this.sounds[e]={obj:n,played:0,volume:Crafty.audio.volume})}},play:function(e,t,n){if(t==0||!Crafty.support.audio||!this.sounds[e])return;var r=this.sounds[e];r.volume=r.obj.volume=n||Crafty.audio.volume,r.obj.currentTime&&(r.obj.currentTime=0),this.muted&&(r.obj.volume=0),r.obj.play(),r.played++,r.obj.addEventListener("ended",function(){if(r.played<t||t==-1)this.currentTime&&(this.currentTime=0),this.play(),r.played++},!0)},stop:function(e){if(!Crafty.support.audio)return;var t;if(!e)for(var n in this.sounds)t=this.sounds[n],t.obj.paused||t.obj.pause();if(!this.sounds[e])return;t=this.sounds[e],t.obj.paused||t.obj.pause()},_mute:function(e){if(!Crafty.support.audio)return;var t;for(var n in this.sounds)t=this.sounds[n],t.obj.volume=e?0:t.volume;this.muted=e},toggleMute:function(){this.muted?this._mute(!1):this._mute(!0)},mute:function(){this._mute(!0)},unmute:function(){this._mute(!1)},pause:function(e){if(!Crafty.support.audio||!e||!this.sounds[e])return;var t=this.sounds[e];t.obj.paused||t.obj.pause()},unpause:function(e){if(!Crafty.support.audio||!e||!this.sounds[e])return;var t=this.sounds[e];t.obj.paused&&t.obj.play()},togglePause:function(e){if(!Crafty.support.audio||!e||!this.sounds[e])return;var t=this.sounds[e];t.obj.paused?t.obj.play():t.obj.pause()}}}),Crafty.c("Text",{_text:"",_textFont:{type:"",weight:"",size:"",family:""},ready:!0,init:function(){this.requires("2D"),this.bind("Draw",function(e){var t=this._textFont.type+" "+this._textFont.weight+" "+this._textFont.size+" "+this._textFont.family;if(e.type==="DOM"){var n=this._element,r=n.style;r.color=this._textColor,r.font=t,n.innerHTML=this._text}else if(e.type==="canvas"){var i=e.ctx,s=null;i.save(),i.fillStyle=this._textColor||"rgb(0,0,0)",i.font=t,i.translate(this.x,this.y+this.h),i.fillText(this._text,0,0),s=i.measureText(this._text),this._w=s.width,i.restore()}})},text:function(e){return typeof e=="undefined"||e===null?this._text:(typeof e=="function"?this._text=e.call(this):this._text=e,this.trigger("Change"),this)},textColor:function(e,t){return this._strength=t,this._textColor=Crafty.toRGB(e,this._strength),this.trigger("Change"),this},textFont:function(e,t){if(arguments.length===1){if(typeof e=="string")return this._textFont[e];if(typeof e=="object")for(propertyKey in e)this._textFont[propertyKey]=e[propertyKey]}else this._textFont[e]=t;return this.trigger("Change"),this}}),Crafty.extend({assets:{},asset:function(e,t){if(arguments.length===1)return Crafty.assets[e];Crafty.assets[e]||(Crafty.assets[e]=t,this.trigger("NewAsset",{key:e,value:t}))},load:function(e,t,n,r){function c(){var e=this.src;this.removeEventListener&&this.removeEventListener("canplaythrough",c,!1),++f,n&&n({loaded:f,total:a,percent:f/a*100,src:e}),f===a&&t&&t()}function h(){var e=this.src;r&&r({loaded:f,total:a,percent:f/a*100,src:e}),f++,f===a&&t&&t()}var i=0,s=e.length,o,u,a=s,f=0,l="";for(;i<s;++i){o=e[i],l=o.substr(o.lastIndexOf(".")+1).toLowerCase(),u=Crafty.asset(o)||null;if(Crafty.support.audio&&Crafty.audio.supported[l]){if(!u){var p=o.substr(o.lastIndexOf("/")+1).toLowerCase();u=Crafty.audio.audioElement(),u.id=p,u.src=o,u.preload="auto",u.volume=Crafty.audio.volume,Crafty.asset(o,u),Crafty.audio.sounds[p]={obj:u,played:0}}u.addEventListener&&u.addEventListener("canplaythrough",c,!1)}else{if(l!=="jpg"&&l!=="jpeg"&&l!=="gif"&&l!=="png"){a--;continue}u||(u=new Image,Crafty.asset(o,u)),u.onload=c,u.src=o}u.onerror=h}},modules:function(e,t,n){arguments.length===2&&typeof e=="object"&&(n=t,t=e,e="http://cdn.craftycomponents.com");var r=function(){function g(e,t,n){for(n=0,j=e.length;n<j;++n)if(!t(e[n]))return c;return 1}function y(e,t){g(e,function(e){return!t(e)})}function b(e,t,n){function d(e){return e.call?e():s[e]}function v(){if(!--p){s[c]=1,l&&l();for(var e in u)g(e.split("|"),d)&&!y(u[e],d)&&(u[e]=[])}}e=e[h]?e:[e];var i=t&&t.call,l=i?t:n,c=i?e.join(""):t,p=e.length;return setTimeout(function(){y(e,function(e){if(f[e])return c&&(o[c]=1),f[e]==2&&v();f[e]=1,c&&(o[c]=1),w(!r.test(e)&&a?a+e+".js":e,v)})},0),b}function w(e,r){var i=t.createElement("script"),s=c;i.onload=i.onerror=i[m]=function(){if(i[d]&&!/^c|loade/.test(i[d])||s)return;i.onload=i[m]=null,s=1,f[e]=2,r()},i.async=1,i.src=e,n.insertBefore(i,n.firstChild)}var e=this,t=document,n=t.getElementsByTagName("head")[0],r=/^https?:\/\//,i=e.$script,s={},o={},u={},a,f={},l="string",c=!1,h="push",p="DOMContentLoaded",d="readyState",v="addEventListener",m="onreadystatechange";return!t[d]&&t[v]&&(t[v](p,function E(){t.removeEventListener(p,E,c),t[d]="complete"},c),t[d]="loading"),b.get=w,b.order=function(e,t,n){(function r(i){i=e.shift(),e.length?b(i,r):b(i,t,n)})()},b.path=function(e){a=e},b.ready=function(e,t,n){e=e[h]?e:[e];var r=[];return!y(e,function(e){s[e]||r[h](e)})&&g(e,function(e){return s[e]})?t():!function(e){u[e]=u[e]||[],u[e][h](t),n&&n(r)}(e.join("|")),b},b.noConflict=function(){return e.$script=i,this},b}(),i=[],s=/^(https?|file):\/\//;for(var o in t)s.test(o)?i.push(o):i.push(e+"/"+o.toLowerCase()+"-"+t[o].toLowerCase()+".js");r(i,function(){n&&n()})}}),Crafty.math={abs:function(e){return e<0?-e:e},amountOf:function(e,t,n){return t<n?(e-t)/(n-t):(e-n)/(t-n)},clamp:function(e,t,n){return e>n?n:e<t?t:e},degToRad:function(e){return e*Math.PI/180},distance:function(e,t,n,r){var i=Crafty.math.squaredDistance(e,t,n,r);return Math.sqrt(parseFloat(i))},lerp:function(e,t,n){return e+(t-e)*n},negate:function(e){return Math.random()<e?-1:1},radToDeg:function(e){return e*180/Math.PI},randomElementOfArray:function(e){return e[Math.floor(e.length*Math.random())]},randomInt:function(e,t){return e+Math.floor((1+t-e)*Math.random())},randomNumber:function(e,t){return e+(t-e)*Math.random()},squaredDistance:function(e,t,n,r){return(e-n)*(e-n)+(t-r)*(t-r)},withinRange:function(e,t,n){return e>=t&&e<=n}},Crafty.math.Vector2D=function(){function e(t,n){if(t instanceof e)this.x=t.x,this.y=t.y;else if(arguments.length===2)this.x=t,this.y=n;else if(arguments.length>0)throw"Unexpected number of arguments for Vector2D()"}return e.prototype.x=0,e.prototype.y=0,e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.angleBetween=function(e){return Math.atan2(this.x*e.y-this.y*e.x,this.x*e.x+this.y*e.y)},e.prototype.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},e.prototype.clone=function(){return new e(this)},e.prototype.distance=function(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))},e.prototype.distanceSq=function(e){return(e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)},e.prototype.divide=function(e){return this.x/=e.x,this.y/=e.y,this},e.prototype.dotProduct=function(e){return this.x*e.x+this.y*e.y},e.prototype.equals=function(t){return t instanceof e&&this.x==t.x&&this.y==t.y},e.prototype.getNormal=function(t){return t===undefined?new e(-this.y,this.x):(new e(t.y-this.y,this.x-t.x)).normalize()},e.prototype.isZero=function(){return this.x===0&&this.y===0},e.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.magnitudeSq=function(){return this.x*this.x+this.y*this.y},e.prototype.multiply=function(e){return this.x*=e.x,this.y*=e.y,this},e.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},e.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);return e===0?(this.x=1,this.y=0):(this.x/=e,this.y/=e),this},e.prototype.scale=function(e,t){return t===undefined&&(t=e),this.x*=e,this.y*=t,this},e.prototype.scaleToMagnitude=function(e){var t=e/this.magnitude();return this.x*=t,this.y*=t,this},e.prototype.setValues=function(t,n){return t instanceof e?(this.x=t.x,this.y=t.y):(this.x=t,this.y=n),this},e.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.toString=function(){return"Vector2D("+this.x+", "+this.y+")"},e.prototype.translate=function(e,t){return t===undefined&&(t=e),this.x+=e,this.y+=t,this},e.tripleProduct=function(e,t,n){var r=e.dotProduct(n),i=t.dotProduct(n);return new Crafty.math.Vector2D(t.x*r-e.x*i,t.y*r-e.y*i)},e}(),Crafty.math.Matrix2D=function(){return Matrix2D=function(e,t,n,r,i,s){if(e instanceof Matrix2D)this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.e=e.e,this.f=e.f;else if(arguments.length===6)this.a=e,this.b=t,this.c=n,this.d=r,this.e=i,this.f=s;else if(arguments.length>0)throw"Unexpected number of arguments for Matrix2D()"},Matrix2D.prototype.a=1,Matrix2D.prototype.b=0,Matrix2D.prototype.c=0,Matrix2D.prototype.d=1,Matrix2D.prototype.e=0,Matrix2D.prototype.f=0,Matrix2D.prototype.apply=function(e){var t=e.x;return e.x=t*this.a+e.y*this.c+this.e,e.y=t*this.b+e.y*this.d+this.f,e},Matrix2D.prototype.clone=function(){return new Matrix2D(this)},Matrix2D.prototype.combine=function(e){var t=this.a;return this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,t=this.c,this.c=t*e.a+this.d*e.c,this.d=t*e.b+this.d*e.d,t=this.e,this.e=t*e.a+this.f*e.c+e.e,this.f=t*e.b+this.f*e.d+e.f,this},Matrix2D.prototype.equals=function(e){return e instanceof Matrix2D&&this.a==e.a&&this.b==e.b&&this.c==e.c&&this.d==e.d&&this.e==e.e&&this.f==e.f},Matrix2D.prototype.determinant=function(){return this.a*this.d-this.b*this.c},Matrix2D.prototype.invert=function(){var e=this.determinant();if(e!==0){var t={a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f};this.a=t.d/e,this.b=-t.b/e,this.c=-t.c/e,this.d=t.a/e,this.e=(t.c*t.f-t.e*t.d)/e,this.f=(t.e*t.b-t.a*t.f)/e}return this},Matrix2D.prototype.isIdentity=function(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.e===0&&this.f===0},Matrix2D.prototype.isInvertible=function(){return this.determinant()!==0},Matrix2D.prototype.preRotate=function(e){var t=Math.cos(e),n=Math.sin(e),r=this.a;return this.a=t*r-n*this.b,this.b=n*r+t*this.b,r=this.c,this.c=t*r-n*this.d,this.d=n*r+t*this.d,this},Matrix2D.prototype.preScale=function(e,t){return t===undefined&&(t=e),this.a*=e,this.b*=t,this.c*=e,this.d*=t,this},Matrix2D.prototype.preTranslate=function(e,t){return typeof e=="number"?(this.e+=e,this.f+=t):(this.e+=e.x,this.f+=e.y),this},Matrix2D.prototype.rotate=function(e){var t=Math.cos(e),n=Math.sin(e),r=this.a;return this.a=t*r-n*this.b,this.b=n*r+t*this.b,r=this.c,this.c=t*r-n*this.d,this.d=n*r+t*this.d,r=this.e,this.e=t*r-n*this.f,this.f=n*r+t*this.f,this},Matrix2D.prototype.scale=function(e,t){return t===undefined&&(t=e),this.a*=e,this.b*=t,this.c*=e,this.d*=t,this.e*=e,this.f*=t,this},Matrix2D.prototype.setValues=function(e,t,n,r,i,s){return e instanceof Matrix2D?(this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.e=e.e,this.f=e.f):(this.a=e,this.b=t,this.c=n,this.d=r,this.e=i,this.f=s),this},Matrix2D.prototype.toString=function(){return"Matrix2D(["+this.a+", "+this.c+", "+this.e+"] ["+this.b+", "+this.d+", "+this.f+"] [0, 0, 1])"},Matrix2D.prototype.translate=function(e,t){return typeof e=="number"?(this.e+=this.a*e+this.c*t,this.f+=this.b*e+this.d*t):(this.e+=this.a*e.x+this.c*e.y,this.f+=this.b*e.x+this.d*e.y),this},Matrix2D}(),Crafty.c("Delay",{init:function(){this._delays=[],this.bind("EnterFrame",function(){var e=(new Date).getTime();for(var t in this._delays){var n=this._delays[t];!n.triggered&&n.start+n.delay+n.pause<e&&(n.triggered=!0,n.func.call(this))}}),this.bind("Pause",function(){var e=(new Date).getTime();for(var t in this._delays)this._delays[t].pauseBuffer=e}),this.bind("Unpause",function(){var e=(new Date).getTime();for(var t in this._delays){var n=this._delays[t];n.pause+=e-n.pauseBuffer}})},delay:function(e,t){return this._delays.push({start:(new Date).getTime(),func:e,delay:t,triggered:!1,pauseBuffer:0,pause:0})}})}),Crafty}),define("config",[],function(){return{canvas:{width:800,height:640},pixelPerMeter:32}}),define("box2dweb",[],function(){var e={};(function(e,t){function n(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(e,t,n){n.get instanceof Function&&e.__defineGetter__(t,n.get),n.set instanceof Function&&e.__defineSetter__(t,n.set)}),e.inherit=function(e,t){var r=e;n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=r},e.generateCallback=function(t,n){return function(){n.apply(t,arguments)}},e.NVector=function(n){n===t&&(n=0);var r=new Array(n||0);for(var i=0;i<n;++i)r[i]=0;return r},e.is=function(n,r){return n===null?!1:r instanceof Function&&n instanceof r?!0:n.constructor.__implements!=t&&n.constructor.__implements[r]?!0:!1},e.parseUInt=function(e){return Math.abs(parseInt(e))}})(e);var t=Array,n=e.NVector;typeof e=="undefined"&&(e={}),typeof e.Collision=="undefined"&&(e.Collision={}),typeof e.Collision.Shapes=="undefined"&&(e.Collision.Shapes={}),typeof e.Common=="undefined"&&(e.Common={}),typeof e.Common.Math=="undefined"&&(e.Common.Math={}),typeof e.Dynamics=="undefined"&&(e.Dynamics={}),typeof e.Dynamics.Contacts=="undefined"&&(e.Dynamics.Contacts={}),typeof e.Dynamics.Controllers=="undefined"&&(e.Dynamics.Controllers={}),typeof e.Dynamics.Joints=="undefined"&&(e.Dynamics.Joints={}),function(){function t(){t.b2AABB.apply(this,arguments)}function n(){n.b2Bound.apply(this,arguments)}function r(){r.b2BoundValues.apply(this,arguments),this.constructor===r&&this.b2BoundValues.apply(this,arguments)}function i(){i.b2Collision.apply(this,arguments)}function s(){s.b2ContactID.apply(this,arguments),this.constructor===s&&this.b2ContactID.apply(this,arguments)}function o(){o.b2ContactPoint.apply(this,arguments)}function u(){u.b2Distance.apply(this,arguments)}function a(){a.b2DistanceInput.apply(this,arguments)}function f(){f.b2DistanceOutput.apply(this,arguments)}function l(){l.b2DistanceProxy.apply(this,arguments)}function c(){c.b2DynamicTree.apply(this,arguments),this.constructor===c&&this.b2DynamicTree.apply(this,arguments)}function h(){h.b2DynamicTreeBroadPhase.apply(this,arguments)}function p(){p.b2DynamicTreeNode.apply(this,arguments)}function d(){d.b2DynamicTreePair.apply(this,arguments)}function v(){v.b2Manifold.apply(this,arguments),this.constructor===v&&this.b2Manifold.apply(this,arguments)}function m(){m.b2ManifoldPoint.apply(this,arguments),this.constructor===m&&this.b2ManifoldPoint.apply(this,arguments)}function g(){g.b2Point.apply(this,arguments)}function y(){y.b2RayCastInput.apply(this,arguments),this.constructor===y&&this.b2RayCastInput.apply(this,arguments)}function b(){b.b2RayCastOutput.apply(this,arguments)}function w(){w.b2Segment.apply(this,arguments)}function E(){E.b2SeparationFunction.apply(this,arguments)}function S(){S.b2Simplex.apply(this,arguments),this.constructor===S&&this.b2Simplex.apply(this,arguments)}function x(){x.b2SimplexCache.apply(this,arguments)}function T(){T.b2SimplexVertex.apply(this,arguments)}function N(){N.b2TimeOfImpact.apply(this,arguments)}function C(){C.b2TOIInput.apply(this,arguments)}function k(){k.b2WorldManifold.apply(this,arguments),this.constructor===k&&this.b2WorldManifold.apply(this,arguments)}function L(){L.ClipVertex.apply(this,arguments)}function A(){A.Features.apply(this,arguments)}function O(){O.b2CircleShape.apply(this,arguments),this.constructor===O&&this.b2CircleShape.apply(this,arguments)}function M(){M.b2EdgeChainDef.apply(this,arguments),this.constructor===M&&this.b2EdgeChainDef.apply(this,arguments)}function _(){_.b2EdgeShape.apply(this,arguments),this.constructor===_&&this.b2EdgeShape.apply(this,arguments)}function D(){D.b2MassData.apply(this,arguments)}function P(){P.b2PolygonShape.apply(this,arguments),this.constructor===P&&this.b2PolygonShape.apply(this,arguments)}function H(){H.b2Shape.apply(this,arguments),this.constructor===H&&this.b2Shape.apply(this,arguments)}function B(){B.b2Color.apply(this,arguments),this.constructor===B&&this.b2Color.apply(this,arguments)}function j(){j.b2Settings.apply(this,arguments)}function F(){F.b2Mat22.apply(this,arguments),this.constructor===F&&this.b2Mat22.apply(this,arguments)}function I(){I.b2Mat33.apply(this,arguments),this.constructor===I&&this.b2Mat33.apply(this,arguments)}function q(){q.b2Math.apply(this,arguments)}function R(){R.b2Sweep.apply(this,arguments)}function U(){U.b2Transform.apply(this,arguments),this.constructor===U&&this.b2Transform.apply(this,arguments)}function z(){z.b2Vec2.apply(this,arguments),this.constructor===z&&this.b2Vec2.apply(this,arguments)}function W(){W.b2Vec3.apply(this,arguments),this.constructor===W&&this.b2Vec3.apply(this,arguments)}function X(){X.b2Body.apply(this,arguments),this.constructor===X&&this.b2Body.apply(this,arguments)}function V(){V.b2BodyDef.apply(this,arguments),this.constructor===V&&this.b2BodyDef.apply(this,arguments)}function $(){$.b2ContactFilter.apply(this,arguments)}function J(){J.b2ContactImpulse.apply(this,arguments)}function K(){K.b2ContactListener.apply(this,arguments)}function Q(){Q.b2ContactManager.apply(this,arguments),this.constructor===Q&&this.b2ContactManager.apply(this,arguments)}function G(){G.b2DebugDraw.apply(this,arguments),this.constructor===G&&this.b2DebugDraw.apply(this,arguments)}function Y(){Y.b2DestructionListener.apply(this,arguments)}function Z(){Z.b2FilterData.apply(this,arguments)}function et(){et.b2Fixture.apply(this,arguments),this.constructor===et&&this.b2Fixture.apply(this,arguments)}function tt(){tt.b2FixtureDef.apply(this,arguments),this.constructor===tt&&this.b2FixtureDef.apply(this,arguments)}function nt(){nt.b2Island.apply(this,arguments),this.constructor===nt&&this.b2Island.apply(this,arguments)}function rt(){rt.b2TimeStep.apply(this,arguments)}function it(){it.b2World.apply(this,arguments),this.constructor===it&&this.b2World.apply(this,arguments)}function st(){st.b2CircleContact.apply(this,arguments)}function ot(){ot.b2Contact.apply(this,arguments),this.constructor===ot&&this.b2Contact.apply(this,arguments)}function ut(){ut.b2ContactConstraint.apply(this,arguments),this.constructor===ut&&this.b2ContactConstraint.apply(this,arguments)}function at(){at.b2ContactConstraintPoint.apply(this,arguments)}function ft(){ft.b2ContactEdge.apply(this,arguments)}function lt(){lt.b2ContactFactory.apply(this,arguments),this.constructor===lt&&this.b2ContactFactory.apply(this,arguments)}function ct(){ct.b2ContactRegister.apply(this,arguments)}function ht(){ht.b2ContactResult.apply(this,arguments)}function pt(){pt.b2ContactSolver.apply(this,arguments),this.constructor===pt&&this.b2ContactSolver.apply(this,arguments)}function dt(){dt.b2EdgeAndCircleContact.apply(this,arguments)}function vt(){vt.b2NullContact.apply(this,arguments),this.constructor===vt&&this.b2NullContact.apply(this,arguments)}function mt(){mt.b2PolyAndCircleContact.apply(this,arguments)}function gt(){gt.b2PolyAndEdgeContact.apply(this,arguments)}function yt(){yt.b2PolygonContact.apply(this,arguments)}function bt(){bt.b2PositionSolverManifold.apply(this,arguments),this.constructor===bt&&this.b2PositionSolverManifold.apply(this,arguments)}function wt(){wt.b2BuoyancyController.apply(this,arguments)}function Et(){Et.b2ConstantAccelController.apply(this,arguments)}function St(){St.b2ConstantForceController.apply(this,arguments)}function xt(){xt.b2Controller.apply(this,arguments)}function Tt(){Tt.b2ControllerEdge.apply(this,arguments)}function Nt(){Nt.b2GravityController.apply(this,arguments)}function Ct(){Ct.b2TensorDampingController.apply(this,arguments)}function kt(){kt.b2DistanceJoint.apply(this,arguments),this.constructor===kt&&this.b2DistanceJoint.apply(this,arguments)}function Lt(){Lt.b2DistanceJointDef.apply(this,arguments),this.constructor===Lt&&this.b2DistanceJointDef.apply(this,arguments)}function At(){At.b2FrictionJoint.apply(this,arguments),this.constructor===At&&this.b2FrictionJoint.apply(this,arguments)}function Ot(){Ot.b2FrictionJointDef.apply(this,arguments),this.constructor===Ot&&this.b2FrictionJointDef.apply(this,arguments)}function Mt(){Mt.b2GearJoint.apply(this,arguments),this.constructor===Mt&&this.b2GearJoint.apply(this,arguments)}function _t(){_t.b2GearJointDef.apply(this,arguments),this.constructor===_t&&this.b2GearJointDef.apply(this,arguments)}function Dt(){Dt.b2Jacobian.apply(this,arguments)}function Pt(){Pt.b2Joint.apply(this,arguments),this.constructor===Pt&&this.b2Joint.apply(this,arguments)}function Ht(){Ht.b2JointDef.apply(this,arguments),this.constructor===Ht&&this.b2JointDef.apply(this,arguments)}function Bt(){Bt.b2JointEdge.apply(this,arguments)}function jt(){jt.b2LineJoint.apply(this,arguments),this.constructor===jt&&this.b2LineJoint.apply(this,arguments)}function Ft(){Ft.b2LineJointDef.apply(this,arguments),this.constructor===Ft&&this.b2LineJointDef.apply(this,arguments)}function It(){It.b2MouseJoint.apply(this,arguments),this.constructor===It&&this.b2MouseJoint.apply(this,arguments)}function qt(){qt.b2MouseJointDef.apply(this,arguments),this.constructor===qt&&this.b2MouseJointDef.apply(this,arguments)}function Rt(){Rt.b2PrismaticJoint.apply(this,arguments),this.constructor===Rt&&this.b2PrismaticJoint.apply(this,arguments)}function Ut(){Ut.b2PrismaticJointDef.apply(this,arguments),this.constructor===Ut&&this.b2PrismaticJointDef.apply(this,arguments)}function zt(){zt.b2PulleyJoint.apply(this,arguments),this.constructor===zt&&this.b2PulleyJoint.apply(this,arguments)}function Wt(){Wt.b2PulleyJointDef.apply(this,arguments),this.constructor===Wt&&this.b2PulleyJointDef.apply(this,arguments)}function Xt(){Xt.b2RevoluteJoint.apply(this,arguments),this.constructor===Xt&&this.b2RevoluteJoint.apply(this,arguments)}function Vt(){Vt.b2RevoluteJointDef.apply(this,arguments),this.constructor===Vt&&this.b2RevoluteJointDef.apply(this,arguments)}function $t(){$t.b2WeldJoint.apply(this,arguments),this.constructor===$t&&this.b2WeldJoint.apply(this,arguments)}function Jt(){Jt.b2WeldJointDef.apply(this,arguments),this.constructor===Jt&&this.b2WeldJointDef.apply(this,arguments)}e.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",e.Collision.b2AABB=t,e.Collision.b2Bound=n,e.Collision.b2BoundValues=r,e.Collision.b2Collision=i,e.Collision.b2ContactID=s,e.Collision.b2ContactPoint=o,e.Collision.b2Distance=u,e.Collision.b2DistanceInput=a,e.Collision.b2DistanceOutput=f,e.Collision.b2DistanceProxy=l,e.Collision.b2DynamicTree=c,e.Collision.b2DynamicTreeBroadPhase=h,e.Collision.b2DynamicTreeNode=p,e.Collision.b2DynamicTreePair=d,e.Collision.b2Manifold=v,e.Collision.b2ManifoldPoint=m,e.Collision.b2Point=g,e.Collision.b2RayCastInput=y,e.Collision.b2RayCastOutput=b,e.Collision.b2Segment=w,e.Collision.b2SeparationFunction=E,e.Collision.b2Simplex=S,e.Collision.b2SimplexCache=x,e.Collision.b2SimplexVertex=T,e.Collision.b2TimeOfImpact=N,e.Collision.b2TOIInput=C,e.Collision.b2WorldManifold=k,e.Collision.ClipVertex=L,e.Collision.Features=A,e.Collision.Shapes.b2CircleShape=O,e.Collision.Shapes.b2EdgeChainDef=M,e.Collision.Shapes.b2EdgeShape=_,e.Collision.Shapes.b2MassData=D,e.Collision.Shapes.b2PolygonShape=P,e.Collision.Shapes.b2Shape=H,e.Common.b2internal="Box2D.Common.b2internal",e.Common.b2Color=B,e.Common.b2Settings=j,e.Common.Math.b2Mat22=F,e.Common.Math.b2Mat33=I,e.Common.Math.b2Math=q,e.Common.Math.b2Sweep=R,e.Common.Math.b2Transform=U,e.Common.Math.b2Vec2=z,e.Common.Math.b2Vec3=W,e.Dynamics.b2Body=X,e.Dynamics.b2BodyDef=V,e.Dynamics.b2ContactFilter=$,e.Dynamics.b2ContactImpulse=J,e.Dynamics.b2ContactListener=K,e.Dynamics.b2ContactManager=Q,e.Dynamics.b2DebugDraw=G,e.Dynamics.b2DestructionListener=Y,e.Dynamics.b2FilterData=Z,e.Dynamics.b2Fixture=et,e.Dynamics.b2FixtureDef=tt,e.Dynamics.b2Island=nt,e.Dynamics.b2TimeStep=rt,e.Dynamics.b2World=it,e.Dynamics.Contacts.b2CircleContact=st,e.Dynamics.Contacts.b2Contact=ot,e.Dynamics.Contacts.b2ContactConstraint=ut,e.Dynamics.Contacts.b2ContactConstraintPoint=at,e.Dynamics.Contacts.b2ContactEdge=ft,e.Dynamics.Contacts.b2ContactFactory=lt,e.Dynamics.Contacts.b2ContactRegister=ct,e.Dynamics.Contacts.b2ContactResult=ht,e.Dynamics.Contacts.b2ContactSolver=pt,e.Dynamics.Contacts.b2EdgeAndCircleContact=dt,e.Dynamics.Contacts.b2NullContact=vt,e.Dynamics.Contacts.b2PolyAndCircleContact=mt,e.Dynamics.Contacts.b2PolyAndEdgeContact=gt,e.Dynamics.Contacts.b2PolygonContact=yt,e.Dynamics.Contacts.b2PositionSolverManifold=bt,e.Dynamics.Controllers.b2BuoyancyController=wt,e.Dynamics.Controllers.b2ConstantAccelController=Et,e.Dynamics.Controllers.b2ConstantForceController=St,e.Dynamics.Controllers.b2Controller=xt,e.Dynamics.Controllers.b2ControllerEdge=Tt,e.Dynamics.Controllers.b2GravityController=Nt,e.Dynamics.Controllers.b2TensorDampingController=Ct,e.Dynamics.Joints.b2DistanceJoint=kt,e.Dynamics.Joints.b2DistanceJointDef=Lt,e.Dynamics.Joints.b2FrictionJoint=At,e.Dynamics.Joints.b2FrictionJointDef=Ot,e.Dynamics.Joints.b2GearJoint=Mt,e.Dynamics.Joints.b2GearJointDef=_t,e.Dynamics.Joints.b2Jacobian=Dt,e.Dynamics.Joints.b2Joint=Pt,e.Dynamics.Joints.b2JointDef=Ht,e.Dynamics.Joints.b2JointEdge=Bt,e.Dynamics.Joints.b2LineJoint=jt,e.Dynamics.Joints.b2LineJointDef=Ft,e.Dynamics.Joints.b2MouseJoint=It,e.Dynamics.Joints.b2MouseJointDef=qt,e.Dynamics.Joints.b2PrismaticJoint=Rt,e.Dynamics.Joints.b2PrismaticJointDef=Ut,e.Dynamics.Joints.b2PulleyJoint=zt,e.Dynamics.Joints.b2PulleyJointDef=Wt,e.Dynamics.Joints.b2RevoluteJoint=Xt,e.Dynamics.Joints.b2RevoluteJointDef=Vt,e.Dynamics.Joints.b2WeldJoint=$t,e.Dynamics.Joints.b2WeldJointDef=Jt}(),e.postDefs=[],function(){var r=e.Collision.Shapes.b2CircleShape,i=e.Collision.Shapes.b2EdgeChainDef,s=e.Collision.Shapes.b2EdgeShape,o=e.Collision.Shapes.b2MassData,u=e.Collision.Shapes.b2PolygonShape,a=e.Collision.Shapes.b2Shape,f=e.Common.b2Color,l=e.Common.b2internal,c=e.Common.b2Settings,h=e.Common.Math.b2Mat22,p=e.Common.Math.b2Mat33,d=e.Common.Math.b2Math,v=e.Common.Math.b2Sweep,m=e.Common.Math.b2Transform,g=e.Common.Math.b2Vec2,y=e.Common.Math.b2Vec3,b=e.Collision.b2AABB,w=e.Collision.b2Bound,E=e.Collision.b2BoundValues,S=e.Collision.b2Collision,x=e.Collision.b2ContactID,T=e.Collision.b2ContactPoint,N=e.Collision.b2Distance,C=e.Collision.b2DistanceInput,k=e.Collision.b2DistanceOutput,L=e.Collision.b2DistanceProxy,A=e.Collision.b2DynamicTree,O=e.Collision.b2DynamicTreeBroadPhase,M=e.Collision.b2DynamicTreeNode,_=e.Collision.b2DynamicTreePair,D=e.Collision.b2Manifold,P=e.Collision.b2ManifoldPoint,H=e.Collision.b2Point,B=e.Collision.b2RayCastInput,j=e.Collision.b2RayCastOutput,F=e.Collision.b2Segment,I=e.Collision.b2SeparationFunction,q=e.Collision.b2Simplex,R=e.Collision.b2SimplexCache,U=e.Collision.b2SimplexVertex,z=e.Collision.b2TimeOfImpact,W=e.Collision.b2TOIInput,X=e.Collision.b2WorldManifold,V=e.Collision.ClipVertex,$=e.Collision.Features,J=e.Collision.IBroadPhase;b.b2AABB=function(){this.lowerBound=new g,this.upperBound=new g},b.prototype.IsValid=function(){var e=this.upperBound.x-this.lowerBound.x,t=this.upperBound.y-this.lowerBound.y,n=e>=0&&t>=0;return n=n&&this.lowerBound.IsValid()&&this.upperBound.IsValid(),n},b.prototype.GetCenter=function(){return new g((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},b.prototype.GetExtents=function(){return new g((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},b.prototype.Contains=function(e){var t=!0;return t=t&&this.lowerBound.x<=e.lowerBound.x,t=t&&this.lowerBound.y<=e.lowerBound.y,t=t&&e.upperBound.x<=this.upperBound.x,t=t&&e.upperBound.y<=this.upperBound.y,t},b.prototype.RayCast=function(e,t){var n=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=t.p1.x,s=t.p1.y,o=t.p2.x-t.p1.x,u=t.p2.y-t.p1.y,a=Math.abs(o),f=Math.abs(u),l=e.normal,c=0,h=0,p=0,d=0,v=0;if(a<Number.MIN_VALUE){if(i<this.lowerBound.x||this.upperBound.x<i)return!1}else{c=1/o,h=(this.lowerBound.x-i)*c,p=(this.upperBound.x-i)*c,v=-1,h>p&&(d=h,h=p,p=d,v=1),h>n&&(l.x=v,l.y=0,n=h),r=Math.min(r,p);if(n>r)return!1}if(f<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{c=1/u,h=(this.lowerBound.y-s)*c,p=(this.upperBound.y-s)*c,v=-1,h>p&&(d=h,h=p,p=d,v=1),h>n&&(l.y=v,l.x=0,n=h),r=Math.min(r,p);if(n>r)return!1}return e.fraction=n,!0},b.prototype.TestOverlap=function(e){var t=e.lowerBound.x-this.upperBound.x,n=e.lowerBound.y-this.upperBound.y,r=this.lowerBound.x-e.upperBound.x,i=this.lowerBound.y-e.upperBound.y;return t>0||n>0?!1:r>0||i>0?!1:!0},b.Combine=function(e,t){var n=new b;return n.Combine(e,t),n},b.prototype.Combine=function(e,t){this.lowerBound.x=Math.min(e.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(e.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(e.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(e.upperBound.y,t.upperBound.y)},w.b2Bound=function(){},w.prototype.IsLower=function(){return(this.value&1)==0},w.prototype.IsUpper=function(){return(this.value&1)==1},w.prototype.Swap=function(e){var t=this.value,n=this.proxy,r=this.stabbingCount;this.value=e.value,this.proxy=e.proxy,this.stabbingCount=e.stabbingCount,e.value=t,e.proxy=n,e.stabbingCount=r},E.b2BoundValues=function(){},E.prototype.b2BoundValues=function(){this.lowerValues=new n,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new n,this.upperValues[0]=0,this.upperValues[1]=0},S.b2Collision=function(){},S.ClipSegmentToLine=function(e,t,n,r){r===undefined&&(r=0);var i,s=0;i=t[0];var o=i.v;i=t[1];var u=i.v,a=n.x*o.x+n.y*o.y-r,f=n.x*u.x+n.y*u.y-r;a<=0&&e[s++].Set(t[0]),f<=0&&e[s++].Set(t[1]);if(a*f<0){var l=a/(a-f);i=e[s];var c=i.v;c.x=o.x+l*(u.x-o.x),c.y=o.y+l*(u.y-o.y),i=e[s];var h;a>0?(h=t[0],i.id=h.id):(h=t[1],i.id=h.id),++s}return s},S.EdgeSeparation=function(e,t,n,r,i){n===undefined&&(n=0);var s=parseInt(e.m_vertexCount),o=e.m_vertices,u=e.m_normals,a=parseInt(r.m_vertexCount),f=r.m_vertices,l,c;l=t.R,c=u[n];var h=l.col1.x*c.x+l.col2.x*c.y,p=l.col1.y*c.x+l.col2.y*c.y;l=i.R;var d=l.col1.x*h+l.col1.y*p,v=l.col2.x*h+l.col2.y*p,m=0,g=Number.MAX_VALUE;for(var y=0;y<a;++y){c=f[y];var b=c.x*d+c.y*v;b<g&&(g=b,m=y)}c=o[n],l=t.R;var w=t.position.x+(l.col1.x*c.x+l.col2.x*c.y),E=t.position.y+(l.col1.y*c.x+l.col2.y*c.y);c=f[m],l=i.R;var S=i.position.x+(l.col1.x*c.x+l.col2.x*c.y),x=i.position.y+(l.col1.y*c.x+l.col2.y*c.y);S-=w,x-=E;var T=S*h+x*p;return T},S.FindMaxSeparation=function(e,t,n,r,i){var s=parseInt(t.m_vertexCount),o=t.m_normals,u,a;a=i.R,u=r.m_centroid;var f=i.position.x+(a.col1.x*u.x+a.col2.x*u.y),l=i.position.y+(a.col1.y*u.x+a.col2.y*u.y);a=n.R,u=t.m_centroid,f-=n.position.x+(a.col1.x*u.x+a.col2.x*u.y),l-=n.position.y+(a.col1.y*u.x+a.col2.y*u.y);var c=f*n.R.col1.x+l*n.R.col1.y,h=f*n.R.col2.x+l*n.R.col2.y,p=0,d=-Number.MAX_VALUE;for(var v=0;v<s;++v){u=o[v];var m=u.x*c+u.y*h;m>d&&(d=m,p=v)}var g=S.EdgeSeparation(t,n,p,r,i),y=parseInt(p-1>=0?p-1:s-1),b=S.EdgeSeparation(t,n,y,r,i),w=parseInt(p+1<s?p+1:0),E=S.EdgeSeparation(t,n,w,r,i),x=0,T=0,N=0;if(b>g&&b>E)N=-1,x=y,T=b;else{if(!(E>g))return e[0]=p,g;N=1,x=w,T=E}for(;;){N==-1?p=x-1>=0?x-1:s-1:p=x+1<s?x+1:0,g=S.EdgeSeparation(t,n,p,r,i);if(!(g>T))break;x=p,T=g}return e[0]=x,T},S.FindIncidentEdge=function(e,t,n,r,i,s){r===undefined&&(r=0);var o=parseInt(t.m_vertexCount),u=t.m_normals,a=parseInt(i.m_vertexCount),f=i.m_vertices,l=i.m_normals,c,h;c=n.R,h=u[r];var p=c.col1.x*h.x+c.col2.x*h.y,d=c.col1.y*h.x+c.col2.y*h.y;c=s.R;var v=c.col1.x*p+c.col1.y*d;d=c.col2.x*p+c.col2.y*d,p=v;var m=0,g=Number.MAX_VALUE;for(var y=0;y<a;++y){h=l[y];var b=p*h.x+d*h.y;b<g&&(g=b,m=y)}var w,E=parseInt(m),S=parseInt(E+1<a?E+1:0);w=e[0],h=f[E],c=s.R,w.v.x=s.position.x+(c.col1.x*h.x+c.col2.x*h.y),w.v.y=s.position.y+(c.col1.y*h.x+c.col2.y*h.y),w.id.features.referenceEdge=r,w.id.features.incidentEdge=E,w.id.features.incidentVertex=0,w=e[1],h=f[S],c=s.R,w.v.x=s.position.x+(c.col1.x*h.x+c.col2.x*h.y),w.v.y=s.position.y+(c.col1.y*h.x+c.col2.y*h.y),w.id.features.referenceEdge=r,w.id.features.incidentEdge=S,w.id.features.incidentVertex=1},S.MakeClipPointVector=function(){var e=new t(2);return e[0]=new V,e[1]=new V,e},S.CollidePolygons=function(e,t,n,r,i){var s;e.m_pointCount=0;var o=t.m_radius+r.m_radius,u=0;S.s_edgeAO[0]=u;var a=S.FindMaxSeparation(S.s_edgeAO,t,n,r,i);u=S.s_edgeAO[0];if(a>o)return;var f=0;S.s_edgeBO[0]=f;var l=S.FindMaxSeparation(S.s_edgeBO,r,i,t,n);f=S.s_edgeBO[0];if(l>o)return;var h,p,d,v,m=0,g=0,y=.98,b=.001,w;l>y*a+b?(h=r,p=t,d=i,v=n,m=f,e.m_type=D.e_faceB,g=1):(h=t,p=r,d=n,v=i,m=u,e.m_type=D.e_faceA,g=0);var E=S.s_incidentEdge;S.FindIncidentEdge(E,h,d,m,p,v);var x=parseInt(h.m_vertexCount),T=h.m_vertices,N=T[m],C;m+1<x?C=T[parseInt(m+1)]:C=T[0];var k=S.s_localTangent;k.Set(C.x-N.x,C.y-N.y),k.Normalize();var L=S.s_localNormal;L.x=k.y,L.y=-k.x;var A=S.s_planePoint;A.Set(.5*(N.x+C.x),.5*(N.y+C.y));var O=S.s_tangent;w=d.R,O.x=w.col1.x*k.x+w.col2.x*k.y,O.y=w.col1.y*k.x+w.col2.y*k.y;var M=S.s_tangent2;M.x=-O.x,M.y=-O.y;var _=S.s_normal;_.x=O.y,_.y=-O.x;var P=S.s_v11,H=S.s_v12;P.x=d.position.x+(w.col1.x*N.x+w.col2.x*N.y),P.y=d.position.y+(w.col1.y*N.x+w.col2.y*N.y),H.x=d.position.x+(w.col1.x*C.x+w.col2.x*C.y),H.y=d.position.y+(w.col1.y*C.x+w.col2.y*C.y);var B=_.x*P.x+_.y*P.y,j=-O.x*P.x-O.y*P.y+o,F=O.x*H.x+O.y*H.y+o,I=S.s_clipPoints1,q=S.s_clipPoints2,R=0;R=S.ClipSegmentToLine(I,E,M,j);if(R<2)return;R=S.ClipSegmentToLine(q,I,O,F);if(R<2)return;e.m_localPlaneNormal.SetV(L),e.m_localPoint.SetV(A);var U=0;for(var z=0;z<c.b2_maxManifoldPoints;++z){s=q[z];var W=_.x*s.v.x+_.y*s.v.y-B;if(W<=o){var X=e.m_points[U];w=v.R;var V=s.v.x-v.position.x,$=s.v.y-v.position.y;X.m_localPoint.x=V*w.col1.x+$*w.col1.y,X.m_localPoint.y=V*w.col2.x+$*w.col2.y,X.m_id.Set(s.id),X.m_id.features.flip=g,++U}}e.m_pointCount=U},S.CollideCircles=function(e,t,n,r,i){e.m_pointCount=0;var s,o;s=n.R,o=t.m_p;var u=n.position.x+(s.col1.x*o.x+s.col2.x*o.y),a=n.position.y+(s.col1.y*o.x+s.col2.y*o.y);s=i.R,o=r.m_p;var f=i.position.x+(s.col1.x*o.x+s.col2.x*o.y),l=i.position.y+(s.col1.y*o.x+s.col2.y*o.y),c=f-u,h=l-a,p=c*c+h*h,d=t.m_radius+r.m_radius;if(p>d*d)return;e.m_type=D.e_circles,e.m_localPoint.SetV(t.m_p),e.m_localPlaneNormal.SetZero(),e.m_pointCount=1,e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0},S.CollidePolygonAndCircle=function(e,t,n,r,i){e.m_pointCount=0;var s,o=0,u=0,a=0,f=0,l,c;c=i.R,l=r.m_p;var h=i.position.x+(c.col1.x*l.x+c.col2.x*l.y),p=i.position.y+(c.col1.y*l.x+c.col2.y*l.y);o=h-n.position.x,u=p-n.position.y,c=n.R;var d=o*c.col1.x+u*c.col1.y,v=o*c.col2.x+u*c.col2.y,m=0,g=0,y=-Number.MAX_VALUE,b=t.m_radius+r.m_radius,w=parseInt(t.m_vertexCount),E=t.m_vertices,S=t.m_normals;for(var x=0;x<w;++x){l=E[x],o=d-l.x,u=v-l.y,l=S[x];var T=l.x*o+l.y*u;if(T>b)return;T>y&&(y=T,g=x)}var N=parseInt(g),C=parseInt(N+1<w?N+1:0),k=E[N],L=E[C];if(y<Number.MIN_VALUE){e.m_pointCount=1,e.m_type=D.e_faceA,e.m_localPlaneNormal.SetV(S[g]),e.m_localPoint.x=.5*(k.x+L.x),e.m_localPoint.y=.5*(k.y+L.y),e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0;return}var A=(d-k.x)*(L.x-k.x)+(v-k.y)*(L.y-k.y),O=(d-L.x)*(k.x-L.x)+(v-L.y)*(k.y-L.y);if(A<=0){if((d-k.x)*(d-k.x)+(v-k.y)*(v-k.y)>b*b)return;e.m_pointCount=1,e.m_type=D.e_faceA,e.m_localPlaneNormal.x=d-k.x,e.m_localPlaneNormal.y=v-k.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(k),e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0}else if(O<=0){if((d-L.x)*(d-L.x)+(v-L.y)*(v-L.y)>b*b)return;e.m_pointCount=1,e.m_type=D.e_faceA,e.m_localPlaneNormal.x=d-L.x,e.m_localPlaneNormal.y=v-L.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(L),e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0}else{var M=.5*(k.x+L.x),_=.5*(k.y+L.y);y=(d-M)*S[N].x+(v-_)*S[N].y;if(y>b)return;e.m_pointCount=1,e.m_type=D.e_faceA,e.m_localPlaneNormal.x=S[N].x,e.m_localPlaneNormal.y=S[N].y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.Set(M,_),e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0}},S.TestOverlap=function(e,t){var n=t.lowerBound,r=e.upperBound,i=n.x-r.x,s=n.y-r.y;n=e.lowerBound,r=t.upperBound;var o=n.x-r.x,u=n.y-r.y;return i>0||s>0?!1:o>0||u>0?!1:!0},e.postDefs.push(function(){e.Collision.b2Collision.s_incidentEdge=S.MakeClipPointVector(),e.Collision.b2Collision.s_clipPoints1=S.MakeClipPointVector(),e.Collision.b2Collision.s_clipPoints2=S.MakeClipPointVector(),e.Collision.b2Collision.s_edgeAO=new n(1),e.Collision.b2Collision.s_edgeBO=new n(1),e.Collision.b2Collision.s_localTangent=new g,e.Collision.b2Collision.s_localNormal=new g,e.Collision.b2Collision.s_planePoint=new g,e.Collision.b2Collision.s_normal=new g,e.Collision.b2Collision.s_tangent=new g,e.Collision.b2Collision.s_tangent2=new g,e.Collision.b2Collision.s_v11=new g,e.Collision.b2Collision.s_v12=new g,e.Collision.b2Collision.b2CollidePolyTempVec=new g,e.Collision.b2Collision.b2_nullFeature=255}),x.b2ContactID=function(){this.features=new $},x.prototype.b2ContactID=function(){this.features._m_id=this},x.prototype.Set=function(e){this.key=e._key},x.prototype.Copy=function(){var e=new x;return e.key=this.key,e},Object.defineProperty(x.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(x.prototype,"key",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._key=e,this.features._referenceEdge=this._key&255,this.features._incidentEdge=(this._key&65280)>>8&255,this.features._incidentVertex=(this._key&16711680)>>16&255,this.features._flip=(this._key&4278190080)>>24&255}}),T.b2ContactPoint=function(){this.position=new g,this.velocity=new g,this.normal=new g,this.id=new x},N.b2Distance=function(){},N.Distance=function(e,t,n){++N.b2_gjkCalls;var r=n.proxyA,i=n.proxyB,s=n.transformA,o=n.transformB,u=N.s_simplex;u.ReadCache(t,r,s,i,o);var a=u.m_vertices,f=20,l=N.s_saveA,h=N.s_saveB,p=0,v=u.GetClosestPoint(),m=v.LengthSquared(),y=m,b=0,w,E=0;while(E<f){p=u.m_count;for(b=0;b<p;b++)l[b]=a[b].indexA,h[b]=a[b].indexB;switch(u.m_count){case 1:break;case 2:u.Solve2();break;case 3:u.Solve3();break;default:c.b2Assert(!1)}if(u.m_count==3)break;w=u.GetClosestPoint(),y=w.LengthSquared(),y>m,m=y;var S=u.GetSearchDirection();if(S.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var x=a[u.m_count];x.indexA=r.GetSupport(d.MulTMV(s.R,S.GetNegative())),x.wA=d.MulX(s,r.GetVertex(x.indexA)),x.indexB=i.GetSupport(d.MulTMV(o.R,S)),x.wB=d.MulX(o,i.GetVertex(x.indexB)),x.w=d.SubtractVV(x.wB,x.wA),++E,++N.b2_gjkIters;var T=!1;for(b=0;b<p;b++)if(x.indexA==l[b]&&x.indexB==h[b]){T=!0;break}if(T)break;++u.m_count}N.b2_gjkMaxIters=d.Max(N.b2_gjkMaxIters,E),u.GetWitnessPoints(e.pointA,e.pointB),e.distance=d.SubtractVV(e.pointA,e.pointB).Length(),e.iterations=E,u.WriteCache(t);if(n.useRadii){var C=r.m_radius,k=i.m_radius;if(e.distance>C+k&&e.distance>Number.MIN_VALUE){e.distance-=C+k;var L=d.SubtractVV(e.pointB,e.pointA);L.Normalize(),e.pointA.x+=C*L.x,e.pointA.y+=C*L.y,e.pointB.x-=k*L.x,e.pointB.y-=k*L.y}else w=new g,w.x=.5*(e.pointA.x+e.pointB.x),w.y=.5*(e.pointA.y+e.pointB.y),e.pointA.x=e.pointB.x=w.x,e.pointA.y=e.pointB.y=w.y,e.distance=0}},e.postDefs.push(function(){e.Collision.b2Distance.s_simplex=new q,e.Collision.b2Distance.s_saveA=new n(3),e.Collision.b2Distance.s_saveB=new n(3)}),C.b2DistanceInput=function(){},k.b2DistanceOutput=function(){this.pointA=new g,this.pointB=new g},L.b2DistanceProxy=function(){},L.prototype.Set=function(e){switch(e.GetType()){case a.e_circleShape:var n=e instanceof r?e:null;this.m_vertices=new t(1,!0),this.m_vertices[0]=n.m_p,this.m_count=1,this.m_radius=n.m_radius;break;case a.e_polygonShape:var i=e instanceof u?e:null;this.m_vertices=i.m_vertices,this.m_count=i.m_vertexCount,this.m_radius=i.m_radius;break;default:c.b2Assert(!1)}},L.prototype.GetSupport=function(e){var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},L.prototype.GetSupportVertex=function(e){var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},L.prototype.GetVertexCount=function(){return this.m_count},L.prototype.GetVertex=function(e){return e===undefined&&(e=0),c.b2Assert(0<=e&&e<this.m_count),this.m_vertices[e]},A.b2DynamicTree=function(){},A.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},A.prototype.CreateProxy=function(e,t){var n=this.AllocateNode(),r=c.b2_aabbExtension,i=c.b2_aabbExtension;return n.aabb.lowerBound.x=e.lowerBound.x-r,n.aabb.lowerBound.y=e.lowerBound.y-i,n.aabb.upperBound.x=e.upperBound.x+r,n.aabb.upperBound.y=e.upperBound.y+i,n.userData=t,this.InsertLeaf(n),n},A.prototype.DestroyProxy=function(e){this.RemoveLeaf(e),this.FreeNode(e)},A.prototype.MoveProxy=function(e,t,n){c.b2Assert(e.IsLeaf());if(e.aabb.Contains(t))return!1;this.RemoveLeaf(e);var r=c.b2_aabbExtension+c.b2_aabbMultiplier*(n.x>0?n.x:-n.x),i=c.b2_aabbExtension+c.b2_aabbMultiplier*(n.y>0?n.y:-n.y);return e.aabb.lowerBound.x=t.lowerBound.x-r,e.aabb.lowerBound.y=t.lowerBound.y-i,e.aabb.upperBound.x=t.upperBound.x+r,e.aabb.upperBound.y=t.upperBound.y+i,this.InsertLeaf(e),!0},A.prototype.Rebalance=function(e){e===undefined&&(e=0);if(this.m_root==null)return;for(var t=0;t<e;t++){var n=this.m_root,r=0;while(n.IsLeaf()==0)n=this.m_path>>r&1?n.child2:n.child1,r=r+1&31;++this.m_path,this.RemoveLeaf(n),this.InsertLeaf(n)}},A.prototype.GetFatAABB=function(e){return e.aabb},A.prototype.GetUserData=function(e){return e.userData},A.prototype.Query=function(e,n){if(this.m_root==null)return;var r=new t,i=0;r[i++]=this.m_root;while(i>0){var s=r[--i];if(s.aabb.TestOverlap(n))if(s.IsLeaf()){var o=e(s);if(!o)return}else r[i++]=s.child1,r[i++]=s.child2}},A.prototype.RayCast=function(e,n){if(this.m_root==null)return;var r=n.p1,i=n.p2,s=d.SubtractVV(r,i);s.Normalize();var o=d.CrossFV(1,s),u=d.AbsV(o),a=n.maxFraction,f=new b,l=0,c=0;l=r.x+a*(i.x-r.x),c=r.y+a*(i.y-r.y),f.lowerBound.x=Math.min(r.x,l),f.lowerBound.y=Math.min(r.y,c),f.upperBound.x=Math.max(r.x,l),f.upperBound.y=Math.max(r.y,c);var h=new t,p=0;h[p++]=this.m_root;while(p>0){var v=h[--p];if(v.aabb.TestOverlap(f)==0)continue;var m=v.aabb.GetCenter(),g=v.aabb.GetExtents(),y=Math.abs(o.x*(r.x-m.x)+o.y*(r.y-m.y))-u.x*g.x-u.y*g.y;if(y>0)continue;if(v.IsLeaf()){var w=new B;w.p1=n.p1,w.p2=n.p2,w.maxFraction=n.maxFraction,a=e(w,v);if(a==0)return;a>0&&(l=r.x+a*(i.x-r.x),c=r.y+a*(i.y-r.y),f.lowerBound.x=Math.min(r.x,l),f.lowerBound.y=Math.min(r.y,c),f.upperBound.x=Math.max(r.x,l),f.upperBound.y=Math.max(r.y,c))}else h[p++]=v.child1,h[p++]=v.child2}},A.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e}return new M},A.prototype.FreeNode=function(e){e.parent=this.m_freeList,this.m_freeList=e},A.prototype.InsertLeaf=function(e){++this.m_insertionCount;if(this.m_root==null){this.m_root=e,this.m_root.parent=null;return}var t=e.aabb.GetCenter(),n=this.m_root;if(n.IsLeaf()==0)do{var r=n.child1,i=n.child2,s=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-t.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-t.y),o=Math.abs((i.aabb.lowerBound.x+i.aabb.upperBound.x)/2-t.x)+Math.abs((i.aabb.lowerBound.y+i.aabb.upperBound.y)/2-t.y);s<o?n=r:n=i}while(n.IsLeaf()==0);var u=n.parent,a=this.AllocateNode();a.parent=u,a.userData=null,a.aabb.Combine(e.aabb,n.aabb);if(u){n.parent.child1==n?u.child1=a:u.child2=a,a.child1=n,a.child2=e,n.parent=a,e.parent=a;do{if(u.aabb.Contains(a.aabb))break;u.aabb.Combine(u.child1.aabb,u.child2.aabb),a=u,u=u.parent}while(u)}else a.child1=n,a.child2=e,n.parent=a,e.parent=a,this.m_root=a},A.prototype.RemoveLeaf=function(e){if(e==this.m_root){this.m_root=null;return}var t=e.parent,n=t.parent,r;t.child1==e?r=t.child2:r=t.child1;if(n){n.child1==t?n.child1=r:n.child2=r,r.parent=n,this.FreeNode(t);while(n){var i=n.aabb;n.aabb=b.Combine(n.child1.aabb,n.child2.aabb);if(i.Contains(n.aabb))break;n=n.parent}}else this.m_root=r,r.parent=null,this.FreeNode(t)},O.b2DynamicTreeBroadPhase=function(){this.m_tree=new A,this.m_moveBuffer=new t,this.m_pairBuffer=new t,this.m_pairCount=0},O.prototype.CreateProxy=function(e,t){var n=this.m_tree.CreateProxy(e,t);return++this.m_proxyCount,this.BufferMove(n),n},O.prototype.DestroyProxy=function(e){this.UnBufferMove(e),--this.m_proxyCount,this.m_tree.DestroyProxy(e)},O.prototype.MoveProxy=function(e,t,n){var r=this.m_tree.MoveProxy(e,t,n);r&&this.BufferMove(e)},O.prototype.TestOverlap=function(e,t){var n=this.m_tree.GetFatAABB(e),r=this.m_tree.GetFatAABB(t);return n.TestOverlap(r)},O.prototype.GetUserData=function(e){return this.m_tree.GetUserData(e)},O.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)},O.prototype.GetProxyCount=function(){return this.m_proxyCount},O.prototype.UpdatePairs=function(e){var t=this;t.m_pairCount=0;var n=0,r;for(n=0;n<t.m_moveBuffer.length;++n){r=t.m_moveBuffer[n];function i(e){if(e==r)return!0;t.m_pairCount==t.m_pairBuffer.length&&(t.m_pairBuffer[t.m_pairCount]=new _);var n=t.m_pairBuffer[t.m_pairCount];return n.proxyA=e<r?e:r,n.proxyB=e>=r?e:r,++t.m_pairCount,!0}var s=t.m_tree.GetFatAABB(r);t.m_tree.Query(i,s)}t.m_moveBuffer.length=0;for(var n=0;n<t.m_pairCount;){var o=t.m_pairBuffer[n],u=t.m_tree.GetUserData(o.proxyA),a=t.m_tree.GetUserData(o.proxyB);e(u,a),++n;while(n<t.m_pairCount){var f=t.m_pairBuffer[n];if(f.proxyA!=o.proxyA||f.proxyB!=o.proxyB)break;++n}}},O.prototype.Query=function(e,t){this.m_tree.Query(e,t)},O.prototype.RayCast=function(e,t){this.m_tree.RayCast(e,t)},O.prototype.Validate=function(){},O.prototype.Rebalance=function(e){e===undefined&&(e=0),this.m_tree.Rebalance(e)},O.prototype.BufferMove=function(e){this.m_moveBuffer[this.m_moveBuffer.length]=e},O.prototype.UnBufferMove=function(e){var t=parseInt(this.m_moveBuffer.indexOf(e));this.m_moveBuffer.splice(t,1)},O.prototype.ComparePairs=function(e,t){return 0},O.__implements={},O.__implements[J]=!0,M.b2DynamicTreeNode=function(){this.aabb=new b},M.prototype.IsLeaf=function(){return this.child1==null},_.b2DynamicTreePair=function(){},D.b2Manifold=function(){this.m_pointCount=0},D.prototype.b2Manifold=function(){this.m_points=new t(c.b2_maxManifoldPoints);for(var e=0;e<c.b2_maxManifoldPoints;e++)this.m_points[e]=new P;this.m_localPlaneNormal=new g,this.m_localPoint=new g},D.prototype.Reset=function(){for(var e=0;e<c.b2_maxManifoldPoints;e++)(this.m_points[e]instanceof P?this.m_points[e]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},D.prototype.Set=function(e){this.m_pointCount=e.m_pointCount;for(var t=0;t<c.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof P?this.m_points[t]:null).Set(e.m_points[t]);this.m_localPlaneNormal.SetV(e.m_localPlaneNormal),this.m_localPoint.SetV(e.m_localPoint),this.m_type=e.m_type},D.prototype.Copy=function(){var e=new D;return e.Set(this),e},e.postDefs.push(function(){e.Collision.b2Manifold.e_circles=1,e.Collision.b2Manifold.e_faceA=2,e.Collision.b2Manifold.e_faceB=4}),P.b2ManifoldPoint=function(){this.m_localPoint=new g,this.m_id=new x},P.prototype.b2ManifoldPoint=function(){this.Reset()},P.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},P.prototype.Set=function(e){this.m_localPoint.SetV(e.m_localPoint),this.m_normalImpulse=e.m_normalImpulse,this.m_tangentImpulse=e.m_tangentImpulse,this.m_id.Set(e.m_id)},H.b2Point=function(){this.p=new g},H.prototype.Support=function(e,t,n){return t===undefined&&(t=0),n===undefined&&(n=0),this.p},H.prototype.GetFirstVertex=function(e){return this.p},B.b2RayCastInput=function(){this.p1=new g,this.p2=new g},B.prototype.b2RayCastInput=function(e,t,n){e===undefined&&(e=null),t===undefined&&(t=null),n===undefined&&(n=1),e&&this.p1.SetV(e),t&&this.p2.SetV(t),this.maxFraction=n},j.b2RayCastOutput=function(){this.normal=new g},F.b2Segment=function(){this.p1=new g,this.p2=new g},F.prototype.TestSegment=function(e,t,n,r){r===undefined&&(r=0);var i=n.p1,s=n.p2.x-i.x,o=n.p2.y-i.y,u=this.p2.x-this.p1.x,a=this.p2.y-this.p1.y,f=a,l=-u,c=100*Number.MIN_VALUE,h=-(s*f+o*l);if(h>c){var p=i.x-this.p1.x,d=i.y-this.p1.y,v=p*f+d*l;if(0<=v&&v<=r*h){var m=-s*d+o*p;if(-c*h<=m&&m<=h*(1+c)){v/=h;var g=Math.sqrt(f*f+l*l);return f/=g,l/=g,e[0]=v,t.Set(f,l),!0}}}return!1},F.prototype.Extend=function(e){this.ExtendForward(e),this.ExtendBackward(e)},F.prototype.ExtendForward=function(e){var t=this.p2.x-this.p1.x,n=this.p2.y-this.p1.y,r=Math.min(t>0?(e.upperBound.x-this.p1.x)/t:t<0?(e.lowerBound.x-this.p1.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p1.y)/n:n<0?(e.lowerBound.y-this.p1.y)/n:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+t*r,this.p2.y=this.p1.y+n*r},F.prototype.ExtendBackward=function(e){var t=-this.p2.x+this.p1.x,n=-this.p2.y+this.p1.y,r=Math.min(t>0?(e.upperBound.x-this.p2.x)/t:t<0?(e.lowerBound.x-this.p2.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p2.y)/n:n<0?(e.lowerBound.y-this.p2.y)/n:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+t*r,this.p1.y=this.p2.y+n*r},I.b2SeparationFunction=function(){this.m_localPoint=new g,this.m_axis=new g},I.prototype.Initialize=function(e,t,n,r,i){this.m_proxyA=t,this.m_proxyB=r;var s=parseInt(e.count);c.b2Assert(0<s&&s<3);var o,u,a,f,l,h,p=0,v=0,m=0,y=0,b=0,w=0,E,S,x=0,T=0;if(s==1)this.m_type=I.e_points,o=this.m_proxyA.GetVertex(e.indexA[0]),f=this.m_proxyB.GetVertex(e.indexB[0]),S=o,E=n.R,p=n.position.x+(E.col1.x*S.x+E.col2.x*S.y),v=n.position.y+(E.col1.y*S.x+E.col2.y*S.y),S=f,E=i.R,m=i.position.x+(E.col1.x*S.x+E.col2.x*S.y),y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y),this.m_axis.x=m-p,this.m_axis.y=y-v,this.m_axis.Normalize();else if(e.indexB[0]==e.indexB[1])this.m_type=I.e_faceA,u=this.m_proxyA.GetVertex(e.indexA[0]),a=this.m_proxyA.GetVertex(e.indexA[1]),f=this.m_proxyB.GetVertex(e.indexB[0]),this.m_localPoint.x=.5*(u.x+a.x),this.m_localPoint.y=.5*(u.y+a.y),this.m_axis=d.CrossVF(d.SubtractVV(a,u),1),this.m_axis.Normalize(),S=this.m_axis,E=n.R,b=E.col1.x*S.x+E.col2.x*S.y,w=E.col1.y*S.x+E.col2.y*S.y,S=this.m_localPoint,E=n.R,p=n.position.x+(E.col1.x*S.x+E.col2.x*S.y),v=n.position.y+(E.col1.y*S.x+E.col2.y*S.y),S=f,E=i.R,m=i.position.x+(E.col1.x*S.x+E.col2.x*S.y),y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y),x=(m-p)*b+(y-v)*w,x<0&&this.m_axis.NegativeSelf();else if(e.indexA[0]==e.indexA[0])this.m_type=I.e_faceB,l=this.m_proxyB.GetVertex(e.indexB[0]),h=this.m_proxyB.GetVertex(e.indexB[1]),o=this.m_proxyA.GetVertex(e.indexA[0]),this.m_localPoint.x=.5*(l.x+h.x),this.m_localPoint.y=.5*(l.y+h.y),this.m_axis=d.CrossVF(d.SubtractVV(h,l),1),this.m_axis.Normalize(),S=this.m_axis,E=i.R,b=E.col1.x*S.x+E.col2.x*S.y,w=E.col1.y*S.x+E.col2.y*S.y,S=this.m_localPoint,E=i.R,m=i.position.x+(E.col1.x*S.x+E.col2.x*S.y),y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y),S=o,E=n.R,p=n.position.x+(E.col1.x*S.x+E.col2.x*S.y),v=n.position.y+(E.col1.y*S.x+E.col2.y*S.y),x=(p-m)*b+(v-y)*w,x<0&&this.m_axis.NegativeSelf();else{u=this.m_proxyA.GetVertex(e.indexA[0]),a=this.m_proxyA.GetVertex(e.indexA[1]),l=this.m_proxyB.GetVertex(e.indexB[0]),h=this.m_proxyB.GetVertex(e.indexB[1]);var N=d.MulX(n,o),C=d.MulMV(n.R,d.SubtractVV(a,u)),k=d.MulX(i,f),L=d.MulMV(i.R,d.SubtractVV(h,l)),A=C.x*C.x+C.y*C.y,O=L.x*L.x+L.y*L.y,M=d.SubtractVV(L,C),_=C.x*M.x+C.y*M.y,D=L.x*M.x+L.y*M.y,P=C.x*L.x+C.y*L.y,H=A*O-P*P;x=0,H!=0&&(x=d.Clamp((P*D-_*O)/H,0,1));var B=(P*x+D)/O;B<0&&(B=0,x=d.Clamp((P-_)/A,0,1)),o=new g,o.x=u.x+x*(a.x-u.x),o.y=u.y+x*(a.y-u.y),f=new g,f.x=l.x+x*(h.x-l.x),f.y=l.y+x*(h.y-l.y),x==0||x==1?(this.m_type=I.e_faceB,this.m_axis=d.CrossVF(d.SubtractVV(h,l),1),this.m_axis.Normalize(),this.m_localPoint=f,S=this.m_axis,E=i.R,b=E.col1.x*S.x+E.col2.x*S.y,w=E.col1.y*S.x+E.col2.y*S.y,S=this.m_localPoint,E=i.R,m=i.position.x+(E.col1.x*S.x+E.col2.x*S.y),y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y),S=o,E=n.R,p=n.position.x+(E.col1.x*S.x+E.col2.x*S.y),v=n.position.y+(E.col1.y*S.x+E.col2.y*S.y),T=(p-m)*b+(v-y)*w,x<0&&this.m_axis.NegativeSelf()):(this.m_type=I.e_faceA,this.m_axis=d.CrossVF(d.SubtractVV(a,u),1),this.m_localPoint=o,S=this.m_axis,E=n.R,b=E.col1.x*S.x+E.col2.x*S.y,w=E.col1.y*S.x+E.col2.y*S.y,S=this.m_localPoint,E=n.R,p=n.position.x+(E.col1.x*S.x+E.col2.x*S.y),v=n.position.y+(E.col1.y*S.x+E.col2.y*S.y),S=f,E=i.R,m=i.position.x+(E.col1.x*S.x+E.col2.x*S.y),y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y),T=(m-p)*b+(y-v)*w,x<0&&this.m_axis.NegativeSelf())}},I.prototype.Evaluate=function(e,t){var n,r,i,s,o,u,a=0,f;switch(this.m_type){case I.e_points:return n=d.MulTMV(e.R,this.m_axis),r=d.MulTMV(t.R,this.m_axis.GetNegative()),i=this.m_proxyA.GetSupportVertex(n),s=this.m_proxyB.GetSupportVertex(r),o=d.MulX(e,i),u=d.MulX(t,s),a=(u.x-o.x)*this.m_axis.x+(u.y-o.y)*this.m_axis.y,a;case I.e_faceA:return f=d.MulMV(e.R,this.m_axis),o=d.MulX(e,this.m_localPoint),r=d.MulTMV(t.R,f.GetNegative()),s=this.m_proxyB.GetSupportVertex(r),u=d.MulX(t,s),a=(u.x-o.x)*f.x+(u.y-o.y)*f.y,a;case I.e_faceB:return f=d.MulMV(t.R,this.m_axis),u=d.MulX(t,this.m_localPoint),n=d.MulTMV(e.R,f.GetNegative()),i=this.m_proxyA.GetSupportVertex(n),o=d.MulX(e,i),a=(o.x-u.x)*f.x+(o.y-u.y)*f.y,a;default:return c.b2Assert(!1),0}},e.postDefs.push(function(){e.Collision.b2SeparationFunction.e_points=1,e.Collision.b2SeparationFunction.e_faceA=2,e.Collision.b2SeparationFunction.e_faceB=4}),q.b2Simplex=function(){this.m_v1=new U,this.m_v2=new U,this.m_v3=new U,this.m_vertices=new t(3)},q.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},q.prototype.ReadCache=function(e,t,n,r,i){c.b2Assert(0<=e.count&&e.count<=3);var s,o;this.m_count=e.count;var u=this.m_vertices;for(var a=0;a<this.m_count;a++){var f=u[a];f.indexA=e.indexA[a],f.indexB=e.indexB[a],s=t.GetVertex(f.indexA),o=r.GetVertex(f.indexB),f.wA=d.MulX(n,s),f.wB=d.MulX(i,o),f.w=d.SubtractVV(f.wB,f.wA),f.a=0}if(this.m_count>1){var l=e.metric,h=this.GetMetric();if(h<.5*l||2*l<h||h<Number.MIN_VALUE)this.m_count=0}this.m_count==0&&(f=u[0],f.indexA=0,f.indexB=0,s=t.GetVertex(0),o=r.GetVertex(0),f.wA=d.MulX(n,s),f.wB=d.MulX(i,o),f.w=d.SubtractVV(f.wB,f.wA),this.m_count=1)},q.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=e.parseUInt(this.m_count);var n=this.m_vertices;for(var r=0;r<this.m_count;r++)t.indexA[r]=e.parseUInt(n[r].indexA),t.indexB[r]=e.parseUInt(n[r].indexB)},q.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var e=d.SubtractVV(this.m_v2.w,this.m_v1.w),t=d.CrossVV(e,this.m_v1.w.GetNegative());return t>0?d.CrossFV(1,e):d.CrossVF(e,1);default:return c.b2Assert(!1),new g}},q.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return c.b2Assert(!1),new g;case 1:return this.m_v1.w;case 2:return new g(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return c.b2Assert(!1),new g}},q.prototype.GetWitnessPoints=function(e,t){switch(this.m_count){case 0:c.b2Assert(!1);break;case 1:e.SetV(this.m_v1.wA),t.SetV(this.m_v1.wB);break;case 2:e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,t.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:c.b2Assert(!1)}},q.prototype.GetMetric=function(){switch(this.m_count){case 0:return c.b2Assert(!1),0;case 1:return 0;case 2:return d.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return d.CrossVV(d.SubtractVV(this.m_v2.w,this.m_v1.w),d.SubtractVV(this.m_v3.w,this.m_v1.w));default:return c.b2Assert(!1),0}},q.prototype.Solve2=function(){var e=this.m_v1.w,t=this.m_v2.w,n=d.SubtractVV(t,e),r=-(e.x*n.x+e.y*n.y);if(r<=0){this.m_v1.a=1,this.m_count=1;return}var i=t.x*n.x+t.y*n.y;if(i<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2);return}var s=1/(i+r);this.m_v1.a=i*s,this.m_v2.a=r*s,this.m_count=2},q.prototype.Solve3=function(){var e=this.m_v1.w,t=this.m_v2.w,n=this.m_v3.w,r=d.SubtractVV(t,e),i=d.Dot(e,r),s=d.Dot(t,r),o=s,u=-i,a=d.SubtractVV(n,e),f=d.Dot(e,a),l=d.Dot(n,a),c=l,h=-f,p=d.SubtractVV(n,t),v=d.Dot(t,p),m=d.Dot(n,p),g=m,y=-v,b=d.CrossVV(r,a),w=b*d.CrossVV(t,n),E=b*d.CrossVV(n,e),S=b*d.CrossVV(e,t);if(u<=0&&h<=0){this.m_v1.a=1,this.m_count=1;return}if(o>0&&u>0&&S<=0){var x=1/(o+u);this.m_v1.a=o*x,this.m_v2.a=u*x,this.m_count=2;return}if(c>0&&h>0&&E<=0){var T=1/(c+h);this.m_v1.a=c*T,this.m_v3.a=h*T,this.m_count=2,this.m_v2.Set(this.m_v3);return}if(o<=0&&y<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2);return}if(c<=0&&g<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.Set(this.m_v3);return}if(g>0&&y>0&&w<=0){var N=1/(g+y);this.m_v2.a=g*N,this.m_v3.a=y*N,this.m_count=2,this.m_v1.Set(this.m_v3);return}var C=1/(w+E+S);this.m_v1.a=w*C,this.m_v2.a=E*C,this.m_v3.a=S*C,this.m_count=3},R.b2SimplexCache=function(){this.indexA=new n(3),this.indexB=new n(3)},U.b2SimplexVertex=function(){},U.prototype.Set=function(e){this.wA.SetV(e.wA),this.wB.SetV(e.wB),this.w.SetV(e.w),this.a=e.a,this.indexA=e.indexA,this.indexB=e.indexB},z.b2TimeOfImpact=function(){},z.TimeOfImpact=function(e){++z.b2_toiCalls;var t=e.proxyA,n=e.proxyB,r=e.sweepA,i=e.sweepB;c.b2Assert(r.t0==i.t0),c.b2Assert(1-r.t0>Number.MIN_VALUE);var s=t.m_radius+n.m_radius,o=e.tolerance,u=0,a=1e3,f=0,l=0;z.s_cache.count=0,z.s_distanceInput.useRadii=!1;for(;;){r.GetTransform(z.s_xfA,u),i.GetTransform(z.s_xfB,u),z.s_distanceInput.proxyA=t,z.s_distanceInput.proxyB=n,z.s_distanceInput.transformA=z.s_xfA,z.s_distanceInput.transformB=z.s_xfB,N.Distance(z.s_distanceOutput,z.s_cache,z.s_distanceInput);if(z.s_distanceOutput.distance<=0){u=1;break}z.s_fcn.Initialize(z.s_cache,t,z.s_xfA,n,z.s_xfB);var h=z.s_fcn.Evaluate(z.s_xfA,z.s_xfB);if(h<=0){u=1;break}f==0&&(h>s?l=d.Max(s-o,.75*s):l=d.Max(h-o,.02*s));if(h-l<.5*o){if(f==0){u=1;break}break}var p=u,v=u,m=1,g=h;r.GetTransform(z.s_xfA,m),i.GetTransform(z.s_xfB,m);var y=z.s_fcn.Evaluate(z.s_xfA,z.s_xfB);if(y>=l){u=1;break}var b=0;for(;;){var w=0;b&1?w=v+(l-g)*(m-v)/(y-g):w=.5*(v+m),r.GetTransform(z.s_xfA,w),i.GetTransform(z.s_xfB,w);var E=z.s_fcn.Evaluate(z.s_xfA,z.s_xfB);if(d.Abs(E-l)<.025*o){p=w;break}E>l?(v=w,g=E):(m=w,y=E),++b,++z.b2_toiRootIters;if(b==50)break}z.b2_toiMaxRootIters=d.Max(z.b2_toiMaxRootIters,b);if(p<(1+100*Number.MIN_VALUE)*u)break;u=p,f++,++z.b2_toiIters;if(f==a)break}return z.b2_toiMaxIters=d.Max(z.b2_toiMaxIters,f),u},e.postDefs.push(function(){e.Collision.b2TimeOfImpact.b2_toiCalls=0,e.Collision.b2TimeOfImpact.b2_toiIters=0,e.Collision.b2TimeOfImpact.b2_toiMaxIters=0,e.Collision.b2TimeOfImpact.b2_toiRootIters=0,e.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,e.Collision.b2TimeOfImpact.s_cache=new R,e.Collision.b2TimeOfImpact.s_distanceInput=new C,e.Collision.b2TimeOfImpact.s_xfA=new m,e.Collision.b2TimeOfImpact.s_xfB=new m,e.Collision.b2TimeOfImpact.s_fcn=new I,e.Collision.b2TimeOfImpact.s_distanceOutput=new k}),W.b2TOIInput=function(){this.proxyA=new L,this.proxyB=new L,this.sweepA=new v,this.sweepB=new v},X.b2WorldManifold=function(){this.m_normal=new g},X.prototype.b2WorldManifold=function(){this.m_points=new t(c.b2_maxManifoldPoints);for(var e=0;e<c.b2_maxManifoldPoints;e++)this.m_points[e]=new g},X.prototype.Initialize=function(e,t,n,r,i){n===undefined&&(n=0),i===undefined&&(i=0);if(e.m_pointCount==0)return;var s=0,o,u,a=0,f=0,l=0,c=0,h=0,p=0;switch(e.m_type){case D.e_circles:u=t.R,o=e.m_localPoint;var d=t.position.x+u.col1.x*o.x+u.col2.x*o.y,v=t.position.y+u.col1.y*o.x+u.col2.y*o.y;u=r.R,o=e.m_points[0].m_localPoint;var m=r.position.x+u.col1.x*o.x+u.col2.x*o.y,g=r.position.y+u.col1.y*o.x+u.col2.y*o.y,y=m-d,b=g-v,w=y*y+b*b;if(w>Number.MIN_VALUE*Number.MIN_VALUE){var E=Math.sqrt(w);this.m_normal.x=y/E,this.m_normal.y=b/E}else this.m_normal.x=1,this.m_normal.y=0;var S=d+n*this.m_normal.x,x=v+n*this.m_normal.y,T=m-i*this.m_normal.x,N=g-i*this.m_normal.y;this.m_points[0].x=.5*(S+T),this.m_points[0].y=.5*(x+N);break;case D.e_faceA:u=t.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=t.R,o=e.m_localPoint,l=t.position.x+u.col1.x*o.x+u.col2.x*o.y,c=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=a,this.m_normal.y=f;for(s=0;s<e.m_pointCount;s++)u=r.R,o=e.m_points[s].m_localPoint,h=r.position.x+u.col1.x*o.x+u.col2.x*o.y,p=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(n-(h-l)*a-(p-c)*f-i)*a,this.m_points[s].y=p+.5*(n-(h-l)*a-(p-c)*f-i)*f;break;case D.e_faceB:u=r.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_localPoint,l=r.position.x+u.col1.x*o.x+u.col2.x*o.y,c=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=-a,this.m_normal.y=-f;for(s=0;s<e.m_pointCount;s++)u=t.R,o=e.m_points[s].m_localPoint,h=t.position.x+u.col1.x*o.x+u.col2.x*o.y,p=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(i-(h-l)*a-(p-c)*f-n)*a,this.m_points[s].y=p+.5*(i-(h-l)*a-(p-c)*f-n)*f}},V.ClipVertex=function(){this.v=new g,this.id=new x},V.prototype.Set=function(e){this.v.SetV(e.v),this.id.Set(e.id)},$.Features=function(){},Object.defineProperty($.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty($.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._referenceEdge=e,this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}}),Object.defineProperty($.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty($.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._incidentEdge=e,this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}}),Object.defineProperty($.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty($.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._incidentVertex=e,this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}}),Object.defineProperty($.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty($.prototype,"flip",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._flip=e,this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})}(),function(){var r=e.Common.b2Color,i=e.Common.b2internal,s=e.Common.b2Settings,o=e.Collision.Shapes.b2CircleShape,u=e.Collision.Shapes.b2EdgeChainDef,a=e.Collision.Shapes.b2EdgeShape,f=e.Collision.Shapes.b2MassData,l=e.Collision.Shapes.b2PolygonShape,c=e.Collision.Shapes.b2Shape,h=e.Common.Math.b2Mat22,p=e.Common.Math.b2Mat33,d=e.Common.Math.b2Math,v=e.Common.Math.b2Sweep,m=e.Common.Math.b2Transform,g=e.Common.Math.b2Vec2,y=e.Common.Math.b2Vec3,b=e.Dynamics.b2Body,w=e.Dynamics.b2BodyDef,E=e.Dynamics.b2ContactFilter,S=e.Dynamics.b2ContactImpulse,x=e.Dynamics.b2ContactListener,T=e.Dynamics.b2ContactManager,N=e.Dynamics.b2DebugDraw,C=e.Dynamics.b2DestructionListener,k=e.Dynamics.b2FilterData,L=e.Dynamics.b2Fixture,A=e.Dynamics.b2FixtureDef,O=e.Dynamics.b2Island,M=e.Dynamics.b2TimeStep,_=e.Dynamics.b2World,D=e.Collision.b2AABB,P=e.Collision.b2Bound,H=e.Collision.b2BoundValues,B=e.Collision.b2Collision,j=e.Collision.b2ContactID,F=e.Collision.b2ContactPoint,I=e.Collision.b2Distance,q=e.Collision.b2DistanceInput,R=e.Collision.b2DistanceOutput,U=e.Collision.b2DistanceProxy,z=e.Collision.b2DynamicTree,W=e.Collision.b2DynamicTreeBroadPhase,X=e.Collision.b2DynamicTreeNode,V=e.Collision.b2DynamicTreePair,$=e.Collision.b2Manifold,J=e.Collision.b2ManifoldPoint,K=e.Collision.b2Point,Q=e.Collision.b2RayCastInput,G=e.Collision.b2RayCastOutput,Y=e.Collision.b2Segment,Z=e.Collision.b2SeparationFunction,et=e.Collision.b2Simplex,tt=e.Collision.b2SimplexCache,nt=e.Collision.b2SimplexVertex,rt=e.Collision.b2TimeOfImpact,it=e.Collision.b2TOIInput,st=e.Collision.b2WorldManifold,ot=e.Collision.ClipVertex,ut=e.Collision.Features,at=e.Collision.IBroadPhase;e.inherit(o,e.Collision.Shapes.b2Shape),o.prototype.__super=e.Collision.Shapes.b2Shape.prototype,o.b2CircleShape=function(){e.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new g},o.prototype.Copy=function(){var e=new o;return e.Set(this),e},o.prototype.Set=function(t){this.__super.Set.call(this,t);if(e.is(t,o)){var n=t instanceof o?t:null;this.m_p.SetV(n.m_p)}},o.prototype.TestPoint=function(e,t){var n=e.R,r=e.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y),i=e.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y);return r=t.x-r,i=t.y-i,r*r+i*i<=this.m_radius*this.m_radius},o.prototype.RayCast=function(e,t,n){var r=n.R,i=n.position.x+(r.col1.x*this.m_p.x+r.col2.x*this.m_p.y),s=n.position.y+(r.col1.y*this.m_p.x+r.col2.y*this.m_p.y),o=t.p1.x-i,u=t.p1.y-s,a=o*o+u*u-this.m_radius*this.m_radius,f=t.p2.x-t.p1.x,l=t.p2.y-t.p1.y,c=o*f+u*l,h=f*f+l*l,p=c*c-h*a;if(p<0||h<Number.MIN_VALUE)return!1;var d=-(c+Math.sqrt(p));return 0<=d&&d<=t.maxFraction*h?(d/=h,e.fraction=d,e.normal.x=o+d*f,e.normal.y=u+d*l,e.normal.Normalize(),!0):!1},o.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y),i=t.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y);e.lowerBound.Set(r-this.m_radius,i-this.m_radius),e.upperBound.Set(r+this.m_radius,i+this.m_radius)},o.prototype.ComputeMass=function(e,t){t===undefined&&(t=0),e.mass=t*s.b2_pi*this.m_radius*this.m_radius,e.center.SetV(this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},o.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0);var i=d.MulX(n,this.m_p),s=-(d.Dot(e,i)-t);if(s<-this.m_radius+Number.MIN_VALUE)return 0;if(s>this.m_radius)return r.SetV(i),Math.PI*this.m_radius*this.m_radius;var o=this.m_radius*this.m_radius,u=s*s,a=o*(Math.asin(s/this.m_radius)+Math.PI/2)+s*Math.sqrt(o-u),f=-2/3*Math.pow(o-u,1.5)/a;return r.x=i.x+e.x*f,r.y=i.y+e.y*f,a},o.prototype.GetLocalPosition=function(){return this.m_p},o.prototype.SetLocalPosition=function(e){this.m_p.SetV(e)},o.prototype.GetRadius=function(){return this.m_radius},o.prototype.SetRadius=function(e){e===undefined&&(e=0),this.m_radius=e},o.prototype.b2CircleShape=function(e){e===undefined&&(e=0),this.__super.b2Shape.call(this),this.m_type=c.e_circleShape,this.m_radius=e},u.b2EdgeChainDef=function(){},u.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},e.inherit(a,e.Collision.Shapes.b2Shape),a.prototype.__super=e.Collision.Shapes.b2Shape.prototype,a.b2EdgeShape=function(){e.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new g,this.m_v1=new g,this.m_v2=new g,this.m_coreV1=new g,this.m_coreV2=new g,this.m_normal=new g,this.m_direction=new g,this.m_cornerDir1=new g,this.m_cornerDir2=new g},a.prototype.TestPoint=function(e,t){return!1},a.prototype.RayCast=function(e,t,n){var r,i=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y;r=n.R;var o=n.position.x+(r.col1.x*this.m_v1.x+r.col2.x*this.m_v1.y),u=n.position.y+(r.col1.y*this.m_v1.x+r.col2.y*this.m_v1.y),a=n.position.y+(r.col1.y*this.m_v2.x+r.col2.y*this.m_v2.y)-u,f=-(n.position.x+(r.col1.x*this.m_v2.x+r.col2.x*this.m_v2.y)-o),l=100*Number.MIN_VALUE,c=-(i*a+s*f);if(c>l){var h=t.p1.x-o,p=t.p1.y-u,d=h*a+p*f;if(0<=d&&d<=t.maxFraction*c){var v=-i*p+s*h;if(-l*c<=v&&v<=c*(1+l)){d/=c,e.fraction=d;var m=Math.sqrt(a*a+f*f);return e.normal.x=a/m,e.normal.y=f/m,!0}}}return!1},a.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y),i=t.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y),s=t.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y),o=t.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y);r<s?(e.lowerBound.x=r,e.upperBound.x=s):(e.lowerBound.x=s,e.upperBound.x=r),i<o?(e.lowerBound.y=i,e.upperBound.y=o):(e.lowerBound.y=o,e.upperBound.y=i)},a.prototype.ComputeMass=function(e,t){t===undefined&&(t=0),e.mass=0,e.center.SetV(this.m_v1),e.I=0},a.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0);var i=new g(e.x*t,e.y*t),s=d.MulX(n,this.m_v1),o=d.MulX(n,this.m_v2),u=d.Dot(e,s)-t,a=d.Dot(e,o)-t;if(u>0){if(a>0)return 0;s.x=-a/(u-a)*s.x+u/(u-a)*o.x,s.y=-a/(u-a)*s.y+u/(u-a)*o.y}else a>0&&(o.x=-a/(u-a)*s.x+u/(u-a)*o.x,o.y=-a/(u-a)*s.y+u/(u-a)*o.y);return r.x=(i.x+s.x+o.x)/3,r.y=(i.y+s.y+o.y)/3,.5*((s.x-i.x)*(o.y-i.y)-(s.y-i.y)*(o.x-i.x))},a.prototype.GetLength=function(){return this.m_length},a.prototype.GetVertex1=function(){return this.m_v1},a.prototype.GetVertex2=function(){return this.m_v2},a.prototype.GetCoreVertex1=function(){return this.m_coreV1},a.prototype.GetCoreVertex2=function(){return this.m_coreV2},a.prototype.GetNormalVector=function(){return this.m_normal},a.prototype.GetDirectionVector=function(){return this.m_direction},a.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},a.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},a.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},a.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},a.prototype.GetFirstVertex=function(e){var t=e.R;return new g(e.position.x+(t.col1.x*this.m_coreV1.x+t.col2.x*this.m_coreV1.y),e.position.y+(t.col1.y*this.m_coreV1.x+t.col2.y*this.m_coreV1.y))},a.prototype.GetNextEdge=function(){return this.m_nextEdge},a.prototype.GetPrevEdge=function(){return this.m_prevEdge},a.prototype.Support=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=e.R,i=e.position.x+(r.col1.x*this.m_coreV1.x+r.col2.x*this.m_coreV1.y),s=e.position.y+(r.col1.y*this.m_coreV1.x+r.col2.y*this.m_coreV1.y),o=e.position.x+(r.col1.x*this.m_coreV2.x+r.col2.x*this.m_coreV2.y),u=e.position.y+(r.col1.y*this.m_coreV2.x+r.col2.y*this.m_coreV2.y);return i*t+s*n>o*t+u*n?(this.s_supportVec.x=i,this.s_supportVec.y=s):(this.s_supportVec.x=o,this.s_supportVec.y=u),this.s_supportVec},a.prototype.b2EdgeShape=function(e,t){this.__super.b2Shape.call(this),this.m_type=c.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=e,this.m_v2=t,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-s.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-s.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-s.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-s.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},a.prototype.SetPrevEdge=function(e,t,n,r){this.m_prevEdge=e,this.m_coreV1=t,this.m_cornerDir1=n,this.m_cornerConvex1=r},a.prototype.SetNextEdge=function(e,t,n,r){this.m_nextEdge=e,this.m_coreV2=t,this.m_cornerDir2=n,this.m_cornerConvex2=r},f.b2MassData=function(){this.mass=0,this.center=new g(0,0),this.I=0},e.inherit(l,e.Collision.Shapes.b2Shape),l.prototype.__super=e.Collision.Shapes.b2Shape.prototype,l.b2PolygonShape=function(){e.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},l.prototype.Copy=function(){var e=new l;return e.Set(this),e},l.prototype.Set=function(t){this.__super.Set.call(this,t);if(e.is(t,l)){var n=t instanceof l?t:null;this.m_centroid.SetV(n.m_centroid),this.m_vertexCount=n.m_vertexCount,this.Reserve(this.m_vertexCount);for(var r=0;r<this.m_vertexCount;r++)this.m_vertices[r].SetV(n.m_vertices[r]),this.m_normals[r].SetV(n.m_normals[r])}},l.prototype.SetAsArray=function(e,n){n===undefined&&(n=0);var r=new t,i=0,s;for(i=0;i<e.length;++i)s=e[i],r.push(s);this.SetAsVector(r,n)},l.AsArray=function(e,t){t===undefined&&(t=0);var n=new l;return n.SetAsArray(e,t),n},l.prototype.SetAsVector=function(e,t){t===undefined&&(t=0),t==0&&(t=e.length),s.b2Assert(2<=t),this.m_vertexCount=t,this.Reserve(t);var n=0;for(n=0;n<this.m_vertexCount;n++)this.m_vertices[n].SetV(e[n]);for(n=0;n<this.m_vertexCount;++n){var r=parseInt(n),i=parseInt(n+1<this.m_vertexCount?n+1:0),o=d.SubtractVV(this.m_vertices[i],this.m_vertices[r]);s.b2Assert(o.LengthSquared()>Number.MIN_VALUE),this.m_normals[n].SetV(d.CrossVF(o,1)),this.m_normals[n].Normalize()}this.m_centroid=l.ComputeCentroid(this.m_vertices,this.m_vertexCount)},l.AsVector=function(e,t){t===undefined&&(t=0);var n=new l;return n.SetAsVector(e,t),n},l.prototype.SetAsBox=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},l.AsBox=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0);var n=new l;return n.SetAsBox(e,t),n},l.prototype.SetAsOrientedBox=function(e,t,n,r){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=null),r===undefined&&(r=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=n;var i=new m;i.position=n,i.R.Set(r);for(var s=0;s<this.m_vertexCount;++s)this.m_vertices[s]=d.MulX(i,this.m_vertices[s]),this.m_normals[s]=d.MulMV(i.R,this.m_normals[s])},l.AsOrientedBox=function(e,t,n,r){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=null),r===undefined&&(r=0);var i=new l;return i.SetAsOrientedBox(e,t,n,r),i},l.prototype.SetAsEdge=function(e,t){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(e),this.m_vertices[1].SetV(t),this.m_centroid.x=.5*(e.x+t.x),this.m_centroid.y=.5*(e.y+t.y),this.m_normals[0]=d.CrossVF(d.SubtractVV(t,e),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},l.AsEdge=function(e,t){var n=new l;return n.SetAsEdge(e,t),n},l.prototype.TestPoint=function(e,t){var n,r=e.R,i=t.x-e.position.x,s=t.y-e.position.y,o=i*r.col1.x+s*r.col1.y,u=i*r.col2.x+s*r.col2.y;for(var a=0;a<this.m_vertexCount;++a){n=this.m_vertices[a],i=o-n.x,s=u-n.y,n=this.m_normals[a];var f=n.x*i+n.y*s;if(f>0)return!1}return!0},l.prototype.RayCast=function(e,t,n){var r=0,i=t.maxFraction,s=0,o=0,u,a;s=t.p1.x-n.position.x,o=t.p1.y-n.position.y,u=n.R;var f=s*u.col1.x+o*u.col1.y,l=s*u.col2.x+o*u.col2.y;s=t.p2.x-n.position.x,o=t.p2.y-n.position.y,u=n.R;var c=s*u.col1.x+o*u.col1.y,h=s*u.col2.x+o*u.col2.y,p=c-f,d=h-l,v=parseInt(-1);for(var m=0;m<this.m_vertexCount;++m){a=this.m_vertices[m],s=a.x-f,o=a.y-l,a=this.m_normals[m];var g=a.x*s+a.y*o,y=a.x*p+a.y*d;if(y==0){if(g<0)return!1}else y<0&&g<r*y?(r=g/y,v=m):y>0&&g<i*y&&(i=g/y);if(i<r-Number.MIN_VALUE)return!1}return v>=0?(e.fraction=r,u=n.R,a=this.m_normals[v],e.normal.x=u.col1.x*a.x+u.col2.x*a.y,e.normal.y=u.col1.y*a.x+u.col2.y*a.y,!0):!1},l.prototype.ComputeAABB=function(e,t){var n=t.R,r=this.m_vertices[0],i=t.position.x+(n.col1.x*r.x+n.col2.x*r.y),s=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),o=i,u=s;for(var a=1;a<this.m_vertexCount;++a){r=this.m_vertices[a];var f=t.position.x+(n.col1.x*r.x+n.col2.x*r.y),l=t.position.y+(n.col1.y*r.x+n.col2.y*r.y);i=i<f?i:f,s=s<l?s:l,o=o>f?o:f,u=u>l?u:l}e.lowerBound.x=i-this.m_radius,e.lowerBound.y=s-this.m_radius,e.upperBound.x=o+this.m_radius,e.upperBound.y=u+this.m_radius},l.prototype.ComputeMass=function(e,t){t===undefined&&(t=0);if(this.m_vertexCount==2){e.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),e.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),e.mass=0,e.I=0;return}var n=0,r=0,i=0,s=0,o=0,u=0,a=1/3;for(var f=0;f<this.m_vertexCount;++f){var l=this.m_vertices[f],c=f+1<this.m_vertexCount?this.m_vertices[parseInt(f+1)]:this.m_vertices[0],h=l.x-o,p=l.y-u,d=c.x-o,v=c.y-u,m=h*v-p*d,g=.5*m;i+=g,n+=g*a*(o+l.x+c.x),r+=g*a*(u+l.y+c.y);var y=o,b=u,w=h,E=p,S=d,x=v,T=a*(.25*(w*w+S*w+S*S)+(y*w+y*S))+.5*y*y,N=a*(.25*(E*E+x*E+x*x)+(b*E+b*x))+.5*b*b;s+=m*(T+N)}e.mass=t*i,n*=1/i,r*=1/i,e.center.Set(n,r),e.I=t*s},l.prototype.ComputeSubmergedArea=function(e,t,r,i){t===undefined&&(t=0);var s=d.MulTMV(r.R,e),o=t-d.Dot(e,r.position),u=new n,a=0,l=parseInt(-1),c=parseInt(-1),h=!1,p=0;for(p=0;p<this.m_vertexCount;++p){u[p]=d.Dot(s,this.m_vertices[p])-o;var v=u[p]<-Number.MIN_VALUE;p>0&&(v?h||(l=p-1,a++):h&&(c=p-1,a++)),h=v}switch(a){case 0:if(h){var m=new f;return this.ComputeMass(m,1),i.SetV(d.MulX(r,m.center)),m.mass}return 0;case 1:l==-1?l=this.m_vertexCount-1:c=this.m_vertexCount-1}var y=parseInt((l+1)%this.m_vertexCount),b=parseInt((c+1)%this.m_vertexCount),w=(0-u[l])/(u[y]-u[l]),E=(0-u[c])/(u[b]-u[c]),S=new g(this.m_vertices[l].x*(1-w)+this.m_vertices[y].x*w,this.m_vertices[l].y*(1-w)+this.m_vertices[y].y*w),x=new g(this.m_vertices[c].x*(1-E)+this.m_vertices[b].x*E,this.m_vertices[c].y*(1-E)+this.m_vertices[b].y*E),T=0,N=new g,C=this.m_vertices[y],k;p=y;while(p!=b){p=(p+1)%this.m_vertexCount,p==b?k=x:k=this.m_vertices[p];var L=.5*((C.x-S.x)*(k.y-S.y)-(C.y-S.y)*(k.x-S.x));T+=L,N.x+=L*(S.x+C.x+k.x)/3,N.y+=L*(S.y+C.y+k.y)/3,C=k}return N.Multiply(1/T),i.SetV(d.MulX(r,N)),T},l.prototype.GetVertexCount=function(){return this.m_vertexCount},l.prototype.GetVertices=function(){return this.m_vertices},l.prototype.GetNormals=function(){return this.m_normals},l.prototype.GetSupport=function(e){var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},l.prototype.GetSupportVertex=function(e){var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},l.prototype.Validate=function(){return!1},l.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=c.e_polygonShape,this.m_centroid=new g,this.m_vertices=new t,this.m_normals=new t},l.prototype.Reserve=function(e){e===undefined&&(e=0);for(var t=parseInt(this.m_vertices.length);t<e;t++)this.m_vertices[t]=new g,this.m_normals[t]=new g},l.ComputeCentroid=function(e,t){t===undefined&&(t=0);var n=new g,r=0,i=0,s=0,o=1/3;for(var u=0;u<t;++u){var a=e[u],f=u+1<t?e[parseInt(u+1)]:e[0],l=a.x-i,c=a.y-s,h=f.x-i,p=f.y-s,d=l*p-c*h,v=.5*d;r+=v,n.x+=v*o*(i+a.x+f.x),n.y+=v*o*(s+a.y+f.y)}return n.x*=1/r,n.y*=1/r,n},l.ComputeOBB=function(e,n,r){r===undefined&&(r=0);var i=0,s=new t(r+1);for(i=0;i<r;++i)s[i]=n[i];s[r]=s[0];var o=Number.MAX_VALUE;for(i=1;i<=r;++i){var u=s[parseInt(i-1)],a=s[i].x-u.x,f=s[i].y-u.y,l=Math.sqrt(a*a+f*f);a/=l,f/=l;var c=-f,h=a,p=Number.MAX_VALUE,d=Number.MAX_VALUE,v=-Number.MAX_VALUE,m=-Number.MAX_VALUE;for(var g=0;g<r;++g){var y=s[g].x-u.x,b=s[g].y-u.y,w=a*y+f*b,E=c*y+h*b;w<p&&(p=w),E<d&&(d=E),w>v&&(v=w),E>m&&(m=E)}var S=(v-p)*(m-d);if(S<.95*o){o=S,e.R.col1.x=a,e.R.col1.y=f,e.R.col2.x=c,e.R.col2.y=h;var x=.5*(p+v),T=.5*(d+m),N=e.R;e.center.x=u.x+(N.col1.x*x+N.col2.x*T),e.center.y=u.y+(N.col1.y*x+N.col2.y*T),e.extents.x=.5*(v-p),e.extents.y=.5*(m-d)}}},e.postDefs.push(function(){e.Collision.Shapes.b2PolygonShape.s_mat=new h}),c.b2Shape=function(){},c.prototype.Copy=function(){return null},c.prototype.Set=function(e){this.m_radius=e.m_radius},c.prototype.GetType=function(){return this.m_type},c.prototype.TestPoint=function(e,t){return!1},c.prototype.RayCast=function(e,t,n){return!1},c.prototype.ComputeAABB=function(e,t){},c.prototype.ComputeMass=function(e,t){t===undefined&&(t=0)},c.prototype.ComputeSubmergedArea=function(e,t,n,r){return t===undefined&&(t=0),0},c.TestOverlap=function(e,t,n,r){var i=new q;i.proxyA=new U,i.proxyA.Set(e),i.proxyB=new U,i.proxyB.Set(n),i.transformA=t,i.transformB=r,i.useRadii=!0;var s=new tt;s.count=0;var o=new R;return I.Distance(o,s,i),o.distance<10*Number.MIN_VALUE},c.prototype.b2Shape=function(){this.m_type=c.e_unknownShape,this.m_radius=s.b2_linearSlop},e.postDefs.push(function(){e.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),e.Collision.Shapes.b2Shape.e_circleShape=0,e.Collision.Shapes.b2Shape.e_polygonShape=1,e.Collision.Shapes.b2Shape.e_edgeShape=2,e.Collision.Shapes.b2Shape.e_shapeTypeCount=3,e.Collision.Shapes.b2Shape.e_hitCollide=1,e.Collision.Shapes.b2Shape.e_missCollide=0,e.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var t=e.Common.b2Color,n=e.Common.b2internal,r=e.Common.b2Settings,i=e.Common.Math.b2Mat22,s=e.Common.Math.b2Mat33,o=e.Common.Math.b2Math,u=e.Common.Math.b2Sweep,a=e.Common.Math.b2Transform,f=e.Common.Math.b2Vec2,l=e.Common.Math.b2Vec3;t.b2Color=function(){this._r=0,this._g=0,this._b=0},t.prototype.b2Color=function(t,n,r){t===undefined&&(t=0),n===undefined&&(n=0),r===undefined&&(r=0),this._r=e.parseUInt(255*o.Clamp(t,0,1)),this._g=e.parseUInt(255*o.Clamp(n,0,1)),this._b=e.parseUInt(255*o.Clamp(r,0,1))},t.prototype.Set=function(t,n,r){t===undefined&&(t=0),n===undefined&&(n=0),r===undefined&&(r=0),this._r=e.parseUInt(255*o.Clamp(t,0,1)),this._g=e.parseUInt(255*o.Clamp(n,0,1)),this._b=e.parseUInt(255*o.Clamp(r,0,1))},Object.defineProperty(t.prototype,"r",{enumerable:!1,configurable:!0,set:function(t){t===undefined&&(t=0),this._r=e.parseUInt(255*o.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"g",{enumerable:!1,configurable:!0,set:function(t){t===undefined&&(t=0),this._g=e.parseUInt(255*o.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"b",{enumerable:!1,configurable:!0,set:function(t){t===undefined&&(t=0),this._b=e.parseUInt(255*o.Clamp(t,0,1))}}),Object.defineProperty(t.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),r.b2Settings=function(){},r.b2MixFriction=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),Math.sqrt(e*t)},r.b2MixRestitution=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e>t?e:t},r.b2Assert=function(e){if(!e)throw"Assertion Failed"},e.postDefs.push(function(){e.Common.b2Settings.VERSION="2.1alpha",e.Common.b2Settings.USHRT_MAX=65535,e.Common.b2Settings.b2_pi=Math.PI,e.Common.b2Settings.b2_maxManifoldPoints=2,e.Common.b2Settings.b2_aabbExtension=.1,e.Common.b2Settings.b2_aabbMultiplier=2,e.Common.b2Settings.b2_polygonRadius=2*r.b2_linearSlop,e.Common.b2Settings.b2_linearSlop=.005,e.Common.b2Settings.b2_angularSlop=2/180*r.b2_pi,e.Common.b2Settings.b2_toiSlop=8*r.b2_linearSlop,e.Common.b2Settings.b2_maxTOIContactsPerIsland=32,e.Common.b2Settings.b2_maxTOIJointsPerIsland=32,e.Common.b2Settings.b2_velocityThreshold=1,e.Common.b2Settings.b2_maxLinearCorrection=.2,e.Common.b2Settings.b2_maxAngularCorrection=8/180*r.b2_pi,e.Common.b2Settings.b2_maxTranslation=2,e.Common.b2Settings.b2_maxTranslationSquared=r.b2_maxTranslation*r.b2_maxTranslation,e.Common.b2Settings.b2_maxRotation=.5*r.b2_pi,e.Common.b2Settings.b2_maxRotationSquared=r.b2_maxRotation*r.b2_maxRotation,e.Common.b2Settings.b2_contactBaumgarte=.2,e.Common.b2Settings.b2_timeToSleep=.5,e.Common.b2Settings.b2_linearSleepTolerance=.01,e.Common.b2Settings.b2_angularSleepTolerance=2/180*r.b2_pi})}(),function(){var t=e.Collision.b2AABB,n=e.Common.b2Color,r=e.Common.b2internal,i=e.Common.b2Settings,s=e.Common.Math.b2Mat22,o=e.Common.Math.b2Mat33,u=e.Common.Math.b2Math,a=e.Common.Math.b2Sweep,f=e.Common.Math.b2Transform,l=e.Common.Math.b2Vec2,c=e.Common.Math.b2Vec3;s.b2Mat22=function(){this.col1=new l,this.col2=new l},s.prototype.b2Mat22=function(){this.SetIdentity()},s.FromAngle=function(e){e===undefined&&(e=0);var t=new s;return t.Set(e),t},s.FromVV=function(e,t){var n=new s;return n.SetVV(e,t),n},s.prototype.Set=function(e){e===undefined&&(e=0);var t=Math.cos(e),n=Math.sin(e);this.col1.x=t,this.col2.x=-n,this.col1.y=n,this.col2.y=t},s.prototype.SetVV=function(e,t){this.col1.SetV(e),this.col2.SetV(t)},s.prototype.Copy=function(){var e=new s;return e.SetM(this),e},s.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2)},s.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y},s.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},s.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},s.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},s.prototype.GetInverse=function(e){var t=this.col1.x,n=this.col2.x,r=this.col1.y,i=this.col2.y,s=t*i-n*r;return s!=0&&(s=1/s),e.col1.x=s*i,e.col2.x=-s*n,e.col1.y=-s*r,e.col2.y=s*t,e},s.prototype.Solve=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},s.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},o.b2Mat33=function(){this.col1=new c,this.col2=new c,this.col3=new c},o.prototype.b2Mat33=function(e,t,n){e===undefined&&(e=null),t===undefined&&(t=null),n===undefined&&(n=null),!e&&!t&&!n?(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero()):(this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n))},o.prototype.SetVVV=function(e,t,n){this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n)},o.prototype.Copy=function(){return new o(this.col1,this.col2,this.col3)},o.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2),this.col3.SetV(e.col3)},o.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col1.z+=e.col1.z,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y,this.col2.z+=e.col2.z,this.col3.x+=e.col3.x,this.col3.y+=e.col3.y,this.col3.z+=e.col3.z},o.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},o.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},o.prototype.Solve22=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},o.prototype.Solve33=function(e,t,n,r){t===undefined&&(t=0),n===undefined&&(n=0),r===undefined&&(r=0);var i=this.col1.x,s=this.col1.y,o=this.col1.z,u=this.col2.x,a=this.col2.y,f=this.col2.z,l=this.col3.x,c=this.col3.y,h=this.col3.z,p=i*(a*h-f*c)+s*(f*l-u*h)+o*(u*c-a*l);return p!=0&&(p=1/p),e.x=p*(t*(a*h-f*c)+n*(f*l-u*h)+r*(u*c-a*l)),e.y=p*(i*(n*h-r*c)+s*(r*l-t*h)+o*(t*c-n*l)),e.z=p*(i*(a*r-f*n)+s*(f*t-u*r)+o*(u*n-a*t)),e},u.b2Math=function(){},u.IsValid=function(e){return e===undefined&&(e=0),isFinite(e)},u.Dot=function(e,t){return e.x*t.x+e.y*t.y},u.CrossVV=function(e,t){return e.x*t.y-e.y*t.x},u.CrossVF=function(e,t){t===undefined&&(t=0);var n=new l(t*e.y,-t*e.x);return n},u.CrossFV=function(e,t){e===undefined&&(e=0);var n=new l(-e*t.y,e*t.x);return n},u.MulMV=function(e,t){var n=new l(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);return n},u.MulTMV=function(e,t){var n=new l(u.Dot(t,e.col1),u.Dot(t,e.col2));return n},u.MulX=function(e,t){var n=u.MulMV(e.R,t);return n.x+=e.position.x,n.y+=e.position.y,n},u.MulXT=function(e,t){var n=u.SubtractVV(t,e.position),r=n.x*e.R.col1.x+n.y*e.R.col1.y;return n.y=n.x*e.R.col2.x+n.y*e.R.col2.y,n.x=r,n},u.AddVV=function(e,t){var n=new l(e.x+t.x,e.y+t.y);return n},u.SubtractVV=function(e,t){var n=new l(e.x-t.x,e.y-t.y);return n},u.Distance=function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},u.DistanceSquared=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r},u.MulFV=function(e,t){e===undefined&&(e=0);var n=new l(e*t.x,e*t.y);return n},u.AddMM=function(e,t){var n=s.FromVV(u.AddVV(e.col1,t.col1),u.AddVV(e.col2,t.col2));return n},u.MulMM=function(e,t){var n=s.FromVV(u.MulMV(e,t.col1),u.MulMV(e,t.col2));return n},u.MulTMM=function(e,t){var n=new l(u.Dot(e.col1,t.col1),u.Dot(e.col2,t.col1)),r=new l(u.Dot(e.col1,t.col2),u.Dot(e.col2,t.col2)),i=s.FromVV(n,r);return i},u.Abs=function(e){return e===undefined&&(e=0),e>0?e:-e},u.AbsV=function(e){var t=new l(u.Abs(e.x),u.Abs(e.y));return t},u.AbsM=function(e){var t=s.FromVV(u.AbsV(e.col1),u.AbsV(e.col2));return t},u.Min=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e<t?e:t},u.MinV=function(e,t){var n=new l(u.Min(e.x,t.x),u.Min(e.y,t.y));return n},u.Max=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e>t?e:t},u.MaxV=function(e,t){var n=new l(u.Max(e.x,t.x),u.Max(e.y,t.y));return n},u.Clamp=function(e,t,n){return e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),e<t?t:e>n?n:e},u.ClampV=function(e,t,n){return u.MaxV(t,u.MinV(e,n))},u.Swap=function(e,t){var n=e[0];e[0]=t[0],t[0]=n},u.Random=function(){return Math.random()*2-1},u.RandomRange=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0);var n=Math.random();return n=(t-e)*n+e,n},u.NextPowerOfTwo=function(e){return e===undefined&&(e=0),e|=e>>1&2147483647,e|=e>>2&1073741823,e|=e>>4&268435455,e|=e>>8&16777215,e|=e>>16&65535,e+1},u.IsPowerOfTwo=function(e){e===undefined&&(e=0);var t=e>0&&(e&e-1)==0;return t},e.postDefs.push(function(){e.Common.Math.b2Math.b2Vec2_zero=new l(0,0),e.Common.Math.b2Math.b2Mat22_identity=s.FromVV(new l(1,0),new l(0,1)),e.Common.Math.b2Math.b2Transform_identity=new f(u.b2Vec2_zero,u.b2Mat22_identity)}),a.b2Sweep=function(){this.localCenter=new l,this.c0=new l,this.c=new l},a.prototype.Set=function(e){this.localCenter.SetV(e.localCenter),this.c0.SetV(e.c0),this.c.SetV(e.c),this.a0=e.a0,this.a=e.a,this.t0=e.t0},a.prototype.Copy=function(){var e=new a;return e.localCenter.SetV(this.localCenter),e.c0.SetV(this.c0),e.c.SetV(this.c),e.a0=this.a0,e.a=this.a,e.t0=this.t0,e},a.prototype.GetTransform=function(e,t){t===undefined&&(t=0),e.position.x=(1-t)*this.c0.x+t*this.c.x,e.position.y=(1-t)*this.c0.y+t*this.c.y;var n=(1-t)*this.a0+t*this.a;e.R.Set(n);var r=e.R;e.position.x-=r.col1.x*this.localCenter.x+r.col2.x*this.localCenter.y,e.position.y-=r.col1.y*this.localCenter.x+r.col2.y*this.localCenter.y},a.prototype.Advance=function(e){e===undefined&&(e=0);if(this.t0<e&&1-this.t0>Number.MIN_VALUE){var t=(e-this.t0)/(1-this.t0);this.c0.x=(1-t)*this.c0.x+t*this.c.x,this.c0.y=(1-t)*this.c0.y+t*this.c.y,this.a0=(1-t)*this.a0+t*this.a,this.t0=e}},f.b2Transform=function(){this.position=new l,this.R=new s},f.prototype.b2Transform=function(e,t){e===undefined&&(e=null),t===undefined&&(t=null),e&&(this.position.SetV(e),this.R.SetM(t))},f.prototype.Initialize=function(e,t){this.position.SetV(e),this.R.SetM(t)},f.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},f.prototype.Set=function(e){this.position.SetV(e.position),this.R.SetM(e.R)},f.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},l.b2Vec2=function(){},l.prototype.b2Vec2=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.x=e,this.y=t},l.prototype.SetZero=function(){this.x=0,this.y=0},l.prototype.Set=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.x=e,this.y=t},l.prototype.SetV=function(e){this.x=e.x,this.y=e.y},l.prototype.GetNegative=function(){return new l(-this.x,-this.y)},l.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},l.Make=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),new l(e,t)},l.prototype.Copy=function(){return new l(this.x,this.y)},l.prototype.Add=function(e){this.x+=e.x,this.y+=e.y},l.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y},l.prototype.Multiply=function(e){e===undefined&&(e=0),this.x*=e,this.y*=e},l.prototype.MulM=function(e){var t=this.x;this.x=e.col1.x*t+e.col2.x*this.y,this.y=e.col1.y*t+e.col2.y*this.y},l.prototype.MulTM=function(e){var t=u.Dot(this,e.col1);this.y=u.Dot(this,e.col2),this.x=t},l.prototype.CrossVF=function(e){e===undefined&&(e=0);var t=this.x;this.x=e*this.y,this.y=-e*t},l.prototype.CrossFV=function(e){e===undefined&&(e=0);var t=this.x;this.x=-e*this.y,this.y=e*t},l.prototype.MinV=function(e){this.x=this.x<e.x?this.x:e.x,this.y=this.y<e.y?this.y:e.y},l.prototype.MaxV=function(e){this.x=this.x>e.x?this.x:e.x,this.y=this.y>e.y?this.y:e.y},l.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},l.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},l.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},l.prototype.Normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);if(e<Number.MIN_VALUE)return 0;var t=1/e;return this.x*=t,this.y*=t,e},l.prototype.IsValid=function(){return u.IsValid(this.x)&&u.IsValid(this.y)},c.b2Vec3=function(){},c.prototype.b2Vec3=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.x=e,this.y=t,this.z=n},c.prototype.SetZero=function(){this.x=this.y=this.z=0},c.prototype.Set=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.x=e,this.y=t,this.z=n},c.prototype.SetV=function(e){this.x=e.x,this.y=e.y,this.z=e.z},c.prototype.GetNegative=function(){return new c(-this.x,-this.y,-this.z)},c.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},c.prototype.Copy=function(){return new c(this.x,this.y,this.z)},c.prototype.Add=function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},c.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},c.prototype.Multiply=function(e){e===undefined&&(e=0),this.x*=e,this.y*=e,this.z*=e}}(),function(){var r=e.Dynamics.Controllers.b2ControllerEdge,i=e.Common.Math.b2Mat22,s=e.Common.Math.b2Mat33,o=e.Common.Math.b2Math,u=e.Common.Math.b2Sweep,a=e.Common.Math.b2Transform,f=e.Common.Math.b2Vec2,l=e.Common.Math.b2Vec3,c=e.Common.b2Color,h=e.Common.b2internal,p=e.Common.b2Settings,d=e.Collision.b2AABB,v=e.Collision.b2Bound,m=e.Collision.b2BoundValues,g=e.Collision.b2Collision,y=e.Collision.b2ContactID,b=e.Collision.b2ContactPoint,w=e.Collision.b2Distance,E=e.Collision.b2DistanceInput,S=e.Collision.b2DistanceOutput,x=e.Collision.b2DistanceProxy,T=e.Collision.b2DynamicTree,N=e.Collision.b2DynamicTreeBroadPhase,C=e.Collision.b2DynamicTreeNode,k=e.Collision.b2DynamicTreePair,L=e.Collision.b2Manifold,A=e.Collision.b2ManifoldPoint,O=e.Collision.b2Point,M=e.Collision.b2RayCastInput,_=e.Collision.b2RayCastOutput,D=e.Collision.b2Segment,P=e.Collision.b2SeparationFunction,H=e.Collision.b2Simplex,B=e.Collision.b2SimplexCache,j=e.Collision.b2SimplexVertex,F=e.Collision.b2TimeOfImpact,I=e.Collision.b2TOIInput,q=e.Collision.b2WorldManifold,R=e.Collision.ClipVertex,U=e.Collision.Features,z=e.Collision.IBroadPhase,W=e.Collision.Shapes.b2CircleShape,X=e.Collision.Shapes.b2EdgeChainDef,V=e.Collision.Shapes.b2EdgeShape,$=e.Collision.Shapes.b2MassData,J=e.Collision.Shapes.b2PolygonShape,K=e.Collision.Shapes.b2Shape,Q=e.Dynamics.b2Body,G=e.Dynamics.b2BodyDef,Y=e.Dynamics.b2ContactFilter,Z=e.Dynamics.b2ContactImpulse,et=e.Dynamics.b2ContactListener,tt=e.Dynamics.b2ContactManager,nt=e.Dynamics.b2DebugDraw,rt=e.Dynamics.b2DestructionListener,it=e.Dynamics.b2FilterData,st=e.Dynamics.b2Fixture,ot=e.Dynamics.b2FixtureDef,ut=e.Dynamics.b2Island,at=e.Dynamics.b2TimeStep,ft=e.Dynamics.b2World,lt=e.Dynamics.Contacts.b2CircleContact,ct=e.Dynamics.Contacts.b2Contact,ht=e.Dynamics.Contacts.b2ContactConstraint,pt=e.Dynamics.Contacts.b2ContactConstraintPoint,dt=e.Dynamics.Contacts.b2ContactEdge,vt=e.Dynamics.Contacts.b2ContactFactory,mt=e.Dynamics.Contacts.b2ContactRegister,gt=e.Dynamics.Contacts.b2ContactResult,yt=e.Dynamics.Contacts.b2ContactSolver,bt=e.Dynamics.Contacts.b2EdgeAndCircleContact,wt=e.Dynamics.Contacts.b2NullContact,Et=e.Dynamics.Contacts.b2PolyAndCircleContact,St=e.Dynamics.Contacts.b2PolyAndEdgeContact,xt=e.Dynamics.Contacts.b2PolygonContact,Tt=e.Dynamics.Contacts.b2PositionSolverManifold,Nt=e.Dynamics.Controllers.b2Controller,Ct=e.Dynamics.Joints.b2DistanceJoint,kt=e.Dynamics.Joints.b2DistanceJointDef,Lt=e.Dynamics.Joints.b2FrictionJoint,At=e.Dynamics.Joints.b2FrictionJointDef,Ot=e.Dynamics.Joints.b2GearJoint,Mt=e.Dynamics.Joints.b2GearJointDef,_t=e.Dynamics.Joints.b2Jacobian,Dt=e.Dynamics.Joints.b2Joint,Pt=e.Dynamics.Joints.b2JointDef,Ht=e.Dynamics.Joints.b2JointEdge,Bt=e.Dynamics.Joints.b2LineJoint,jt=e.Dynamics.Joints.b2LineJointDef,Ft=e.Dynamics.Joints.b2MouseJoint,It=e.Dynamics.Joints.b2MouseJointDef,qt=e.Dynamics.Joints.b2PrismaticJoint,Rt=e.Dynamics.Joints.b2PrismaticJointDef,Ut=e.Dynamics.Joints.b2PulleyJoint,zt=e.Dynamics.Joints.b2PulleyJointDef,Wt=e.Dynamics.Joints.b2RevoluteJoint,Xt=e.Dynamics.Joints.b2RevoluteJointDef,Vt=e.Dynamics.Joints.b2WeldJoint,$t=e.Dynamics.Joints.b2WeldJointDef;Q.b2Body=function(){this.m_xf=new a,this.m_sweep=new u,this.m_linearVelocity=new f,this.m_force=new f},Q.prototype.connectEdges=function(e,t,n){n===undefined&&(n=0);var r=Math.atan2(t.GetDirectionVector().y,t.GetDirectionVector().x),i=Math.tan((r-n)*.5),s=o.MulFV(i,t.GetDirectionVector());s=o.SubtractVV(s,t.GetNormalVector()),s=o.MulFV(p.b2_toiSlop,s),s=o.AddVV(s,t.GetVertex1());var u=o.AddVV(e.GetDirectionVector(),t.GetDirectionVector());u.Normalize();var a=o.Dot(e.GetDirectionVector(),t.GetNormalVector())>0;return e.SetNextEdge(t,s,u,a),t.SetPrevEdge(e,s,u,a),r},Q.prototype.CreateFixture=function(e){if(this.m_world.IsLocked()==1)return null;var t=new st;t.Create(this,this.m_xf,e);if(this.m_flags&Q.e_activeFlag){var n=this.m_world.m_contactManager.m_broadPhase;t.CreateProxy(n,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,++this.m_fixtureCount,t.m_body=this,t.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=ft.e_newFixture,t},Q.prototype.CreateFixture2=function(e,t){t===undefined&&(t=0);var n=new ot;return n.shape=e,n.density=t,this.CreateFixture(n)},Q.prototype.DestroyFixture=function(e){if(this.m_world.IsLocked()==1)return;var t=this.m_fixtureList,n=null,r=!1;while(t!=null){if(t==e){n?n.m_next=e.m_next:this.m_fixtureList=e.m_next,r=!0;break}n=t,t=t.m_next}var i=this.m_contactList;while(i){var s=i.contact;i=i.next;var o=s.GetFixtureA(),u=s.GetFixtureB();(e==o||e==u)&&this.m_world.m_contactManager.Destroy(s)}if(this.m_flags&Q.e_activeFlag){var a=this.m_world.m_contactManager.m_broadPhase;e.DestroyProxy(a)}e.Destroy(),e.m_body=null,e.m_next=null,--this.m_fixtureCount,this.ResetMassData()},Q.prototype.SetPositionAndAngle=function(e,t){t===undefined&&(t=0);var n;if(this.m_world.IsLocked()==1)return;this.m_xf.R.Set(t),this.m_xf.position.SetV(e);var r=this.m_xf.R,i=this.m_sweep.localCenter;this.m_sweep.c.x=r.col1.x*i.x+r.col2.x*i.y,this.m_sweep.c.y=r.col1.y*i.x+r.col2.y*i.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=t;var s=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(s,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()},Q.prototype.SetTransform=function(e){this.SetPositionAndAngle(e.position,e.GetAngle())},Q.prototype.GetTransform=function(){return this.m_xf},Q.prototype.GetPosition=function(){return this.m_xf.position},Q.prototype.SetPosition=function(e){this.SetPositionAndAngle(e,this.GetAngle())},Q.prototype.GetAngle=function(){return this.m_sweep.a},Q.prototype.SetAngle=function(e){e===undefined&&(e=0),this.SetPositionAndAngle(this.GetPosition(),e)},Q.prototype.GetWorldCenter=function(){return this.m_sweep.c},Q.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},Q.prototype.SetLinearVelocity=function(e){if(this.m_type==Q.b2_staticBody)return;this.m_linearVelocity.SetV(e)},Q.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},Q.prototype.SetAngularVelocity=function(e){e===undefined&&(e=0);if(this.m_type==Q.b2_staticBody)return;this.m_angularVelocity=e},Q.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},Q.prototype.GetDefinition=function(){var e=new G;return e.type=this.GetType(),e.allowSleep=(this.m_flags&Q.e_allowSleepFlag)==Q.e_allowSleepFlag,e.angle=this.GetAngle(),e.angularDamping=this.m_angularDamping,e.angularVelocity=this.m_angularVelocity,e.fixedRotation=(this.m_flags&Q.e_fixedRotationFlag)==Q.e_fixedRotationFlag,e.bullet=(this.m_flags&Q.e_bulletFlag)==Q.e_bulletFlag,e.awake=(this.m_flags&Q.e_awakeFlag)==Q.e_awakeFlag,e.linearDamping=this.m_linearDamping,e.linearVelocity.SetV(this.GetLinearVelocity()),e.position=this.GetPosition(),e.userData=this.GetUserData(),e},Q.prototype.ApplyForce=function(e,t){if(this.m_type!=Q.b2_dynamicBody)return;this.IsAwake()==0&&this.SetAwake(!0),this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x},Q.prototype.ApplyTorque=function(e){e===undefined&&(e=0);if(this.m_type!=Q.b2_dynamicBody)return;this.IsAwake()==0&&this.SetAwake(!0),this.m_torque+=e},Q.prototype.ApplyImpulse=function(e,t){if(this.m_type!=Q.b2_dynamicBody)return;this.IsAwake()==0&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x)},Q.prototype.Split=function(e){var t=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),r=this.GetWorldCenter(),i=this,s=this.m_world.CreateBody(this.GetDefinition()),u;for(var a=i.m_fixtureList;a;)if(e(a)){var f=a.m_next;u?u.m_next=f:i.m_fixtureList=f,i.m_fixtureCount--,a.m_next=s.m_fixtureList,s.m_fixtureList=a,s.m_fixtureCount++,a.m_body=s,a=f}else u=a,a=a.m_next;i.ResetMassData(),s.ResetMassData();var l=i.GetWorldCenter(),c=s.GetWorldCenter(),h=o.AddVV(t,o.CrossFV(n,o.SubtractVV(l,r))),p=o.AddVV(t,o.CrossFV(n,o.SubtractVV(c,r)));return i.SetLinearVelocity(h),s.SetLinearVelocity(p),i.SetAngularVelocity(n),s.SetAngularVelocity(n),i.SynchronizeFixtures(),s.SynchronizeFixtures(),s},Q.prototype.Merge=function(e){var t;for(t=e.m_fixtureList;t;){var n=t.m_next;e.m_fixtureCount--,t.m_next=this.m_fixtureList,this.m_fixtureList=t,this.m_fixtureCount++,t.m_body=i,t=n}r.m_fixtureCount=0;var r=this,i=e,s=r.GetWorldCenter(),o=i.GetWorldCenter(),u=r.GetLinearVelocity().Copy(),a=i.GetLinearVelocity().Copy(),f=r.GetAngularVelocity(),l=i.GetAngularVelocity();r.ResetMassData(),this.SynchronizeFixtures()},Q.prototype.GetMass=function(){return this.m_mass},Q.prototype.GetInertia=function(){return this.m_I},Q.prototype.GetMassData=function(e){e.mass=this.m_mass,e.I=this.m_I,e.center.SetV(this.m_sweep.localCenter)},Q.prototype.SetMassData=function(e){p.b2Assert(this.m_world.IsLocked()==0);if(this.m_world.IsLocked()==1)return;if(this.m_type!=Q.b2_dynamicBody)return;this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&(this.m_flags&Q.e_fixedRotationFlag)==0&&(this.m_I=e.I-this.m_mass*(e.center.x*e.center.x+e.center.y*e.center.y),this.m_invI=1/this.m_I);var t=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e.center),this.m_sweep.c0.SetV(o.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-t.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-t.x)},Q.prototype.ResetMassData=function(){this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero();if(this.m_type==Q.b2_staticBody||this.m_type==Q.b2_kinematicBody)return;var e=f.Make(0,0);for(var t=this.m_fixtureList;t;t=t.m_next){if(t.m_density==0)continue;var n=t.GetMassData();this.m_mass+=n.mass,e.x+=n.center.x*n.mass,e.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&(this.m_flags&Q.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(e.x*e.x+e.y*e.y),this.m_I*=this.m_inertiaScale,p.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var r=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e),this.m_sweep.c0.SetV(o.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-r.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-r.x)},Q.prototype.GetWorldPoint=function(e){var t=this.m_xf.R,n=new f(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return n.x+=this.m_xf.position.x,n.y+=this.m_xf.position.y,n},Q.prototype.GetWorldVector=function(e){return o.MulMV(this.m_xf.R,e)},Q.prototype.GetLocalPoint=function(e){return o.MulXT(this.m_xf,e)},Q.prototype.GetLocalVector=function(e){return o.MulTMV(this.m_xf.R,e)},Q.prototype.GetLinearVelocityFromWorldPoint=function(e){return new f(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},Q.prototype.GetLinearVelocityFromLocalPoint=function(e){var t=this.m_xf.R,n=new f(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return n.x+=this.m_xf.position.x,n.y+=this.m_xf.position.y,new f(this.m_linearVelocity.x-this.m_angularVelocity*(n.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(n.x-this.m_sweep.c.x))},Q.prototype.GetLinearDamping=function(){return this.m_linearDamping},Q.prototype.SetLinearDamping=function(e){e===undefined&&(e=0),this.m_linearDamping=e},Q.prototype.GetAngularDamping=function(){return this.m_angularDamping},Q.prototype.SetAngularDamping=function(e){e===undefined&&(e=0),this.m_angularDamping=e},Q.prototype.SetType=function(e){e===undefined&&(e=0);if(this.m_type==e)return;this.m_type=e,this.ResetMassData(),this.m_type==Q.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var t=this.m_contactList;t;t=t.next)t.contact.FlagForFiltering()},Q.prototype.GetType=function(){return this.m_type},Q.prototype.SetBullet=function(e){e?this.m_flags|=Q.e_bulletFlag:this.m_flags&=~Q.e_bulletFlag},Q.prototype.IsBullet=function(){return(this.m_flags&Q.e_bulletFlag)==Q.e_bulletFlag},Q.prototype.SetSleepingAllowed=function(e){e?this.m_flags|=Q.e_allowSleepFlag:(this.m_flags&=~Q.e_allowSleepFlag,this.SetAwake(!0))},Q.prototype.SetAwake=function(e){e?(this.m_flags|=Q.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~Q.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},Q.prototype.IsAwake=function(){return(this.m_flags&Q.e_awakeFlag)==Q.e_awakeFlag},Q.prototype.SetFixedRotation=function(e){e?this.m_flags|=Q.e_fixedRotationFlag:this.m_flags&=~Q.e_fixedRotationFlag,this.ResetMassData()},Q.prototype.IsFixedRotation=function(){return(this.m_flags&Q.e_fixedRotationFlag)==Q.e_fixedRotationFlag},Q.prototype.SetActive=function(e){if(e==this.IsActive())return;var t,n;if(e){this.m_flags|=Q.e_activeFlag,t=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next)n.CreateProxy(t,this.m_xf)}else{this.m_flags&=~Q.e_activeFlag,t=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next)n.DestroyProxy(t);var r=this.m_contactList;while(r){var i=r;r=r.next,this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null}},Q.prototype.IsActive=function(){return(this.m_flags&Q.e_activeFlag)==Q.e_activeFlag},Q.prototype.IsSleepingAllowed=function(){return(this.m_flags&Q.e_allowSleepFlag)==Q.e_allowSleepFlag},Q.prototype.GetFixtureList=function(){return this.m_fixtureList},Q.prototype.GetJointList=function(){return this.m_jointList},Q.prototype.GetControllerList=function(){return this.m_controllerList},Q.prototype.GetContactList=function(){return this.m_contactList},Q.prototype.GetNext=function(){return this.m_next},Q.prototype.GetUserData=function(){return this.m_userData},Q.prototype.SetUserData=function(e){this.m_userData=e},Q.prototype.GetWorld=function(){return this.m_world},Q.prototype.b2Body=function(e,t){this.m_flags=0,e.bullet&&(this.m_flags|=Q.e_bulletFlag),e.fixedRotation&&(this.m_flags|=Q.e_fixedRotationFlag),e.allowSleep&&(this.m_flags|=Q.e_allowSleepFlag),e.awake&&(this.m_flags|=Q.e_awakeFlag),e.active&&(this.m_flags|=Q.e_activeFlag),this.m_world=t,this.m_xf.position.SetV(e.position),this.m_xf.R.Set(e.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=e.angle;var n=this.m_xf.R,r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=e.type,this.m_type==Q.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=e.inertiaScale,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0},Q.prototype.SynchronizeFixtures=function(){var e=Q.s_xf1;e.R.Set(this.m_sweep.a0);var t=e.R,n=this.m_sweep.localCenter;e.position.x=this.m_sweep.c0.x-(t.col1.x*n.x+t.col2.x*n.y),e.position.y=this.m_sweep.c0.y-(t.col1.y*n.x+t.col2.y*n.y);var r,i=this.m_world.m_contactManager.m_broadPhase;for(r=this.m_fixtureList;r;r=r.m_next)r.Synchronize(i,e,this.m_xf)},Q.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var e=this.m_xf.R,t=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(e.col1.x*t.x+e.col2.x*t.y),this.m_xf.position.y=this.m_sweep.c.y-(e.col1.y*t.x+e.col2.y*t.y)},Q.prototype.ShouldCollide=function(e){if(this.m_type!=Q.b2_dynamicBody&&e.m_type!=Q.b2_dynamicBody)return!1;for(var t=this.m_jointList;t;t=t.next)if(t.other==e&&t.joint.m_collideConnected==0)return!1;return!0},Q.prototype.Advance=function(e){e===undefined&&(e=0),this.m_sweep.Advance(e),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},e.postDefs.push(function(){e.Dynamics.b2Body.s_xf1=new a,e.Dynamics.b2Body.e_islandFlag=1,e.Dynamics.b2Body.e_awakeFlag=2,e.Dynamics.b2Body.e_allowSleepFlag=4,e.Dynamics.b2Body.e_bulletFlag=8,e.Dynamics.b2Body.e_fixedRotationFlag=16,e.Dynamics.b2Body.e_activeFlag=32,e.Dynamics.b2Body.b2_staticBody=0,e.Dynamics.b2Body.b2_kinematicBody=1,e.Dynamics.b2Body.b2_dynamicBody=2}),G.b2BodyDef=function(){this.position=new f,this.linearVelocity=new f},G.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=Q.b2_staticBody,this.active=!0,this.inertiaScale=1},Y.b2ContactFilter=function(){},Y.prototype.ShouldCollide=function(e,t){var n=e.GetFilterData(),r=t.GetFilterData();if(n.groupIndex==r.groupIndex&&n.groupIndex!=0)return n.groupIndex>0;var i=(n.maskBits&r.categoryBits)!=0&&(n.categoryBits&r.maskBits)!=0;return i},Y.prototype.RayCollide=function(e,t){return e?this.ShouldCollide(e instanceof st?e:null,t):!0},e.postDefs.push(function(){e.Dynamics.b2ContactFilter.b2_defaultFilter=new Y}),Z.b2ContactImpulse=function(){this.normalImpulses=new n(p.b2_maxManifoldPoints),this.tangentImpulses=new n(p.b2_maxManifoldPoints)},et.b2ContactListener=function(){},et.prototype.BeginContact=function(e){},et.prototype.EndContact=function(e){},et.prototype.PreSolve=function(e,t){},et.prototype.PostSolve=function(e,t){},e.postDefs.push(function(){e.Dynamics.b2ContactListener.b2_defaultListener=new et}),tt.b2ContactManager=function(){},tt.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=Y.b2_defaultFilter,this.m_contactListener=et.b2_defaultListener,this.m_contactFactory=new vt(this.m_allocator),this.m_broadPhase=new N},tt.prototype.AddPair=function(e,t){var n=e instanceof st?e:null,r=t instanceof st?t:null,i=n.GetBody(),s=r.GetBody();if(i==s)return;var o=s.GetContactList();while(o){if(o.other==i){var u=o.contact.GetFixtureA(),a=o.contact.GetFixtureB();if(u==n&&a==r)return;if(u==r&&a==n)return}o=o.next}if(s.ShouldCollide(i)==0)return;if(this.m_contactFilter.ShouldCollide(n,r)==0)return;var f=this.m_contactFactory.Create(n,r);n=f.GetFixtureA(),r=f.GetFixtureB(),i=n.m_body,s=r.m_body,f.m_prev=null,f.m_next=this.m_world.m_contactList,this.m_world.m_contactList!=null&&(this.m_world.m_contactList.m_prev=f),this.m_world.m_contactList=f,f.m_nodeA.contact=f,f.m_nodeA.other=s,f.m_nodeA.prev=null,f.m_nodeA.next=i.m_contactList,i.m_contactList!=null&&(i.m_contactList.prev=f.m_nodeA),i.m_contactList=f.m_nodeA,f.m_nodeB.contact=f,f.m_nodeB.other=i,f.m_nodeB.prev=null,f.m_nodeB.next=s.m_contactList,s.m_contactList!=null&&(s.m_contactList.prev=f.m_nodeB),s.m_contactList=f.m_nodeB,++this.m_world.m_contactCount;return},tt.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(e.generateCallback(this,this.AddPair))},tt.prototype.Destroy=function(e){var t=e.GetFixtureA(),n=e.GetFixtureB(),r=t.GetBody(),i=n.GetBody();e.IsTouching()&&this.m_contactListener.EndContact(e),e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_world.m_contactList&&(this.m_world.m_contactList=e.m_next),e.m_nodeA.prev&&(e.m_nodeA.prev.next=e.m_nodeA.next),e.m_nodeA.next&&(e.m_nodeA.next.prev=e.m_nodeA.prev),e.m_nodeA==r.m_contactList&&(r.m_contactList=e.m_nodeA.next),e.m_nodeB.prev&&(e.m_nodeB.prev.next=e.m_nodeB.next),e.m_nodeB.next&&(e.m_nodeB.next.prev=e.m_nodeB.prev),e.m_nodeB==i.m_contactList&&(i.m_contactList=e.m_nodeB.next),this.m_contactFactory.Destroy(e),--this.m_contactCount},tt.prototype.Collide=function(){var e=this.m_world.m_contactList;while(e){var t=e.GetFixtureA(),n=e.GetFixtureB(),r=t.GetBody(),i=n.GetBody();if(r.IsAwake()==0&&i.IsAwake()==0){e=e.GetNext();continue}if(e.m_flags&ct.e_filterFlag){if(i.ShouldCollide(r)==0){var s=e;e=s.GetNext(),this.Destroy(s);continue}if(this.m_contactFilter.ShouldCollide(t,n)==0){s=e,e=s.GetNext(),this.Destroy(s);continue}e.m_flags&=~ct.e_filterFlag}var o=t.m_proxy,u=n.m_proxy,a=this.m_broadPhase.TestOverlap(o,u);if(a==0){s=e,e=s.GetNext(),this.Destroy(s);continue}e.Update(this.m_contactListener),e=e.GetNext()}},e.postDefs.push(function(){e.Dynamics.b2ContactManager.s_evalCP=new b}),nt.b2DebugDraw=function(){},nt.prototype.b2DebugDraw=function(){},nt.prototype.SetFlags=function(e){e===undefined&&(e=0)},nt.prototype.GetFlags=function(){},nt.prototype.AppendFlags=function(e){e===undefined&&(e=0)},nt.prototype.ClearFlags=function(e){e===undefined&&(e=0)},nt.prototype.SetSprite=function(e){},nt.prototype.GetSprite=function(){},nt.prototype.SetDrawScale=function(e){e===undefined&&(e=0)},nt.prototype.GetDrawScale=function(){},nt.prototype.SetLineThickness=function(e){e===undefined&&(e=0)},nt.prototype.GetLineThickness=function(){},nt.prototype.SetAlpha=function(e){e===undefined&&(e=0)},nt.prototype.GetAlpha=function(){},nt.prototype.SetFillAlpha=function(e){e===undefined&&(e=0)},nt.prototype.GetFillAlpha=function(){},nt.prototype.SetXFormScale=function(e){e===undefined&&(e=0)},nt.prototype.GetXFormScale=function(){},nt.prototype.DrawPolygon=function(e,t,n){t===undefined&&(t=0)},nt.prototype.DrawSolidPolygon=function(e,t,n){t===undefined&&(t=0)},nt.prototype.DrawCircle=function(e,t,n){t===undefined&&(t=0)},nt.prototype.DrawSolidCircle=function(e,t,n,r){t===undefined&&(t=0)},nt.prototype.DrawSegment=function(e,t,n){},nt.prototype.DrawTransform=function(e){},e.postDefs.push(function(){e.Dynamics.b2DebugDraw.e_shapeBit=1,e.Dynamics.b2DebugDraw.e_jointBit=2,e.Dynamics.b2DebugDraw.e_aabbBit=4,e.Dynamics.b2DebugDraw.e_pairBit=8,e.Dynamics.b2DebugDraw.e_centerOfMassBit=16,e.Dynamics.b2DebugDraw.e_controllerBit=32}),rt.b2DestructionListener=function(){},rt.prototype.SayGoodbyeJoint=function(e){},rt.prototype.SayGoodbyeFixture=function(e){},it.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},it.prototype.Copy=function(){var e=new it;return e.categoryBits=this.categoryBits,e.maskBits=this.maskBits,e.groupIndex=this.groupIndex,e},st.b2Fixture=function(){this.m_filter=new it},st.prototype.GetType=function(){return this.m_shape.GetType()},st.prototype.GetShape=function(){return this.m_shape},st.prototype.SetSensor=function(e){if(this.m_isSensor==e)return;this.m_isSensor=e;if(this.m_body==null)return;var t=this.m_body.GetContactList();while(t){var n=t.contact,r=n.GetFixtureA(),i=n.GetFixtureB();(r==this||i==this)&&n.SetSensor(r.IsSensor()||i.IsSensor()),t=t.next}},st.prototype.IsSensor=function(){return this.m_isSensor},st.prototype.SetFilterData=function(e){this.m_filter=e.Copy();if(this.m_body)return;var t=this.m_body.GetContactList();while(t){var n=t.contact,r=n.GetFixtureA(),i=n.GetFixtureB();(r==this||i==this)&&n.FlagForFiltering(),t=t.next}},st.prototype.GetFilterData=function(){return this.m_filter.Copy()},st.prototype.GetBody=function(){return this.m_body},st.prototype.GetNext=function(){return this.m_next},st.prototype.GetUserData=function(){return this.m_userData},st.prototype.SetUserData=function(e){this.m_userData=e},st.prototype.TestPoint=function(e){return this.m_shape.TestPoint(this.m_body.GetTransform(),e)},st.prototype.RayCast=function(e,t){return this.m_shape.RayCast(e,t,this.m_body.GetTransform())},st.prototype.GetMassData=function(e){return e===undefined&&(e=null),e==null&&(e=new $),this.m_shape.ComputeMass(e,this.m_density),e},st.prototype.SetDensity=function(e){e===undefined&&(e=0),this.m_density=e},st.prototype.GetDensity=function(){return this.m_density},st.prototype.GetFriction=function(){return this.m_friction},st.prototype.SetFriction=function(e){e===undefined&&(e=0),this.m_friction=e},st.prototype.GetRestitution=function(){return this.m_restitution},st.prototype.SetRestitution=function(e){e===undefined&&(e=0),this.m_restitution=e},st.prototype.GetAABB=function(){return this.m_aabb},st.prototype.b2Fixture=function(){this.m_aabb=new d,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},st.prototype.Create=function(e,t,n){this.m_userData=n.userData,this.m_friction=n.friction,this.m_restitution=n.restitution,this.m_body=e,this.m_next=null,this.m_filter=n.filter.Copy(),this.m_isSensor=n.isSensor,this.m_shape=n.shape.Copy(),this.m_density=n.density},st.prototype.Destroy=function(){this.m_shape=null},st.prototype.CreateProxy=function(e,t){this.m_shape.ComputeAABB(this.m_aabb,t),this.m_proxy=e.CreateProxy(this.m_aabb,this)},st.prototype.DestroyProxy=function(e){if(this.m_proxy==null)return;e.DestroyProxy(this.m_proxy),this.m_proxy=null},st.prototype.Synchronize=function(e,t,n){if(!this.m_proxy)return;var r=new d,i=new d;this.m_shape.ComputeAABB(r,t),this.m_shape.ComputeAABB(i,n),this.m_aabb.Combine(r,i);var s=o.SubtractVV(n.position,t.position);e.MoveProxy(this.m_proxy,this.m_aabb,s)},ot.b2FixtureDef=function(){this.filter=new it},ot.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},ut.b2Island=function(){},ut.prototype.b2Island=function(){this.m_bodies=new t,this.m_contacts=new t,this.m_joints=new t},ut.prototype.Initialize=function(e,t,n,r,i,s){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0);var o=0;this.m_bodyCapacity=e,this.m_contactCapacity=t,this.m_jointCapacity=n,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=r,this.m_listener=i,this.m_contactSolver=s;for(o=this.m_bodies.length;o<e;o++)this.m_bodies[o]=null;for(o=this.m_contacts.length;o<t;o++)this.m_contacts[o]=null;for(o=this.m_joints.length;o<n;o++)this.m_joints[o]=null},ut.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},ut.prototype.Solve=function(e,t,n){var r=0,i=0,s,u;for(r=0;r<this.m_bodyCount;++r){s=this.m_bodies[r];if(s.GetType()!=Q.b2_dynamicBody)continue;s.m_linearVelocity.x+=e.dt*(t.x+s.m_invMass*s.m_force.x),s.m_linearVelocity.y+=e.dt*(t.y+s.m_invMass*s.m_force.y),s.m_angularVelocity+=e.dt*s.m_invI*s.m_torque,s.m_linearVelocity.Multiply(o.Clamp(1-e.dt*s.m_linearDamping,0,1)),s.m_angularVelocity*=o.Clamp(1-e.dt*s.m_angularDamping,0,1)}this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var a=this.m_contactSolver;a.InitVelocityConstraints(e);for(r=0;r<this.m_jointCount;++r)u=this.m_joints[r],u.InitVelocityConstraints(e);for(r=0;r<e.velocityIterations;++r){for(i=0;i<this.m_jointCount;++i)u=this.m_joints[i],u.SolveVelocityConstraints(e);a.SolveVelocityConstraints()}for(r=0;r<this.m_jointCount;++r)u=this.m_joints[r],u.FinalizeVelocityConstraints();a.FinalizeVelocityConstraints();for(r=0;r<this.m_bodyCount;++r){s=this.m_bodies[r];if(s.GetType()==Q.b2_staticBody)continue;var f=e.dt*s.m_linearVelocity.x,l=e.dt*s.m_linearVelocity.y;f*f+l*l>p.b2_maxTranslationSquared&&(s.m_linearVelocity.Normalize(),s.m_linearVelocity.x*=p.b2_maxTranslation*e.inv_dt,s.m_linearVelocity.y*=p.b2_maxTranslation*e.inv_dt);var c=e.dt*s.m_angularVelocity;c*c>p.b2_maxRotationSquared&&(s.m_angularVelocity<0?s.m_angularVelocity=-p.b2_maxRotation*e.inv_dt:s.m_angularVelocity=p.b2_maxRotation*e.inv_dt),s.m_sweep.c0.SetV(s.m_sweep.c),s.m_sweep.a0=s.m_sweep.a,s.m_sweep.c.x+=e.dt*s.m_linearVelocity.x,s.m_sweep.c.y+=e.dt*s.m_linearVelocity.y,s.m_sweep.a+=e.dt*s.m_angularVelocity,s.SynchronizeTransform()}for(r=0;r<e.positionIterations;++r){var h=a.SolvePositionConstraints(p.b2_contactBaumgarte),d=!0;for(i=0;i<this.m_jointCount;++i){u=this.m_joints[i];var v=u.SolvePositionConstraints(p.b2_contactBaumgarte);d=d&&v}if(h&&d)break}this.Report(a.m_constraints);if(n){var m=Number.MAX_VALUE,g=p.b2_linearSleepTolerance*p.b2_linearSleepTolerance,y=p.b2_angularSleepTolerance*p.b2_angularSleepTolerance;for(r=0;r<this.m_bodyCount;++r){s=this.m_bodies[r];if(s.GetType()==Q.b2_staticBody)continue;(s.m_flags&Q.e_allowSleepFlag)==0&&(s.m_sleepTime=0,m=0),(s.m_flags&Q.e_allowSleepFlag)==0||s.m_angularVelocity*s.m_angularVelocity>y||o.Dot(s.m_linearVelocity,s.m_linearVelocity)>g?(s.m_sleepTime=0,m=0):(s.m_sleepTime+=e.dt,m=o.Min(m,s.m_sleepTime))}if(m>=p.b2_timeToSleep)for(r=0;r<this.m_bodyCount;++r)s=this.m_bodies[r],s.SetAwake(!1)}},ut.prototype.SolveTOI=function(e){var t=0,n=0;this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var r=this.m_contactSolver;for(t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(e);for(t=0;t<e.velocityIterations;++t){r.SolveVelocityConstraints();for(n=0;n<this.m_jointCount;++n)this.m_joints[n].SolveVelocityConstraints(e)}for(t=0;t<this.m_bodyCount;++t){var i=this.m_bodies[t];if(i.GetType()==Q.b2_staticBody)continue;var s=e.dt*i.m_linearVelocity.x,o=e.dt*i.m_linearVelocity.y;s*s+o*o>p.b2_maxTranslationSquared&&(i.m_linearVelocity.Normalize(),i.m_linearVelocity.x*=p.b2_maxTranslation*e.inv_dt,i.m_linearVelocity.y*=p.b2_maxTranslation*e.inv_dt);var u=e.dt*i.m_angularVelocity;u*u>p.b2_maxRotationSquared&&(i.m_angularVelocity<0?i.m_angularVelocity=-p.b2_maxRotation*e.inv_dt:i.m_angularVelocity=p.b2_maxRotation*e.inv_dt),i.m_sweep.c0.SetV(i.m_sweep.c),i.m_sweep.a0=i.m_sweep.a,i.m_sweep.c.x+=e.dt*i.m_linearVelocity.x,i.m_sweep.c.y+=e.dt*i.m_linearVelocity.y,i.m_sweep.a+=e.dt*i.m_angularVelocity,i.SynchronizeTransform()}var a=.75;for(t=0;t<e.positionIterations;++t){var f=r.SolvePositionConstraints(a),l=!0;for(n=0;n<this.m_jointCount;++n){var c=this.m_joints[n].SolvePositionConstraints(p.b2_contactBaumgarte);l=l&&c}if(f&&l)break}this.Report(r.m_constraints)},ut.prototype.Report=function(e){if(this.m_listener==null)return;for(var t=0;t<this.m_contactCount;++t){var n=this.m_contacts[t],r=e[t];for(var i=0;i<r.pointCount;++i)ut.s_impulse.normalImpulses[i]=r.points[i].normalImpulse,ut.s_impulse.tangentImpulses[i]=r.points[i].tangentImpulse;this.m_listener.PostSolve(n,ut.s_impulse)}},ut.prototype.AddBody=function(e){e.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=e},ut.prototype.AddContact=function(e){this.m_contacts[this.m_contactCount++]=e},ut.prototype.AddJoint=function(e){this.m_joints[this.m_jointCount++]=e},e.postDefs.push(function(){e.Dynamics.b2Island.s_impulse=new Z}),at.b2TimeStep=function(){},at.prototype.Set=function(e){this.dt=e.dt,this.inv_dt=e.inv_dt,this.positionIterations=e.positionIterations,this.velocityIterations=e.velocityIterations,this.warmStarting=e.warmStarting},ft.b2World=function(){this.s_stack=new t,this.m_contactManager=new tt,this.m_contactSolver=new yt,this.m_island=new ut},ft.prototype.b2World=function(e,t){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,ft.m_warmStarting=!0,ft.m_continuousPhysics=!0,this.m_allowSleep=t,this.m_gravity=e,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var n=new G;this.m_groundBody=this.CreateBody(n)},ft.prototype.SetDestructionListener=function(e){this.m_destructionListener=e},ft.prototype.SetContactFilter=function(e){this.m_contactManager.m_contactFilter=e},ft.prototype.SetContactListener=function(e){this.m_contactManager.m_contactListener=e},ft.prototype.SetDebugDraw=function(e){this.m_debugDraw=e},ft.prototype.SetBroadPhase=function(e){var t=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=e;for(var n=this.m_bodyList;n;n=n.m_next)for(var r=n.m_fixtureList;r;r=r.m_next)r.m_proxy=e.CreateProxy(t.GetFatAABB(r.m_proxy),r)},ft.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},ft.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},ft.prototype.CreateBody=function(e){if(this.IsLocked()==1)return null;var t=new Q(e,this);return t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount,t},ft.prototype.DestroyBody=function(e){if(this.IsLocked()==1)return;var t=e.m_jointList;while(t){var n=t;t=t.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(n.joint),this.DestroyJoint(n.joint)}var r=e.m_controllerList;while(r){var i=r;r=r.nextController,i.controller.RemoveBody(e)}var s=e.m_contactList;while(s){var o=s;s=s.next,this.m_contactManager.Destroy(o.contact)}e.m_contactList=null;var u=e.m_fixtureList;while(u){var a=u;u=u.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(a),a.DestroyProxy(this.m_contactManager.m_broadPhase),a.Destroy()}e.m_fixtureList=null,e.m_fixtureCount=0,e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_bodyList&&(this.m_bodyList=e.m_next),--this.m_bodyCount},ft.prototype.CreateJoint=function(e){var t=Dt.Create(e,null);t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB;var n=e.bodyA,r=e.bodyB;if(e.collideConnected==0){var i=r.GetContactList();while(i)i.other==n&&i.contact.FlagForFiltering(),i=i.next}return t},ft.prototype.DestroyJoint=function(e){var t=e.m_collideConnected;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_jointList&&(this.m_jointList=e.m_next);var n=e.m_bodyA,r=e.m_bodyB;n.SetAwake(!0),r.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA==n.m_jointList&&(n.m_jointList=e.m_edgeA.next),e.m_edgeA.prev=null,e.m_edgeA.next=null,e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB==r.m_jointList&&(r.m_jointList=e.m_edgeB.next),e.m_edgeB.prev=null,e.m_edgeB.next=null,Dt.Destroy(e,null),--this.m_jointCount;if(t==0){var i=r.GetContactList();while(i)i.other==n&&i.contact.FlagForFiltering(),i=i.next}},ft.prototype.AddController=function(e){return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList=e,e.m_world=this,this.m_controllerCount++,e},ft.prototype.RemoveController=function(e){e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),this.m_controllerList==e&&(this.m_controllerList=e.m_next),this.m_controllerCount--},ft.prototype.CreateController=function(e){if(e.m_world!=this)throw new Error("Controller can only be a member of one world");return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=e),this.m_controllerList=e,++this.m_controllerCount,e.m_world=this,e},ft.prototype.DestroyController=function(e){e.Clear(),e.m_next&&(e.m_next.m_prev=e.m_prev),e.m_prev&&(e.m_prev.m_next=e.m_next),e==this.m_controllerList&&(this.m_controllerList=e.m_next),--this.m_controllerCount},ft.prototype.SetWarmStarting=function(e){ft.m_warmStarting=e},ft.prototype.SetContinuousPhysics=function(e){ft.m_continuousPhysics=e},ft.prototype.GetBodyCount=function(){return this.m_bodyCount},ft.prototype.GetJointCount=function(){return this.m_jointCount},ft.prototype.GetContactCount=function(){return this.m_contactCount},ft.prototype.SetGravity=function(e){this.m_gravity=e},ft.prototype.GetGravity=function(){return this.m_gravity},ft.prototype.GetGroundBody=function(){return this.m_groundBody},ft.prototype.Step=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.m_flags&ft.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~ft.e_newFixture),this.m_flags|=ft.e_locked;var r=ft.s_timestep2;r.dt=e,r.velocityIterations=t,r.positionIterations=n,e>0?r.inv_dt=1/e:r.inv_dt=0,r.dtRatio=this.m_inv_dt0*e,r.warmStarting=ft.m_warmStarting,this.m_contactManager.Collide(),r.dt>0&&this.Solve(r),ft.m_continuousPhysics&&r.dt>0&&this.SolveTOI(r),r.dt>0&&(this.m_inv_dt0=r.inv_dt),this.m_flags&=~ft.e_locked},ft.prototype.ClearForces=function(){for(var e=this.m_bodyList;e;e=e.m_next)e.m_force.SetZero(),e.m_torque=0},ft.prototype.DrawDebugData=function(){if(this.m_debugDraw==null)return;this.m_debugDraw.m_sprite.graphics.clear();var e=this.m_debugDraw.GetFlags(),t=0,n,r,i,s,o,u=new f,a=new f,l=new f,h,p=new d,v=new d,m=[new f,new f,new f,new f],g=new c(0,0,0);if(e&nt.e_shapeBit)for(n=this.m_bodyList;n;n=n.m_next){h=n.m_xf;for(r=n.GetFixtureList();r;r=r.m_next)i=r.GetShape(),n.IsActive()==0?(g.Set(.5,.5,.3),this.DrawShape(i,h,g)):n.GetType()==Q.b2_staticBody?(g.Set(.5,.9,.5),this.DrawShape(i,h,g)):n.GetType()==Q.b2_kinematicBody?(g.Set(.5,.5,.9),this.DrawShape(i,h,g)):n.IsAwake()==0?(g.Set(.6,.6,.6),this.DrawShape(i,h,g)):(g.Set(.9,.7,.7),this.DrawShape(i,h,g))}if(e&nt.e_jointBit)for(s=this.m_jointList;s;s=s.m_next)this.DrawJoint(s);if(e&nt.e_controllerBit)for(var y=this.m_controllerList;y;y=y.m_next)y.Draw(this.m_debugDraw);if(e&nt.e_pairBit){g.Set(.3,.9,.9);for(var b=this.m_contactManager.m_contactList;b;b=b.GetNext()){var w=b.GetFixtureA(),E=b.GetFixtureB(),S=w.GetAABB().GetCenter(),x=E.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(S,x,g)}}if(e&nt.e_aabbBit){o=this.m_contactManager.m_broadPhase,m=[new f,new f,new f,new f];for(n=this.m_bodyList;n;n=n.GetNext()){if(n.IsActive()==0)continue;for(r=n.GetFixtureList();r;r=r.GetNext()){var T=o.GetFatAABB(r.m_proxy);m[0].Set(T.lowerBound.x,T.lowerBound.y),m[1].Set(T.upperBound.x,T.lowerBound.y),m[2].Set(T.upperBound.x,T.upperBound.y),m[3].Set(T.lowerBound.x,T.upperBound.y),this.m_debugDraw.DrawPolygon(m,4,g)}}}if(e&nt.e_centerOfMassBit)for(n=this.m_bodyList;n;n=n.m_next)h=ft.s_xf,h.R=n.m_xf.R,h.position=n.GetWorldCenter(),this.m_debugDraw.DrawTransform(h)},ft.prototype.QueryAABB=function(e,t){function i(t){return e(r.GetUserData(t))}var n=this,r=n.m_contactManager.m_broadPhase;r.Query(i,t)},ft.prototype.QueryShape=function(e,t,n){function s(r){var s=i.GetUserData(r)instanceof st?i.GetUserData(r):null;return K.TestOverlap(t,n,s.GetShape(),s.GetBody().GetTransform())?e(s):!0}var r=this;n===undefined&&(n=null),n==null&&(n=new a,n.SetIdentity());var i=r.m_contactManager.m_broadPhase,o=new d;t.ComputeAABB(o,n),i.Query(s,o)},ft.prototype.QueryPoint=function(e,t){function i(n){var i=r.GetUserData(n)instanceof st?r.GetUserData(n):null;return i.TestPoint(t)?e(i):!0}var n=this,r=n.m_contactManager.m_broadPhase,s=new d;s.lowerBound.Set(t.x-p.b2_linearSlop,t.y-p.b2_linearSlop),s.upperBound.Set(t.x+p.b2_linearSlop,t.y+p.b2_linearSlop),r.Query(i,s)},ft.prototype.RayCast=function(e,t,n){function o(r,o){var u=i.GetUserData(o),a=u instanceof st?u:null,l=a.RayCast(s,r);if(l){var c=s.fraction,h=new f((1-c)*t.x+c*n.x,(1-c)*t.y+c*n.y);return e(a,h,s.normal,c)}return r.maxFraction}var r=this,i=r.m_contactManager.m_broadPhase,s=new _,u=new M(t,n);i.RayCast(o,u)},ft.prototype.RayCastOne=function(e,t){function i(e,t,n,i){return i===undefined&&(i=0),r=e,i}var n=this,r;return n.RayCast(i,e,t),r},ft.prototype.RayCastAll=function(e,n){function s(e,t,n,r){return r===undefined&&(r=0),i[i.length]=e,1}var r=this,i=new t;return r.RayCast(s,e,n),i},ft.prototype.GetBodyList=function(){return this.m_bodyList},ft.prototype.GetJointList=function(){return this.m_jointList},ft.prototype.GetContactList=function(){return this.m_contactList},ft.prototype.IsLocked=function(){return(this.m_flags&ft.e_locked)>0},ft.prototype.Solve=function(e){var t;for(var n=this.m_controllerList;n;n=n.m_next)n.Step(e);var r=this.m_island;r.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~Q.e_islandFlag;for(var i=this.m_contactList;i;i=i.m_next)i.m_flags&=~ct.e_islandFlag;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;var o=parseInt(this.m_bodyCount),u=this.s_stack;for(var a=this.m_bodyList;a;a=a.m_next){if(a.m_flags&Q.e_islandFlag)continue;if(a.IsAwake()==0||a.IsActive()==0)continue;if(a.GetType()==Q.b2_staticBody)continue;r.Clear();var f=0;u[f++]=a,a.m_flags|=Q.e_islandFlag;while(f>0){t=u[--f],r.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()==Q.b2_staticBody)continue;var l;for(var c=t.m_contactList;c;c=c.next){if(c.contact.m_flags&ct.e_islandFlag)continue;if(c.contact.IsSensor()==1||c.contact.IsEnabled()==0||c.contact.IsTouching()==0)continue;r.AddContact(c.contact),c.contact.m_flags|=ct.e_islandFlag,l=c.other;if(l.m_flags&Q.e_islandFlag)continue;u[f++]=l,l.m_flags|=Q.e_islandFlag}for(var h=t.m_jointList;h;h=h.next){if(h.joint.m_islandFlag==1)continue;l=h.other;if(l.IsActive()==0)continue;r.AddJoint(h.joint),h.joint.m_islandFlag=!0;if(l.m_flags&Q.e_islandFlag)continue;u[f++]=l,l.m_flags|=Q.e_islandFlag}}r.Solve(e,this.m_gravity,this.m_allowSleep);for(var p=0;p<r.m_bodyCount;++p)t=r.m_bodies[p],t.GetType()==Q.b2_staticBody&&(t.m_flags&=~Q.e_islandFlag)}for(p=0;p<u.length;++p){if(!u[p])break;u[p]=null}for(t=this.m_bodyList;t;t=t.m_next){if(t.IsAwake()==0||t.IsActive()==0)continue;if(t.GetType()==Q.b2_staticBody)continue;t.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()},ft.prototype.SolveTOI=function(e){var t,n,r,i,s,o,u,a=this.m_island;a.Initialize(this.m_bodyCount,p.b2_maxTOIContactsPerIsland,p.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var f=ft.s_queue;for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~Q.e_islandFlag,t.m_sweep.t0=0;var l;for(l=this.m_contactList;l;l=l.m_next)l.m_flags&=~(ct.e_toiFlag|ct.e_islandFlag);for(u=this.m_jointList;u;u=u.m_next)u.m_islandFlag=!1;for(;;){var c=null,h=1;for(l=this.m_contactList;l;l=l.m_next){if(l.IsSensor()==1||l.IsEnabled()==0||l.IsContinuous()==0)continue;var d=1;if(l.m_flags&ct.e_toiFlag)d=l.m_toi;else{n=l.m_fixtureA,r=l.m_fixtureB,i=n.m_body,s=r.m_body;if(!(i.GetType()==Q.b2_dynamicBody&&i.IsAwake()!=0||s.GetType()==Q.b2_dynamicBody&&s.IsAwake()!=0))continue;var v=i.m_sweep.t0;i.m_sweep.t0<s.m_sweep.t0?(v=s.m_sweep.t0,i.m_sweep.Advance(v)):s.m_sweep.t0<i.m_sweep.t0&&(v=i.m_sweep.t0,s.m_sweep.Advance(v)),d=l.ComputeTOI(i.m_sweep,s.m_sweep),p.b2Assert(0<=d&&d<=1),d>0&&d<1&&(d=(1-d)*v+d,d>1&&(d=1)),l.m_toi=d,l.m_flags|=ct.e_toiFlag}Number.MIN_VALUE<d&&d<h&&(c=l,h=d)}if(c==null||1-100*Number.MIN_VALUE<h)break;n=c.m_fixtureA,r=c.m_fixtureB,i=n.m_body,s=r.m_body,ft.s_backupA.Set(i.m_sweep),ft.s_backupB.Set(s.m_sweep),i.Advance(h),s.Advance(h),c.Update(this.m_contactManager.m_contactListener),c.m_flags&=~ct.e_toiFlag;if(c.IsSensor()==1||c.IsEnabled()==0){i.m_sweep.Set(ft.s_backupA),s.m_sweep.Set(ft.s_backupB),i.SynchronizeTransform(),s.SynchronizeTransform();continue}if(c.IsTouching()==0)continue;var m=i;m.GetType()!=Q.b2_dynamicBody&&(m=s),a.Clear();var g=0,y=0;f[g+y++]=m,m.m_flags|=Q.e_islandFlag;while(y>0){t=f[g++],--y,a.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()!=Q.b2_dynamicBody)continue;for(o=t.m_contactList;o;o=o.next){if(a.m_contactCount==a.m_contactCapacity)break;if(o.contact.m_flags&ct.e_islandFlag)continue;if(o.contact.IsSensor()==1||o.contact.IsEnabled()==0||o.contact.IsTouching()==0)continue;a.AddContact(o.contact),o.contact.m_flags|=ct.e_islandFlag;var b=o.other;if(b.m_flags&Q.e_islandFlag)continue;b.GetType()!=Q.b2_staticBody&&(b.Advance(h),b.SetAwake(!0)),f[g+y]=b,++y,b.m_flags|=Q.e_islandFlag}for(var w=t.m_jointList;w;w=w.next){if(a.m_jointCount==a.m_jointCapacity)continue;if(w.joint.m_islandFlag==1)continue;b=w.other;if(b.IsActive()==0)continue;a.AddJoint(w.joint),w.joint.m_islandFlag=!0;if(b.m_flags&Q.e_islandFlag)continue;b.GetType()!=Q.b2_staticBody&&(b.Advance(h),b.SetAwake(!0)),f[g+y]=b,++y,b.m_flags|=Q.e_islandFlag}}var E=ft.s_timestep;E.warmStarting=!1,E.dt=(1-h)*e.dt,E.inv_dt=1/E.dt,E.dtRatio=0,E.velocityIterations=e.velocityIterations,E.positionIterations=e.positionIterations,a.SolveTOI(E);var S=0;for(S=0;S<a.m_bodyCount;++S){t=a.m_bodies[S],t.m_flags&=~Q.e_islandFlag;if(t.IsAwake()==0)continue;if(t.GetType()!=Q.b2_dynamicBody)continue;t.SynchronizeFixtures();for(o=t.m_contactList;o;o=o.next)o.contact.m_flags&=~ct.e_toiFlag}for(S=0;S<a.m_contactCount;++S)l=a.m_contacts[S],l.m_flags&=~(ct.e_toiFlag|ct.e_islandFlag);for(S=0;S<a.m_jointCount;++S)u=a.m_joints[S],u.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}},ft.prototype.DrawJoint=function(e){var t=e.GetBodyA(),n=e.GetBodyB(),r=t.m_xf,i=n.m_xf,s=r.position,o=i.position,u=e.GetAnchorA(),a=e.GetAnchorB(),f=ft.s_jointColor;switch(e.m_type){case Dt.e_distanceJoint:this.m_debugDraw.DrawSegment(u,a,f);break;case Dt.e_pulleyJoint:var l=e instanceof Ut?e:null,c=l.GetGroundAnchorA(),h=l.GetGroundAnchorB();this.m_debugDraw.DrawSegment(c,u,f),this.m_debugDraw.DrawSegment(h,a,f),this.m_debugDraw.DrawSegment(c,h,f);break;case Dt.e_mouseJoint:this.m_debugDraw.DrawSegment(u,a,f);break;default:t!=this.m_groundBody&&this.m_debugDraw.DrawSegment(s,u,f),this.m_debugDraw.DrawSegment(u,a,f),n!=this.m_groundBody&&this.m_debugDraw.DrawSegment(o,a,f)}},ft.prototype.DrawShape=function(e,n,r){switch(e.m_type){case K.e_circleShape:var i=e instanceof W?e:null,s=o.MulX(n,i.m_p),u=i.m_radius,a=n.R.col1;this.m_debugDraw.DrawSolidCircle(s,u,a,r);break;case K.e_polygonShape:var f=0,l=e instanceof J?e:null,c=parseInt(l.GetVertexCount()),h=l.GetVertices(),p=new t(c);for(f=0;f<c;++f)p[f]=o.MulX(n,h[f]);this.m_debugDraw.DrawSolidPolygon(p,c,r);break;case K.e_edgeShape:var d=e instanceof V?e:null;this.m_debugDraw.DrawSegment(o.MulX(n,d.GetVertex1()),o.MulX(n,d.GetVertex2()),r)}},e.postDefs.push(function(){e.Dynamics.b2World.s_timestep2=new at,e.Dynamics.b2World.s_xf=new a,e.Dynamics.b2World.s_backupA=new u,e.Dynamics.b2World.s_backupB=new u,e.Dynamics.b2World.s_timestep=new at,e.Dynamics.b2World.s_queue=new t,e.Dynamics.b2World.s_jointColor=new c(.5,.8,.8),e.Dynamics.b2World.e_newFixture=1,e.Dynamics.b2World.e_locked=2})}(),function(){var r=e.Collision.Shapes.b2CircleShape,i=e.Collision.Shapes.b2EdgeChainDef,s=e.Collision.Shapes.b2EdgeShape,o=e.Collision.Shapes.b2MassData,u=e.Collision.Shapes.b2PolygonShape,a=e.Collision.Shapes.b2Shape,f=e.Dynamics.Contacts.b2CircleContact,l=e.Dynamics.Contacts.b2Contact,c=e.Dynamics.Contacts.b2ContactConstraint,h=e.Dynamics.Contacts.b2ContactConstraintPoint,p=e.Dynamics.Contacts.b2ContactEdge,d=e.Dynamics.Contacts.b2ContactFactory,v=e.Dynamics.Contacts.b2ContactRegister,m=e.Dynamics.Contacts.b2ContactResult,g=e.Dynamics.Contacts.b2ContactSolver,y=e.Dynamics.Contacts.b2EdgeAndCircleContact,b=e.Dynamics.Contacts.b2NullContact,w=e.Dynamics.Contacts.b2PolyAndCircleContact,E=e.Dynamics.Contacts.b2PolyAndEdgeContact,S=e.Dynamics.Contacts.b2PolygonContact,x=e.Dynamics.Contacts.b2PositionSolverManifold,T=e.Dynamics.b2Body,N=e.Dynamics.b2BodyDef,C=e.Dynamics.b2ContactFilter,k=e.Dynamics.b2ContactImpulse,L=e.Dynamics.b2ContactListener,A=e.Dynamics.b2ContactManager,O=e.Dynamics.b2DebugDraw,M=e.Dynamics.b2DestructionListener,_=e.Dynamics.b2FilterData,D=e.Dynamics.b2Fixture,P=e.Dynamics.b2FixtureDef,H=e.Dynamics.b2Island,B=e.Dynamics.b2TimeStep,j=e.Dynamics.b2World,F=e.Common.b2Color,I=e.Common.b2internal,q=e.Common.b2Settings,R=e.Common.Math.b2Mat22,U=e.Common.Math.b2Mat33,z=e.Common.Math.b2Math,W=e.Common.Math.b2Sweep,X=e.Common.Math.b2Transform,V=e.Common.Math.b2Vec2,$=e.Common.Math.b2Vec3,J=e.Collision.b2AABB,K=e.Collision.b2Bound,Q=e.Collision.b2BoundValues,G=e.Collision.b2Collision,Y=e.Collision.b2ContactID,Z=e.Collision.b2ContactPoint,et=e.Collision.b2Distance,tt=e.Collision.b2DistanceInput,nt=e.Collision.b2DistanceOutput,rt=e.Collision.b2DistanceProxy,it=e.Collision.b2DynamicTree,st=e.Collision.b2DynamicTreeBroadPhase,ot=e.Collision.b2DynamicTreeNode,ut=e.Collision.b2DynamicTreePair,at=e.Collision.b2Manifold,ft=e.Collision.b2ManifoldPoint,lt=e.Collision.b2Point,ct=e.Collision.b2RayCastInput,ht=e.Collision.b2RayCastOutput,pt=e.Collision.b2Segment,dt=e.Collision.b2SeparationFunction,vt=e.Collision.b2Simplex,mt=e.Collision.b2SimplexCache,gt=e.Collision.b2SimplexVertex,yt=e.Collision.b2TimeOfImpact,bt=e.Collision.b2TOIInput,wt=e.Collision.b2WorldManifold,Et=e.Collision.ClipVertex,St=e.Collision.Features,xt=e.Collision.IBroadPhase;e.inherit(f,e.Dynamics.Contacts.b2Contact),f.prototype.__super=e.Dynamics.Contacts.b2Contact.prototype,f.b2CircleContact=function(){e.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},f.Create=function(e){return new f},f.Destroy=function(e,t){},f.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},f.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();G.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof r?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof r?this.m_fixtureB.GetShape():null,t.m_xf)},l.b2Contact=function(){this.m_nodeA=new p,this.m_nodeB=new p,this.m_manifold=new at,this.m_oldManifold=new at},l.prototype.GetManifold=function(){return this.m_manifold},l.prototype.GetWorldManifold=function(e){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),i=this.m_fixtureB.GetShape();e.Initialize(this.m_manifold,t.GetTransform(),r.m_radius,n.GetTransform(),i.m_radius)},l.prototype.IsTouching=function(){return(this.m_flags&l.e_touchingFlag)==l.e_touchingFlag},l.prototype.IsContinuous=function(){return(this.m_flags&l.e_continuousFlag)==l.e_continuousFlag},l.prototype.SetSensor=function(e){e?this.m_flags|=l.e_sensorFlag:this.m_flags&=~l.e_sensorFlag},l.prototype.IsSensor=function(){return(this.m_flags&l.e_sensorFlag)==l.e_sensorFlag},l.prototype.SetEnabled=function(e){e?this.m_flags|=l.e_enabledFlag:this.m_flags&=~l.e_enabledFlag},l.prototype.IsEnabled=function(){return(this.m_flags&l.e_enabledFlag)==l.e_enabledFlag},l.prototype.GetNext=function(){return this.m_next},l.prototype.GetFixtureA=function(){return this.m_fixtureA},l.prototype.GetFixtureB=function(){return this.m_fixtureB},l.prototype.FlagForFiltering=function(){this.m_flags|=l.e_filterFlag},l.prototype.b2Contact=function(){},l.prototype.Reset=function(e,t){e===undefined&&(e=null),t===undefined&&(t=null),this.m_flags=l.e_enabledFlag;if(!e||!t){this.m_fixtureA=null,this.m_fixtureB=null;return}if(e.IsSensor()||t.IsSensor())this.m_flags|=l.e_sensorFlag;var n=e.GetBody(),r=t.GetBody();if(n.GetType()!=T.b2_dynamicBody||n.IsBullet()||r.GetType()!=T.b2_dynamicBody||r.IsBullet())this.m_flags|=l.e_continuousFlag;this.m_fixtureA=e,this.m_fixtureB=t,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},l.prototype.Update=function(e){var t=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=t,this.m_flags|=l.e_enabledFlag;var n=!1,r=(this.m_flags&l.e_touchingFlag)==l.e_touchingFlag,i=this.m_fixtureA.m_body,s=this.m_fixtureB.m_body,o=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&l.e_sensorFlag){if(o){var u=this.m_fixtureA.GetShape(),f=this.m_fixtureB.GetShape(),c=i.GetTransform(),h=s.GetTransform();n=a.TestOverlap(u,c,f,h)}this.m_manifold.m_pointCount=0}else{i.GetType()!=T.b2_dynamicBody||i.IsBullet()||s.GetType()!=T.b2_dynamicBody||s.IsBullet()?this.m_flags|=l.e_continuousFlag:this.m_flags&=~l.e_continuousFlag;if(o){this.Evaluate(),n=this.m_manifold.m_pointCount>0;for(var p=0;p<this.m_manifold.m_pointCount;++p){var d=this.m_manifold.m_points[p];d.m_normalImpulse=0,d.m_tangentImpulse=0;var v=d.m_id;for(var m=0;m<this.m_oldManifold.m_pointCount;++m){var g=this.m_oldManifold.m_points[m];if(g.m_id.key==v.key){d.m_normalImpulse=g.m_normalImpulse,d.m_tangentImpulse=g.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;n!=r&&(i.SetAwake(!0),s.SetAwake(!0))}n?this.m_flags|=l.e_touchingFlag:this.m_flags&=~l.e_touchingFlag,r==0&&n==1&&e.BeginContact(this),r==1&&n==0&&e.EndContact(this),(this.m_flags&l.e_sensorFlag)==0&&e.PreSolve(this,this.m_oldManifold)},l.prototype.Evaluate=function(){},l.prototype.ComputeTOI=function(e,t){return l.s_input.proxyA.Set(this.m_fixtureA.GetShape()),l.s_input.proxyB.Set(this.m_fixtureB.GetShape()),l.s_input.sweepA=e,l.s_input.sweepB=t,l.s_input.tolerance=q.b2_linearSlop,yt.TimeOfImpact(l.s_input)},e.postDefs.push(function(){e.Dynamics.Contacts.b2Contact.e_sensorFlag=1,e.Dynamics.Contacts.b2Contact.e_continuousFlag=2,e.Dynamics.Contacts.b2Contact.e_islandFlag=4,e.Dynamics.Contacts.b2Contact.e_toiFlag=8,e.Dynamics.Contacts.b2Contact.e_touchingFlag=16,e.Dynamics.Contacts.b2Contact.e_enabledFlag=32,e.Dynamics.Contacts.b2Contact.e_filterFlag=64,e.Dynamics.Contacts.b2Contact.s_input=new bt}),c.b2ContactConstraint=function(){this.localPlaneNormal=new V,this.localPoint=new V,this.normal=new V,this.normalMass=new R,this.K=new R},c.prototype.b2ContactConstraint=function(){this.points=new t(q.b2_maxManifoldPoints);for(var e=0;e<q.b2_maxManifoldPoints;e++)this.points[e]=new h},h.b2ContactConstraintPoint=function(){this.localPoint=new V,this.rA=new V,this.rB=new V},p.b2ContactEdge=function(){},d.b2ContactFactory=function(){},d.prototype.b2ContactFactory=function(e){this.m_allocator=e,this.InitializeRegisters()},d.prototype.AddType=function(e,t,n,r){n===undefined&&(n=0),r===undefined&&(r=0),this.m_registers[n][r].createFcn=e,this.m_registers[n][r].destroyFcn=t,this.m_registers[n][r].primary=!0,n!=r&&(this.m_registers[r][n].createFcn=e,this.m_registers[r][n].destroyFcn=t,this.m_registers[r][n].primary=!1)},d.prototype.InitializeRegisters=function(){this.m_registers=new t(a.e_shapeTypeCount);for(var e=0;e<a.e_shapeTypeCount;e++){this.m_registers[e]=new t(a.e_shapeTypeCount);for(var n=0;n<a.e_shapeTypeCount;n++)this.m_registers[e][n]=new v}this.AddType(f.Create,f.Destroy,a.e_circleShape,a.e_circleShape),this.AddType(w.Create,w.Destroy,a.e_polygonShape,a.e_circleShape),this.AddType(S.Create,S.Destroy,a.e_polygonShape,a.e_polygonShape),this.AddType(y.Create,y.Destroy,a.e_edgeShape,a.e_circleShape),this.AddType(E.Create,E.Destroy,a.e_polygonShape,a.e_edgeShape)},d.prototype.Create=function(e,t){var n=parseInt(e.GetType()),r=parseInt(t.GetType()),i=this.m_registers[n][r],s;if(i.pool)return s=i.pool,i.pool=s.m_next,i.poolCount--,s.Reset(e,t),s;var o=i.createFcn;return o!=null?i.primary?(s=o(this.m_allocator),s.Reset(e,t),s):(s=o(this.m_allocator),s.Reset(t,e),s):null},d.prototype.Destroy=function(e){e.m_manifold.m_pointCount>0&&(e.m_fixtureA.m_body.SetAwake(!0),e.m_fixtureB.m_body.SetAwake(!0));var t=parseInt(e.m_fixtureA.GetType()),n=parseInt(e.m_fixtureB.GetType()),r=this.m_registers[t][n];r.poolCount++,e.m_next=r.pool,r.pool=e;var i=r.destroyFcn;i(e,this.m_allocator)},v.b2ContactRegister=function(){},m.b2ContactResult=function(){this.position=new V,this.normal=new V,this.id=new Y},g.b2ContactSolver=function(){this.m_step=new B,this.m_constraints=new t},g.prototype.b2ContactSolver=function(){},g.prototype.Initialize=function(e,t,n,r){n===undefined&&(n=0);var i;this.m_step.Set(e),this.m_allocator=r;var s=0,o,u;this.m_constraintCount=n;while(this.m_constraints.length<this.m_constraintCount)this.m_constraints[this.m_constraints.length]=new c;for(s=0;s<n;++s){i=t[s];var a=i.m_fixtureA,f=i.m_fixtureB,l=a.m_shape,h=f.m_shape,p=l.m_radius,d=h.m_radius,v=a.m_body,m=f.m_body,y=i.GetManifold(),b=q.b2MixFriction(a.GetFriction(),f.GetFriction()),w=q.b2MixRestitution(a.GetRestitution(),f.GetRestitution()),E=v.m_linearVelocity.x,S=v.m_linearVelocity.y,x=m.m_linearVelocity.x,T=m.m_linearVelocity.y,N=v.m_angularVelocity,C=m.m_angularVelocity;q.b2Assert(y.m_pointCount>0),g.s_worldManifold.Initialize(y,v.m_xf,p,m.m_xf,d);var k=g.s_worldManifold.m_normal.x,L=g.s_worldManifold.m_normal.y,A=this.m_constraints[s];A.bodyA=v,A.bodyB=m,A.manifold=y,A.normal.x=k,A.normal.y=L,A.pointCount=y.m_pointCount,A.friction=b,A.restitution=w,A.localPlaneNormal.x=y.m_localPlaneNormal.x,A.localPlaneNormal.y=y.m_localPlaneNormal.y,A.localPoint.x=y.m_localPoint.x,A.localPoint.y=y.m_localPoint.y,A.radius=p+d,A.type=y.m_type;for(var O=0;O<A.pointCount;++O){var M=y.m_points[O],_=A.points[O];_.normalImpulse=M.m_normalImpulse,_.tangentImpulse=M.m_tangentImpulse,_.localPoint.SetV(M.m_localPoint);var D=_.rA.x=g.s_worldManifold.m_points[O].x-v.m_sweep.c.x,P=_.rA.y=g.s_worldManifold.m_points[O].y-v.m_sweep.c.y,H=_.rB.x=g.s_worldManifold.m_points[O].x-m.m_sweep.c.x,B=_.rB.y=g.s_worldManifold.m_points[O].y-m.m_sweep.c.y,j=D*L-P*k,F=H*L-B*k;j*=j,F*=F;var I=v.m_invMass+m.m_invMass+v.m_invI*j+m.m_invI*F;_.normalMass=1/I;var R=v.m_mass*v.m_invMass+m.m_mass*m.m_invMass;R+=v.m_mass*v.m_invI*j+m.m_mass*m.m_invI*F,_.equalizedMass=1/R;var U=L,z=-k,W=D*z-P*U,X=H*z-B*U;W*=W,X*=X;var V=v.m_invMass+m.m_invMass+v.m_invI*W+m.m_invI*X;_.tangentMass=1/V,_.velocityBias=0;var $=x+ -C*B-E- -N*P,J=T+C*H-S-N*D,K=A.normal.x*$+A.normal.y*J;K<-q.b2_velocityThreshold&&(_.velocityBias+=-A.restitution*K)}if(A.pointCount==2){var Q=A.points[0],G=A.points[1],Y=v.m_invMass,Z=v.m_invI,et=m.m_invMass,tt=m.m_invI,nt=Q.rA.x*L-Q.rA.y*k,rt=Q.rB.x*L-Q.rB.y*k,it=G.rA.x*L-G.rA.y*k,st=G.rB.x*L-G.rB.y*k,ot=Y+et+Z*nt*nt+tt*rt*rt,ut=Y+et+Z*it*it+tt*st*st,at=Y+et+Z*nt*it+tt*rt*st,ft=100;ot*ot<ft*(ot*ut-at*at)?(A.K.col1.Set(ot,at),A.K.col2.Set(at,ut),A.K.GetInverse(A.normalMass)):A.pointCount=1}}},g.prototype.InitVelocityConstraints=function(e){var t,n,r;for(var i=0;i<this.m_constraintCount;++i){var s=this.m_constraints[i],o=s.bodyA,u=s.bodyB,a=o.m_invMass,f=o.m_invI,l=u.m_invMass,c=u.m_invI,h=s.normal.x,p=s.normal.y,d=p,v=-h,m=0,g=0,y=0;if(e.warmStarting){y=s.pointCount;for(g=0;g<y;++g){var b=s.points[g];b.normalImpulse*=e.dtRatio,b.tangentImpulse*=e.dtRatio;var w=b.normalImpulse*h+b.tangentImpulse*d,E=b.normalImpulse*p+b.tangentImpulse*v;o.m_angularVelocity-=f*(b.rA.x*E-b.rA.y*w),o.m_linearVelocity.x-=a*w,o.m_linearVelocity.y-=a*E,u.m_angularVelocity+=c*(b.rB.x*E-b.rB.y*w),u.m_linearVelocity.x+=l*w,u.m_linearVelocity.y+=l*E}}else{y=s.pointCount;for(g=0;g<y;++g){var S=s.points[g];S.normalImpulse=0,S.tangentImpulse=0}}}},g.prototype.SolveVelocityConstraints=function(){var e=0,t,n=0,r=0,i=0,s=0,o=0,u=0,a=0,f=0,l=0,c=0,h=0,p=0,d=0,v=0,m=0,g=0,y=0,b=0,w=0,E,S;for(var x=0;x<this.m_constraintCount;++x){var T=this.m_constraints[x],N=T.bodyA,C=T.bodyB,k=N.m_angularVelocity,L=C.m_angularVelocity,A=N.m_linearVelocity,O=C.m_linearVelocity,M=N.m_invMass,_=N.m_invI,D=C.m_invMass,P=C.m_invI,H=T.normal.x,B=T.normal.y,j=B,F=-H,I=T.friction,q=0;for(e=0;e<T.pointCount;e++)t=T.points[e],o=O.x-L*t.rB.y-A.x+k*t.rA.y,u=O.y+L*t.rB.x-A.y-k*t.rA.x,f=o*j+u*F,l=t.tangentMass*-f,c=I*t.normalImpulse,h=z.Clamp(t.tangentImpulse+l,-c,c),l=h-t.tangentImpulse,p=l*j,d=l*F,A.x-=M*p,A.y-=M*d,k-=_*(t.rA.x*d-t.rA.y*p),O.x+=D*p,O.y+=D*d,L+=P*(t.rB.x*d-t.rB.y*p),t.tangentImpulse=h;var R=parseInt(T.pointCount);if(T.pointCount==1)t=T.points[0],o=O.x+ -L*t.rB.y-A.x- -k*t.rA.y,u=O.y+L*t.rB.x-A.y-k*t.rA.x,a=o*H+u*B,l=-t.normalMass*(a-t.velocityBias),h=t.normalImpulse+l,h=h>0?h:0,l=h-t.normalImpulse,p=l*H,d=l*B,A.x-=M*p,A.y-=M*d,k-=_*(t.rA.x*d-t.rA.y*p),O.x+=D*p,O.y+=D*d,L+=P*(t.rB.x*d-t.rB.y*p),t.normalImpulse=h;else{var U=T.points[0],W=T.points[1],X=U.normalImpulse,V=W.normalImpulse,$=O.x-L*U.rB.y-A.x+k*U.rA.y,J=O.y+L*U.rB.x-A.y-k*U.rA.x,K=O.x-L*W.rB.y-A.x+k*W.rA.y,Q=O.y+L*W.rB.x-A.y-k*W.rA.x,G=$*H+J*B,Y=K*H+Q*B,Z=G-U.velocityBias,et=Y-W.velocityBias;E=T.K,Z-=E.col1.x*X+E.col2.x*V,et-=E.col1.y*X+E.col2.y*V;var tt=.001;for(;;){E=T.normalMass;var nt=-(E.col1.x*Z+E.col2.x*et),rt=-(E.col1.y*Z+E.col2.y*et);if(nt>=0&&rt>=0){v=nt-X,m=rt-V,g=v*H,y=v*B,b=m*H,w=m*B,A.x-=M*(g+b),A.y-=M*(y+w),k-=_*(U.rA.x*y-U.rA.y*g+W.rA.x*w-W.rA.y*b),O.x+=D*(g+b),O.y+=D*(y+w),L+=P*(U.rB.x*y-U.rB.y*g+W.rB.x*w-W.rB.y*b),U.normalImpulse=nt,W.normalImpulse=rt;break}nt=-U.normalMass*Z,rt=0,G=0,Y=T.K.col1.y*nt+et;if(nt>=0&&Y>=0){v=nt-X,m=rt-V,g=v*H,y=v*B,b=m*H,w=m*B,A.x-=M*(g+b),A.y-=M*(y+w),k-=_*(U.rA.x*y-U.rA.y*g+W.rA.x*w-W.rA.y*b),O.x+=D*(g+b),O.y+=D*(y+w),L+=P*(U.rB.x*y-U.rB.y*g+W.rB.x*w-W.rB.y*b),U.normalImpulse=nt,W.normalImpulse=rt;break}nt=0,rt=-W.normalMass*et,G=T.K.col2.x*rt+Z,Y=0;if(rt>=0&&G>=0){v=nt-X,m=rt-V,g=v*H,y=v*B,b=m*H,w=m*B,A.x-=M*(g+b),A.y-=M*(y+w),k-=_*(U.rA.x*y-U.rA.y*g+W.rA.x*w-W.rA.y*b),O.x+=D*(g+b),O.y+=D*(y+w),L+=P*(U.rB.x*y-U.rB.y*g+W.rB.x*w-W.rB.y*b),U.normalImpulse=nt,W.normalImpulse=rt;break}nt=0,rt=0,G=Z,Y=et;if(G>=0&&Y>=0){v=nt-X,m=rt-V,g=v*H,y=v*B,b=m*H,w=m*B,A.x-=M*(g+b),A.y-=M*(y+w),k-=_*(U.rA.x*y-U.rA.y*g+W.rA.x*w-W.rA.y*b),O.x+=D*(g+b),O.y+=D*(y+w),L+=P*(U.rB.x*y-U.rB.y*g+W.rB.x*w-W.rB.y*b),U.normalImpulse=nt,W.normalImpulse=rt;break}break}}N.m_angularVelocity=k,C.m_angularVelocity=L}},g.prototype.FinalizeVelocityConstraints=function(){for(var e=0;e<this.m_constraintCount;++e){var t=this.m_constraints[e],n=t.manifold;for(var r=0;r<t.pointCount;++r){var i=n.m_points[r],s=t.points[r];i.m_normalImpulse=s.normalImpulse,i.m_tangentImpulse=s.tangentImpulse}}},g.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t=0;for(var n=0;n<this.m_constraintCount;n++){var r=this.m_constraints[n],i=r.bodyA,s=r.bodyB,o=i.m_mass*i.m_invMass,u=i.m_mass*i.m_invI,a=s.m_mass*s.m_invMass,f=s.m_mass*s.m_invI;g.s_psm.Initialize(r);var l=g.s_psm.m_normal;for(var c=0;c<r.pointCount;c++){var h=r.points[c],p=g.s_psm.m_points[c],d=g.s_psm.m_separations[c],v=p.x-i.m_sweep.c.x,m=p.y-i.m_sweep.c.y,y=p.x-s.m_sweep.c.x,b=p.y-s.m_sweep.c.y;t=t<d?t:d;var w=z.Clamp(e*(d+q.b2_linearSlop),-q.b2_maxLinearCorrection,0),E=-h.equalizedMass*w,S=E*l.x,x=E*l.y;i.m_sweep.c.x-=o*S,i.m_sweep.c.y-=o*x,i.m_sweep.a-=u*(v*x-m*S),i.SynchronizeTransform(),s.m_sweep.c.x+=a*S,s.m_sweep.c.y+=a*x,s.m_sweep.a+=f*(y*x-b*S),s.SynchronizeTransform()}}return t>-1.5*q.b2_linearSlop},e.postDefs.push(function(){e.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new wt,e.Dynamics.Contacts.b2ContactSolver.s_psm=new x}),e.inherit(y,e.Dynamics.Contacts.b2Contact),y.prototype.__super=e.Dynamics.Contacts.b2Contact.prototype,y.b2EdgeAndCircleContact=function(){e.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},y.Create=function(e){return new y},y.Destroy=function(e,t){},y.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},y.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof s?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof r?this.m_fixtureB.GetShape():null,t.m_xf)},y.prototype.b2CollideEdgeAndCircle=function(e,t,n,r,i){},e.inherit(b,e.Dynamics.Contacts.b2Contact),b.prototype.__super=e.Dynamics.Contacts.b2Contact.prototype,b.b2NullContact=function(){e.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},b.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},b.prototype.Evaluate=function(){},e.inherit(w,e.Dynamics.Contacts.b2Contact),w.prototype.__super=e.Dynamics.Contacts.b2Contact.prototype,w.b2PolyAndCircleContact=function(){e.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},w.Create=function(e){return new w},w.Destroy=function(e,t){},w.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t),q.b2Assert(e.GetType()==a.e_polygonShape),q.b2Assert(t.GetType()==a.e_circleShape)},w.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body,t=this.m_fixtureB.m_body;G.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof u?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof r?this.m_fixtureB.GetShape():null,t.m_xf)},e.inherit(E,e.Dynamics.Contacts.b2Contact),E.prototype.__super=e.Dynamics.Contacts.b2Contact.prototype,E.b2PolyAndEdgeContact=function(){e.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},E.Create=function(e){return new E},E.Destroy=function(e,t){},E.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t),q.b2Assert(e.GetType()==a.e_polygonShape),q.b2Assert(t.GetType()==a.e_edgeShape)},E.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof u?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof s?this.m_fixtureB.GetShape():null,t.m_xf)},E.prototype.b2CollidePolyAndEdge=function(e,t,n,r,i){},e.inherit(S,e.Dynamics.Contacts.b2Contact),S.prototype.__super=e.Dynamics.Contacts.b2Contact.prototype,S.b2PolygonContact=function(){e.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},S.Create=function(e){return new S},S.Destroy=function(e,t){},S.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},S.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();G.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof u?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof u?this.m_fixtureB.GetShape():null,t.m_xf)},x.b2PositionSolverManifold=function(){},x.prototype.b2PositionSolverManifold=function(){this.m_normal=new V,this.m_separations=new n(q.b2_maxManifoldPoints),this.m_points=new t(q.b2_maxManifoldPoints);for(var e=0;e<q.b2_maxManifoldPoints;e++)this.m_points[e]=new V},x.prototype.Initialize=function(e){q.b2Assert(e.pointCount>0);var t=0,n=0,r=0,i,s,o=0,u=0;switch(e.type){case at.e_circles:i=e.bodyA.m_xf.R,s=e.localPoint;var a=e.bodyA.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y),f=e.bodyA.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y);i=e.bodyB.m_xf.R,s=e.points[0].localPoint;var l=e.bodyB.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y),c=e.bodyB.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y),h=l-a,p=c-f,d=h*h+p*p;if(d>Number.MIN_VALUE*Number.MIN_VALUE){var v=Math.sqrt(d);this.m_normal.x=h/v,this.m_normal.y=p/v}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(a+l),this.m_points[0].y=.5*(f+c),this.m_separations[0]=h*this.m_normal.x+p*this.m_normal.y-e.radius;break;case at.e_faceA:i=e.bodyA.m_xf.R,s=e.localPlaneNormal,this.m_normal.x=i.col1.x*s.x+i.col2.x*s.y,this.m_normal.y=i.col1.y*s.x+i.col2.y*s.y,i=e.bodyA.m_xf.R,s=e.localPoint,o=e.bodyA.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y),u=e.bodyA.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y),i=e.bodyB.m_xf.R;for(t=0;t<e.pointCount;++t)s=e.points[t].localPoint,n=e.bodyB.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y),r=e.bodyB.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y),this.m_separations[t]=(n-o)*this.m_normal.x+(r-u)*this.m_normal.y-e.radius,this.m_points[t].x=n,this.m_points[t].y=r;break;case at.e_faceB:i=e.bodyB.m_xf.R,s=e.localPlaneNormal,this.m_normal.x=i.col1.x*s.x+i.col2.x*s.y,this.m_normal.y=i.col1.y*s.x+i.col2.y*s.y,i=e.bodyB.m_xf.R,s=e.localPoint,o=e.bodyB.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y),u=e.bodyB.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y),i=e.bodyA.m_xf.R;for(t=0;t<e.pointCount;++t)s=e.points[t].localPoint,n=e.bodyA.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y),r=e.bodyA.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y),this.m_separations[t]=(n-o)*this.m_normal.x+(r-u)*this.m_normal.y-e.radius,this.m_points[t].Set(n,r);this.m_normal.x*=-1,this.m_normal.y*=-1}},e.postDefs.push(function(){e.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new V,e.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new V})}(),function(){var t=e.Dynamics.b2Body,n=e.Dynamics.b2BodyDef,r=e.Dynamics.b2ContactFilter,i=e.Dynamics.b2ContactImpulse,s=e.Dynamics.b2ContactListener,o=e.Dynamics.b2ContactManager,u=e.Dynamics.b2DebugDraw,a=e.Dynamics.b2DestructionListener,f=e.Dynamics.b2FilterData,l=e.Dynamics.b2Fixture,c=e.Dynamics.b2FixtureDef,h=e.Dynamics.b2Island,p=e.Dynamics.b2TimeStep,d=e.Dynamics.b2World,v=e.Common.Math.b2Mat22,m=e.Common.Math.b2Mat33,g=e.Common.Math.b2Math,y=e.Common.Math.b2Sweep,b=e.Common.Math.b2Transform,w=e.Common.Math.b2Vec2,E=e.Common.Math.b2Vec3,S=e.Common.b2Color,x=e.Common.b2internal,T=e.Common.b2Settings,N=e.Collision.Shapes.b2CircleShape,C=e.Collision.Shapes.b2EdgeChainDef,k=e.Collision.Shapes.b2EdgeShape,L=e.Collision.Shapes.b2MassData,A=e.Collision.Shapes.b2PolygonShape,O=e.Collision.Shapes.b2Shape,M=e.Dynamics.Controllers.b2BuoyancyController,_=e.Dynamics.Controllers.b2ConstantAccelController,D=e.Dynamics.Controllers.b2ConstantForceController,P=e.Dynamics.Controllers.b2Controller,H=e.Dynamics.Controllers.b2ControllerEdge,B=e.Dynamics.Controllers.b2GravityController,j=e.Dynamics.Controllers.b2TensorDampingController;e.inherit(M,e.Dynamics.Controllers.b2Controller),M.prototype.__super=e.Dynamics.Controllers.b2Controller.prototype,M.b2BuoyancyController=function(){e.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new w(0,-1),this.offset=0,this.density=0,this.velocity=new w(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},M.prototype.Step=function(e){if(!this.m_bodyList)return;this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var t=this.m_bodyList;t;t=t.nextBody){var n=t.body;if(n.IsAwake()==0)continue;var r=new w,i=new w,s=0,o=0;for(var u=n.GetFixtureList();u;u=u.GetNext()){var a=new w,f=u.GetShape().ComputeSubmergedArea(this.normal,this.offset,n.GetTransform(),a);s+=f,r.x+=f*a.x,r.y+=f*a.y;var l=0;this.useDensity?l=1:l=1,o+=f*l,i.x+=f*a.x*l,i.y+=f*a.y*l}r.x/=s,r.y/=s,i.x/=o,i.y/=o;if(s<Number.MIN_VALUE)continue;var c=this.gravity.GetNegative();c.Multiply(this.density*s),n.ApplyForce(c,i);var h=n.GetLinearVelocityFromWorldPoint(r);h.Subtract(this.velocity),h.Multiply(-this.linearDrag*s),n.ApplyForce(h,r),n.ApplyTorque(-n.GetInertia()/n.GetMass()*s*n.GetAngularVelocity()*this.angularDrag)}},M.prototype.Draw=function(e){var t=1e3,n=new w,r=new w;n.x=this.normal.x*this.offset+this.normal.y*t,n.y=this.normal.y*this.offset-this.normal.x*t,r.x=this.normal.x*this.offset-this.normal.y*t,r.y=this.normal.y*this.offset+this.normal.x*t;var i=new S(0,0,1);e.DrawSegment(n,r,i)},e.inherit(_,e.Dynamics.Controllers.b2Controller),_.prototype.__super=e.Dynamics.Controllers.b2Controller.prototype,_.b2ConstantAccelController=function(){e.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new w(0,0)},_.prototype.Step=function(e){var t=new w(this.A.x*e.dt,this.A.y*e.dt);for(var n=this.m_bodyList;n;n=n.nextBody){var r=n.body;if(!r.IsAwake())continue;r.SetLinearVelocity(new w(r.GetLinearVelocity().x+t.x,r.GetLinearVelocity().y+t.y))}},e.inherit(D,e.Dynamics.Controllers.b2Controller),D.prototype.__super=e.Dynamics.Controllers.b2Controller.prototype,D.b2ConstantForceController=function(){e.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new w(0,0)},D.prototype.Step=function(e){for(var t=this.m_bodyList;t;t=t.nextBody){var n=t.body;if(!n.IsAwake())continue;n.ApplyForce(this.F,n.GetWorldCenter())}},P.b2Controller=function(){},P.prototype.Step=function(e){},P.prototype.Draw=function(e){},P.prototype.AddBody=function(e){var t=new H;t.controller=this,t.body=e,t.nextBody=this.m_bodyList,t.prevBody=null,this.m_bodyList=t,t.nextBody&&(t.nextBody.prevBody=t),this.m_bodyCount++,t.nextController=e.m_controllerList,t.prevController=null,e.m_controllerList=t,t.nextController&&(t.nextController.prevController=t),e.m_controllerCount++},P.prototype.RemoveBody=function(e){var t=e.m_controllerList;while(t&&t.controller!=this)t=t.nextController;t.prevBody&&(t.prevBody.nextBody=t.nextBody),t.nextBody&&(t.nextBody.prevBody=t.prevBody),t.nextController&&(t.nextController.prevController=t.prevController),t.prevController&&(t.prevController.nextController=t.nextController),this.m_bodyList==t&&(this.m_bodyList=t.nextBody),e.m_controllerList==t&&(e.m_controllerList=t.nextController),e.m_controllerCount--,this.m_bodyCount--},P.prototype.Clear=function(){while(this.m_bodyList)this.RemoveBody(this.m_bodyList.body)},P.prototype.GetNext=function(){return this.m_next},P.prototype.GetWorld=function(){return this.m_world},P.prototype.GetBodyList=function(){return this.m_bodyList},H.b2ControllerEdge=function(){},e.inherit(B,e.Dynamics.Controllers.b2Controller),B.prototype.__super=e.Dynamics.Controllers.b2Controller.prototype,B.b2GravityController=function(){e.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},B.prototype.Step=function(e){var t=null,n=null,r=null,i=0,s=null,o=null,u=null,a=0,f=0,l=0,c=null;if(this.invSqr)for(t=this.m_bodyList;t;t=t.nextBody){n=t.body,r=n.GetWorldCenter(),i=n.GetMass();for(s=this.m_bodyList;s!=t;s=s.nextBody){o=s.body,u=o.GetWorldCenter(),a=u.x-r.x,f=u.y-r.y,l=a*a+f*f;if(l<Number.MIN_VALUE)continue;c=new w(a,f),c.Multiply(this.G/l/Math.sqrt(l)*i*o.GetMass()),n.IsAwake()&&n.ApplyForce(c,r),c.Multiply(-1),o.IsAwake()&&o.ApplyForce(c,u)}}else for(t=this.m_bodyList;t;t=t.nextBody){n=t.body,r=n.GetWorldCenter(),i=n.GetMass();for(s=this.m_bodyList;s!=t;s=s.nextBody){o=s.body,u=o.GetWorldCenter(),a=u.x-r.x,f=u.y-r.y,l=a*a+f*f;if(l<Number.MIN_VALUE)continue;c=new w(a,f),c.Multiply(this.G/l*i*o.GetMass()),n.IsAwake()&&n.ApplyForce(c,r),c.Multiply(-1),o.IsAwake()&&o.ApplyForce(c,u)}}},e.inherit(j,e.Dynamics.Controllers.b2Controller),j.prototype.__super=e.Dynamics.Controllers.b2Controller.prototype,j.b2TensorDampingController=function(){e.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new v,this.maxTimestep=0},j.prototype.SetAxisAligned=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.T.col1.x=-e,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-t,e>0||t>0?this.maxTimestep=1/Math.max(e,t):this.maxTimestep=0},j.prototype.Step=function(e){var t=e.dt;if(t<=Number.MIN_VALUE)return;t>this.maxTimestep&&this.maxTimestep>0&&(t=this.maxTimestep);for(var n=this.m_bodyList;n;n=n.nextBody){var r=n.body;if(!r.IsAwake())continue;var i=r.GetWorldVector(g.MulMV(this.T,r.GetLocalVector(r.GetLinearVelocity())));r.SetLinearVelocity(new w(r.GetLinearVelocity().x+i.x*t,r.GetLinearVelocity().y+i.y*t))}}}(),function(){var t=e.Common.b2Color,n=e.Common.b2internal,r=e.Common.b2Settings,i=e.Common.Math.b2Mat22,s=e.Common.Math.b2Mat33,o=e.Common.Math.b2Math,u=e.Common.Math.b2Sweep,a=e.Common.Math.b2Transform,f=e.Common.Math.b2Vec2,l=e.Common.Math.b2Vec3,c=e.Dynamics.Joints.b2DistanceJoint,h=e.Dynamics.Joints.b2DistanceJointDef,p=e.Dynamics.Joints.b2FrictionJoint,d=e.Dynamics.Joints.b2FrictionJointDef,v=e.Dynamics.Joints.b2GearJoint,m=e.Dynamics.Joints.b2GearJointDef,g=e.Dynamics.Joints.b2Jacobian,y=e.Dynamics.Joints.b2Joint,b=e.Dynamics.Joints.b2JointDef,w=e.Dynamics.Joints.b2JointEdge,E=e.Dynamics.Joints.b2LineJoint,S=e.Dynamics.Joints.b2LineJointDef,x=e.Dynamics.Joints.b2MouseJoint,T=e.Dynamics.Joints.b2MouseJointDef,N=e.Dynamics.Joints.b2PrismaticJoint,C=e.Dynamics.Joints.b2PrismaticJointDef,k=e.Dynamics.Joints.b2PulleyJoint,L=e.Dynamics.Joints.b2PulleyJointDef,A=e.Dynamics.Joints.b2RevoluteJoint,O=e.Dynamics.Joints.b2RevoluteJointDef,M=e.Dynamics.Joints.b2WeldJoint,_=e.Dynamics.Joints.b2WeldJointDef,D=e.Dynamics.b2Body,P=e.Dynamics.b2BodyDef,H=e.Dynamics.b2ContactFilter,B=e.Dynamics.b2ContactImpulse,j=e.Dynamics.b2ContactListener,F=e.Dynamics.b2ContactManager,I=e.Dynamics.b2DebugDraw,q=e.Dynamics.b2DestructionListener,R=e.Dynamics.b2FilterData,U=e.Dynamics.b2Fixture,z=e.Dynamics.b2FixtureDef,W=e.Dynamics.b2Island,X=e.Dynamics.b2TimeStep,V=e.Dynamics.b2World;e.inherit(c,e.Dynamics.Joints.b2Joint),c.prototype.__super=e.Dynamics.Joints.b2Joint.prototype,c.b2DistanceJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new f,this.m_localAnchor2=new f,this.m_u=new f},c.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},c.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},c.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new f(e*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)},c.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),0},c.prototype.GetLength=function(){return this.m_length},c.prototype.SetLength=function(e){e===undefined&&(e=0),this.m_length=e},c.prototype.GetFrequency=function(){return this.m_frequencyHz},c.prototype.SetFrequency=function(e){e===undefined&&(e=0),this.m_frequencyHz=e},c.prototype.GetDampingRatio=function(){return this.m_dampingRatio},c.prototype.SetDampingRatio=function(e){e===undefined&&(e=0),this.m_dampingRatio=e},c.prototype.b2DistanceJoint=function(e){this.__super.b2Joint.call(this,e);var t,n=0,r=0;this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_length=e.length,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},c.prototype.InitVelocityConstraints=function(e){var t,n=0,i=this.m_bodyA,s=this.m_bodyB;t=i.m_xf.R;var o=this.m_localAnchor1.x-i.m_sweep.localCenter.x,u=this.m_localAnchor1.y-i.m_sweep.localCenter.y;n=t.col1.x*o+t.col2.x*u,u=t.col1.y*o+t.col2.y*u,o=n,t=s.m_xf.R;var a=this.m_localAnchor2.x-s.m_sweep.localCenter.x,f=this.m_localAnchor2.y-s.m_sweep.localCenter.y;n=t.col1.x*a+t.col2.x*f,f=t.col1.y*a+t.col2.y*f,a=n,this.m_u.x=s.m_sweep.c.x+a-i.m_sweep.c.x-o,this.m_u.y=s.m_sweep.c.y+f-i.m_sweep.c.y-u;var l=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);l>r.b2_linearSlop?this.m_u.Multiply(1/l):this.m_u.SetZero();var c=o*this.m_u.y-u*this.m_u.x,h=a*this.m_u.y-f*this.m_u.x,p=i.m_invMass+i.m_invI*c*c+s.m_invMass+s.m_invI*h*h;this.m_mass=p!=0?1/p:0;if(this.m_frequencyHz>0){var d=l-this.m_length,v=2*Math.PI*this.m_frequencyHz,m=2*this.m_mass*this.m_dampingRatio*v,g=this.m_mass*v*v;this.m_gamma=e.dt*(m+e.dt*g),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=d*e.dt*g*this.m_gamma,this.m_mass=p+this.m_gamma,this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(e.warmStarting){this.m_impulse*=e.dtRatio;var y=this.m_impulse*this.m_u.x,b=this.m_impulse*this.m_u.y;i.m_linearVelocity.x-=i.m_invMass*y,i.m_linearVelocity.y-=i.m_invMass*b,i.m_angularVelocity-=i.m_invI*(o*b-u*y),s.m_linearVelocity.x+=s.m_invMass*y,s.m_linearVelocity.y+=s.m_invMass*b,s.m_angularVelocity+=s.m_invI*(a*b-f*y)}else this.m_impulse=0},c.prototype.SolveVelocityConstraints=function(e){var t,n=this.m_bodyA,r=this.m_bodyB;t=n.m_xf.R;var i=this.m_localAnchor1.x-n.m_sweep.localCenter.x,s=this.m_localAnchor1.y-n.m_sweep.localCenter.y,o=t.col1.x*i+t.col2.x*s;s=t.col1.y*i+t.col2.y*s,i=o,t=r.m_xf.R;var u=this.m_localAnchor2.x-r.m_sweep.localCenter.x,a=this.m_localAnchor2.y-r.m_sweep.localCenter.y;o=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=o;var f=n.m_linearVelocity.x+ -n.m_angularVelocity*s,l=n.m_linearVelocity.y+n.m_angularVelocity*i,c=r.m_linearVelocity.x+ -r.m_angularVelocity*a,h=r.m_linearVelocity.y+r.m_angularVelocity*u,p=this.m_u.x*(c-f)+this.m_u.y*(h-l),d=-this.m_mass*(p+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=d;var v=d*this.m_u.x,m=d*this.m_u.y;n.m_linearVelocity.x-=n.m_invMass*v,n.m_linearVelocity.y-=n.m_invMass*m,n.m_angularVelocity-=n.m_invI*(i*m-s*v),r.m_linearVelocity.x+=r.m_invMass*v,r.m_linearVelocity.y+=r.m_invMass*m,r.m_angularVelocity+=r.m_invI*(u*m-a*v)},c.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t;if(this.m_frequencyHz>0)return!0;var n=this.m_bodyA,i=this.m_bodyB;t=n.m_xf.R;var s=this.m_localAnchor1.x-n.m_sweep.localCenter.x,u=this.m_localAnchor1.y-n.m_sweep.localCenter.y,a=t.col1.x*s+t.col2.x*u;u=t.col1.y*s+t.col2.y*u,s=a,t=i.m_xf.R;var f=this.m_localAnchor2.x-i.m_sweep.localCenter.x,l=this.m_localAnchor2.y-i.m_sweep.localCenter.y;a=t.col1.x*f+t.col2.x*l,l=t.col1.y*f+t.col2.y*l,f=a;var c=i.m_sweep.c.x+f-n.m_sweep.c.x-s,h=i.m_sweep.c.y+l-n.m_sweep.c.y-u,p=Math.sqrt(c*c+h*h);c/=p,h/=p;var d=p-this.m_length;d=o.Clamp(d,-r.b2_maxLinearCorrection,r.b2_maxLinearCorrection);var v=-this.m_mass*d;this.m_u.Set(c,h);var m=v*this.m_u.x,g=v*this.m_u.y;return n.m_sweep.c.x-=n.m_invMass*m,n.m_sweep.c.y-=n.m_invMass*g,n.m_sweep.a-=n.m_invI*(s*g-u*m),i.m_sweep.c.x+=i.m_invMass*m,i.m_sweep.c.y+=i.m_invMass*g,i.m_sweep.a+=i.m_invI*(f*g-l*m),n.SynchronizeTransform(),i.SynchronizeTransform(),o.Abs(d)<r.b2_linearSlop},e.inherit(h,e.Dynamics.Joints.b2JointDef),h.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype,h.b2DistanceJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new f,this.localAnchorB=new f},h.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},h.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(r));var i=r.x-n.x,s=r.y-n.y;this.length=Math.sqrt(i*i+s*s),this.frequencyHz=0,this.dampingRatio=0},e.inherit(p,e.Dynamics.Joints.b2Joint),p.prototype.__super=e.Dynamics.Joints.b2Joint.prototype,p.b2FrictionJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new f,this.m_localAnchorB=new f,this.m_linearMass=new i,this.m_linearImpulse=new f},p.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},p.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},p.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new f(e*this.m_linearImpulse.x,e*this.m_linearImpulse.y)},p.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_angularImpulse},p.prototype.SetMaxForce=function(e){e===undefined&&(e=0),this.m_maxForce=e},p.prototype.GetMaxForce=function(){return this.m_maxForce},p.prototype.SetMaxTorque=function(e){e===undefined&&(e=0),this.m_maxTorque=e},p.prototype.GetMaxTorque=function(){return this.m_maxTorque},p.prototype.b2FrictionJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=e.maxForce,this.m_maxTorque=e.maxTorque},p.prototype.InitVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,s=this.m_bodyB;t=r.m_xf.R;var o=this.m_localAnchorA.x-r.m_sweep.localCenter.x,u=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*o+t.col2.x*u,u=t.col1.y*o+t.col2.y*u,o=n,t=s.m_xf.R;var a=this.m_localAnchorB.x-s.m_sweep.localCenter.x,f=this.m_localAnchorB.y-s.m_sweep.localCenter.y;n=t.col1.x*a+t.col2.x*f,f=t.col1.y*a+t.col2.y*f,a=n;var l=r.m_invMass,c=s.m_invMass,h=r.m_invI,p=s.m_invI,d=new i;d.col1.x=l+c,d.col2.x=0,d.col1.y=0,d.col2.y=l+c,d.col1.x+=h*u*u,d.col2.x+=-h*o*u,d.col1.y+=-h*o*u,d.col2.y+=h*o*o,d.col1.x+=p*f*f,d.col2.x+=-p*a*f,d.col1.y+=-p*a*f,d.col2.y+=p*a*a,d.GetInverse(this.m_linearMass),this.m_angularMass=h+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass);if(e.warmStarting){this.m_linearImpulse.x*=e.dtRatio,this.m_linearImpulse.y*=e.dtRatio,this.m_angularImpulse*=e.dtRatio;var v=this.m_linearImpulse;r.m_linearVelocity.x-=l*v.x,r.m_linearVelocity.y-=l*v.y,r.m_angularVelocity-=h*(o*v.y-u*v.x+this.m_angularImpulse),s.m_linearVelocity.x+=c*v.x,s.m_linearVelocity.y+=c*v.y,s.m_angularVelocity+=p*(a*v.y-f*v.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},p.prototype.SolveVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,i=this.m_bodyB,s=r.m_linearVelocity,u=r.m_angularVelocity,a=i.m_linearVelocity,l=i.m_angularVelocity,c=r.m_invMass,h=i.m_invMass,p=r.m_invI,d=i.m_invI;t=r.m_xf.R;var v=this.m_localAnchorA.x-r.m_sweep.localCenter.x,m=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*v+t.col2.x*m,m=t.col1.y*v+t.col2.y*m,v=n,t=i.m_xf.R;var g=this.m_localAnchorB.x-i.m_sweep.localCenter.x,y=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*g+t.col2.x*y,y=t.col1.y*g+t.col2.y*y,g=n;var b=0,w=l-u,E=-this.m_angularMass*w,S=this.m_angularImpulse;b=e.dt*this.m_maxTorque,this.m_angularImpulse=o.Clamp(this.m_angularImpulse+E,-b,b),E=this.m_angularImpulse-S,u-=p*E,l+=d*E;var x=a.x-l*y-s.x+u*m,T=a.y+l*g-s.y-u*v,N=o.MulMV(this.m_linearMass,new f(-x,-T)),C=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(N),b=e.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(b)),N=o.SubtractVV(this.m_linearImpulse,C),s.x-=c*N.x,s.y-=c*N.y,u-=p*(v*N.y-m*N.x),a.x+=h*N.x,a.y+=h*N.y,l+=d*(g*N.y-y*N.x),r.m_angularVelocity=u,i.m_angularVelocity=l},p.prototype.SolvePositionConstraints=function(e){return e===undefined&&(e=0),!0},e.inherit(d,e.Dynamics.Joints.b2JointDef),d.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype,d.b2FrictionJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new f,this.localAnchorB=new f},d.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_frictionJoint,this.maxForce=0,this.maxTorque=0},d.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n))},e.inherit(v,e.Dynamics.Joints.b2Joint),v.prototype.__super=e.Dynamics.Joints.b2Joint.prototype,v.b2GearJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new f,this.m_groundAnchor2=new f,this.m_localAnchor1=new f,this.m_localAnchor2=new f,this.m_J=new g},v.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},v.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},v.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new f(e*this.m_impulse*this.m_J.linearB.x,e*this.m_impulse*this.m_J.linearB.y)},v.prototype.GetReactionTorque=function(e){e===undefined&&(e=0);var t=this.m_bodyB.m_xf.R,n=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,r=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,i=t.col1.x*n+t.col2.x*r;r=t.col1.y*n+t.col2.y*r,n=i;var s=this.m_impulse*this.m_J.linearB.x,o=this.m_impulse*this.m_J.linearB.y;return e*(this.m_impulse*this.m_J.angularB-n*o+r*s)},v.prototype.GetRatio=function(){return this.m_ratio},v.prototype.SetRatio=function(e){e===undefined&&(e=0),this.m_ratio=e},v.prototype.b2GearJoint=function(e){this.__super.b2Joint.call(this,e);var t=parseInt(e.joint1.m_type),n=parseInt(e.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var r=0,i=0;this.m_ground1=e.joint1.GetBodyA(),this.m_bodyA=e.joint1.GetBodyB(),t==y.e_revoluteJoint?(this.m_revolute1=e.joint1 instanceof A?e.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),r=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=e.joint1 instanceof N?e.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),r=this.m_prismatic1.GetJointTranslation()),this.m_ground2=e.joint2.GetBodyA(),this.m_bodyB=e.joint2.GetBodyB(),n==y.e_revoluteJoint?(this.m_revolute2=e.joint2 instanceof A?e.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),i=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=e.joint2 instanceof N?e.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),i=this.m_prismatic2.GetJointTranslation()),this.m_ratio=e.ratio,this.m_constant=r+this.m_ratio*i,this.m_impulse=0},v.prototype.InitVelocityConstraints=function(e){var t=this.m_ground1,n=this.m_ground2,r=this.m_bodyA,i=this.m_bodyB,s=0,o=0,u=0,a=0,f,l,c=0,h=0,p=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,p+=r.m_invI):(f=t.m_xf.R,l=this.m_prismatic1.m_localXAxis1,s=f.col1.x*l.x+f.col2.x*l.y,o=f.col1.y*l.x+f.col2.y*l.y,f=r.m_xf.R,u=this.m_localAnchor1.x-r.m_sweep.localCenter.x,a=this.m_localAnchor1.y-r.m_sweep.localCenter.y,h=f.col1.x*u+f.col2.x*a,a=f.col1.y*u+f.col2.y*a,u=h,c=u*o-a*s,this.m_J.linearA.Set(-s,-o),this.m_J.angularA=-c,p+=r.m_invMass+r.m_invI*c*c),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,p+=this.m_ratio*this.m_ratio*i.m_invI):(f=n.m_xf.R,l=this.m_prismatic2.m_localXAxis1,s=f.col1.x*l.x+f.col2.x*l.y,o=f.col1.y*l.x+f.col2.y*l.y,f=i.m_xf.R,u=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y,h=f.col1.x*u+f.col2.x*a,a=f.col1.y*u+f.col2.y*a,u=h,c=u*o-a*s,this.m_J.linearB.Set(-this.m_ratio*s,-this.m_ratio*o),this.m_J.angularB=-this.m_ratio*c,p+=this.m_ratio*this.m_ratio*(i.m_invMass+i.m_invI*c*c)),this.m_mass=p>0?1/p:0,e.warmStarting?(r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearA.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearA.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularA,i.m_linearVelocity.x+=i.m_invMass*this.m_impulse*this.m_J.linearB.x,i.m_linearVelocity.y+=i.m_invMass*this.m_impulse*this.m_J.linearB.y,i.m_angularVelocity+=i.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},v.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=this.m_J.Compute(t.m_linearVelocity,t.m_angularVelocity,n.m_linearVelocity,n.m_angularVelocity),i=-this.m_mass*r;this.m_impulse+=i,t.m_linearVelocity.x+=t.m_invMass*i*this.m_J.linearA.x,t.m_linearVelocity.y+=t.m_invMass*i*this.m_J.linearA.y,t.m_angularVelocity+=t.m_invI*i*this.m_J.angularA,n.m_linearVelocity.x+=n.m_invMass*i*this.m_J.linearB.x,n.m_linearVelocity.y+=n.m_invMass*i*this.m_J.linearB.y,n.m_angularVelocity+=n.m_invI*i*this.m_J.angularB},v.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t=0,n=this.m_bodyA,i=this.m_bodyB,s=0,o=0;this.m_revolute1?s=this.m_revolute1.GetJointAngle():s=this.m_prismatic1.GetJointTranslation(),this.m_revolute2?o=this.m_revolute2.GetJointAngle():o=this.m_prismatic2.GetJointTranslation();var u=this.m_constant-(s+this.m_ratio*o),a=-this.m_mass*u;return n.m_sweep.c.x+=n.m_invMass*a*this.m_J.linearA.x,n.m_sweep.c.y+=n.m_invMass*a*this.m_J.linearA.y,n.m_sweep.a+=n.m_invI*a*this.m_J.angularA,i.m_sweep.c.x+=i.m_invMass*a*this.m_J.linearB.x,i.m_sweep.c.y+=i.m_invMass*a*this.m_J.linearB.y,i.m_sweep.a+=i.m_invI*a*this.m_J.angularB,n.SynchronizeTransform(),i.SynchronizeTransform(),t<r.b2_linearSlop},e.inherit(m,e.Dynamics.Joints.b2JointDef),m.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype,m.b2GearJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},m.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},g.b2Jacobian=function(){this.linearA=new f,this.linearB=new f},g.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},g.prototype.Set=function(e,t,n,r){t===undefined&&(t=0),r===undefined&&(r=0),this.linearA.SetV(e),this.angularA=t,this.linearB.SetV(n),this.angularB=r},g.prototype.Compute=function(e,t,n,r){return t===undefined&&(t=0),r===undefined&&(r=0),this.linearA.x*e.x+this.linearA.y*e.y+this.angularA*t+(this.linearB.x*n.x+this.linearB.y*n.y)+this.angularB*r},y.b2Joint=function(){this.m_edgeA=new w,this.m_edgeB=new w,this.m_localCenterA=new f,this.m_localCenterB=new f},y.prototype.GetType=function(){return this.m_type},y.prototype.GetAnchorA=function(){return null},y.prototype.GetAnchorB=function(){return null},y.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),null},y.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),0},y.prototype.GetBodyA=function(){return this.m_bodyA},y.prototype.GetBodyB=function(){return this.m_bodyB},y.prototype.GetNext=function(){return this.m_next},y.prototype.GetUserData=function(){return this.m_userData},y.prototype.SetUserData=function(e){this.m_userData=e},y.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},y.Create=function(e,t){var n=null;switch(e.type){case y.e_distanceJoint:n=new c(e instanceof h?e:null);break;case y.e_mouseJoint:n=new x(e instanceof T?e:null);break;case y.e_prismaticJoint:n=new N(e instanceof C?e:null);break;case y.e_revoluteJoint:n=new A(e instanceof O?e:null);break;case y.e_pulleyJoint:n=new k(e instanceof L?e:null);break;case y.e_gearJoint:n=new v(e instanceof m?e:null);break;case y.e_lineJoint:n=new E(e instanceof S?e:null);break;case y.e_weldJoint:n=new M(e instanceof _?e:null);break;case y.e_frictionJoint:n=new p(e instanceof d?e:null);break;default:}return n},y.Destroy=function(e,t){},y.prototype.b2Joint=function(e){r.b2Assert(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_prev=null,this.m_next=null,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=e.collideConnected,this.m_islandFlag=!1,this.m_userData=e.userData},y.prototype.InitVelocityConstraints=function(e){},y.prototype.SolveVelocityConstraints=function(e){},y.prototype.FinalizeVelocityConstraints=function(){},y.prototype.SolvePositionConstraints=function(e){return e===undefined&&(e=0),!1},e.postDefs.push(function(){e.Dynamics.Joints.b2Joint.e_unknownJoint=0,e.Dynamics.Joints.b2Joint.e_revoluteJoint=1,e.Dynamics.Joints.b2Joint.e_prismaticJoint=2,e.Dynamics.Joints.b2Joint.e_distanceJoint=3,e.Dynamics.Joints.b2Joint.e_pulleyJoint=4,e.Dynamics.Joints.b2Joint.e_mouseJoint=5,e.Dynamics.Joints.b2Joint.e_gearJoint=6,e.Dynamics.Joints.b2Joint.e_lineJoint=7,e.Dynamics.Joints.b2Joint.e_weldJoint=8,e.Dynamics.Joints.b2Joint.e_frictionJoint=9,e.Dynamics.Joints.b2Joint.e_inactiveLimit=0,e.Dynamics.Joints.b2Joint.e_atLowerLimit=1,e.Dynamics.Joints.b2Joint.e_atUpperLimit=2,e.Dynamics.Joints.b2Joint.e_equalLimits=3}),b.b2JointDef=function(){},b.prototype.b2JointDef=function(){this.type=y.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},w.b2JointEdge=function(){},e.inherit(E,e.Dynamics.Joints.b2Joint),E.prototype.__super=e.Dynamics.Joints.b2Joint.prototype,E.b2LineJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new f,this.m_localAnchor2=new f,this.m_localXAxis1=new f,this.m_localYAxis1=new f,this.m_axis=new f,this.m_perp=new f,this.m_K=new i,this.m_impulse=new f},E.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},E.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},E.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new f(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},E.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.y},E.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n,r=e.GetWorldPoint(this.m_localAnchor1),i=t.GetWorldPoint(this.m_localAnchor2),s=i.x-r.x,o=i.y-r.y,u=e.GetWorldVector(this.m_localXAxis1),a=u.x*s+u.y*o;return a},E.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s;var a=e.m_sweep.c.x+r,f=e.m_sweep.c.y+i,l=t.m_sweep.c.x+o,c=t.m_sweep.c.y+u,h=l-a,p=c-f,d=e.GetWorldVector(this.m_localXAxis1),v=e.m_linearVelocity,m=t.m_linearVelocity,g=e.m_angularVelocity,y=t.m_angularVelocity,b=h*-g*d.y+p*g*d.x+(d.x*(m.x+ -y*u-v.x- -g*i)+d.y*(m.y+y*o-v.y-g*r));return b},E.prototype.IsLimitEnabled=function(){return this.m_enableLimit},E.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},E.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},E.prototype.GetUpperLimit=function(){return this.m_upperTranslation},E.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},E.prototype.IsMotorEnabled=function(){return this.m_enableMotor},E.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},E.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},E.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},E.prototype.SetMaxMotorForce=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},E.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},E.prototype.GetMotorForce=function(){return this.m_motorImpulse},E.prototype.b2LineJoint=function(e){this.__super.b2Joint.call(this,e);var t,n=0,r=0;this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=y.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},E.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,i,s=0;this.m_localCenterA.SetV(t.GetLocalCenter()),this.m_localCenterB.SetV(n.GetLocalCenter());var u=t.GetTransform(),a=n.GetTransform();i=t.m_xf.R;var f=this.m_localAnchor1.x-this.m_localCenterA.x,l=this.m_localAnchor1.y-this.m_localCenterA.y;s=i.col1.x*f+i.col2.x*l,l=i.col1.y*f+i.col2.y*l,f=s,i=n.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y;s=i.col1.x*c+i.col2.x*h,h=i.col1.y*c+i.col2.y*h,c=s;var p=n.m_sweep.c.x+c-t.m_sweep.c.x-f,d=n.m_sweep.c.y+h-t.m_sweep.c.y-l;this.m_invMassA=t.m_invMass,this.m_invMassB=n.m_invMass,this.m_invIA=t.m_invI,this.m_invIB=n.m_invI,this.m_axis.SetV(o.MulMV(u.R,this.m_localXAxis1)),this.m_a1=(p+f)*this.m_axis.y-(d+l)*this.m_axis.x,this.m_a2=c*this.m_axis.y-h*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(o.MulMV(u.R,this.m_localYAxis1)),this.m_s1=(p+f)*this.m_perp.y-(d+l)*this.m_perp.x,this.m_s2=c*this.m_perp.y-h*this.m_perp.x;var v=this.m_invMassA,m=this.m_invMassB,g=this.m_invIA,b=this.m_invIB;this.m_K.col1.x=v+m+g*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,this.m_K.col1.y=g*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=v+m+g*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2;if(this.m_enableLimit){var w=this.m_axis.x*p+this.m_axis.y*d;o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*r.b2_linearSlop?this.m_limitState=y.e_equalLimits:w<=this.m_lowerTranslation?this.m_limitState!=y.e_atLowerLimit&&(this.m_limitState=y.e_atLowerLimit,this.m_impulse.y=0):w>=this.m_upperTranslation?this.m_limitState!=y.e_atUpperLimit&&(this.m_limitState=y.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=y.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=y.e_inactiveLimit;this.m_enableMotor==0&&(this.m_motorImpulse=0);if(e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var E=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,S=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,x=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,T=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;t.m_linearVelocity.x-=this.m_invMassA*E,t.m_linearVelocity.y-=this.m_invMassA*S,t.m_angularVelocity-=this.m_invIA*x,n.m_linearVelocity.x+=this.m_invMassB*E,n.m_linearVelocity.y+=this.m_invMassB*S,n.m_angularVelocity+=this.m_invIB*T}else this.m_impulse.SetZero(),this.m_motorImpulse=0},E.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=t.m_linearVelocity,i=t.m_angularVelocity,s=n.m_linearVelocity,u=n.m_angularVelocity,a=0,l=0,c=0,h=0;if(this.m_enableMotor&&this.m_limitState!=y.e_equalLimits){var p=this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*u-this.m_a1*i,d=this.m_motorMass*(this.m_motorSpeed-p),v=this.m_motorImpulse,m=e.dt*this.m_maxMotorForce;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+d,-m,m),d=this.m_motorImpulse-v,a=d*this.m_axis.x,l=d*this.m_axis.y,c=d*this.m_a1,h=d*this.m_a2,r.x-=this.m_invMassA*a,r.y-=this.m_invMassA*l,i-=this.m_invIA*c,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*l,u+=this.m_invIB*h}var g=this.m_perp.x*(s.x-r.x)+this.m_perp.y*(s.y-r.y)+this.m_s2*u-this.m_s1*i;if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){var b=this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*u-this.m_a1*i,w=this.m_impulse.Copy(),E=this.m_K.Solve(new f,-g,-b);this.m_impulse.Add(E),this.m_limitState==y.e_atLowerLimit?this.m_impulse.y=o.Max(this.m_impulse.y,0):this.m_limitState==y.e_atUpperLimit&&(this.m_impulse.y=o.Min(this.m_impulse.y,0));var S=-g-(this.m_impulse.y-w.y)*this.m_K.col2.x,x=0;this.m_K.col1.x!=0?x=S/this.m_K.col1.x+w.x:x=w.x,this.m_impulse.x=x,E.x=this.m_impulse.x-w.x,E.y=this.m_impulse.y-w.y,a=E.x*this.m_perp.x+E.y*this.m_axis.x,l=E.x*this.m_perp.y+E.y*this.m_axis.y,c=E.x*this.m_s1+E.y*this.m_a1,h=E.x*this.m_s2+E.y*this.m_a2,r.x-=this.m_invMassA*a,r.y-=this.m_invMassA*l,i-=this.m_invIA*c,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*l,u+=this.m_invIB*h}else{var T=0;this.m_K.col1.x!=0?T=-g/this.m_K.col1.x:T=0,this.m_impulse.x+=T,a=T*this.m_perp.x,l=T*this.m_perp.y,c=T*this.m_s1,h=T*this.m_s2,r.x-=this.m_invMassA*a,r.y-=this.m_invMassA*l,i-=this.m_invIA*c,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*l,u+=this.m_invIB*h}t.m_linearVelocity.SetV(r),t.m_angularVelocity=i,n.m_linearVelocity.SetV(s),n.m_angularVelocity=u},E.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t=0,n=0,s=this.m_bodyA,u=this.m_bodyB,a=s.m_sweep.c,l=s.m_sweep.a,c=u.m_sweep.c,h=u.m_sweep.a,p,d=0,v=0,m=0,g=0,y=0,b=0,w=0,E=!1,S=0,x=i.FromAngle(l),T=i.FromAngle(h);p=x;var N=this.m_localAnchor1.x-this.m_localCenterA.x,C=this.m_localAnchor1.y-this.m_localCenterA.y;d=p.col1.x*N+p.col2.x*C,C=p.col1.y*N+p.col2.y*C,N=d,p=T;var k=this.m_localAnchor2.x-this.m_localCenterB.x,L=this.m_localAnchor2.y-this.m_localCenterB.y;d=p.col1.x*k+p.col2.x*L,L=p.col1.y*k+p.col2.y*L,k=d;var A=c.x+k-a.x-N,O=c.y+L-a.y-C;if(this.m_enableLimit){this.m_axis=o.MulMV(x,this.m_localXAxis1),this.m_a1=(A+N)*this.m_axis.y-(O+C)*this.m_axis.x,this.m_a2=k*this.m_axis.y-L*this.m_axis.x;var M=this.m_axis.x*A+this.m_axis.y*O;o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*r.b2_linearSlop?(S=o.Clamp(M,-r.b2_maxLinearCorrection,r.b2_maxLinearCorrection),b=o.Abs(M),E=!0):M<=this.m_lowerTranslation?(S=o.Clamp(M-this.m_lowerTranslation+r.b2_linearSlop,-r.b2_maxLinearCorrection,0),b=this.m_lowerTranslation-M,E=!0):M>=this.m_upperTranslation&&(S=o.Clamp(M-this.m_upperTranslation+r.b2_linearSlop,0,r.b2_maxLinearCorrection),b=M-this.m_upperTranslation,E=!0)}this.m_perp=o.MulMV(x,this.m_localYAxis1),this.m_s1=(A+N)*this.m_perp.y-(O+C)*this.m_perp.x,this.m_s2=k*this.m_perp.y-L*this.m_perp.x;var _=new f,D=this.m_perp.x*A+this.m_perp.y*O;b=o.Max(b,o.Abs(D)),w=0;if(E)v=this.m_invMassA,m=this.m_invMassB,g=this.m_invIA,y=this.m_invIB,this.m_K.col1.x=v+m+g*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,this.m_K.col1.y=g*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=v+m+g*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2,this.m_K.Solve(_,-D,-S);else{v=this.m_invMassA,m=this.m_invMassB,g=this.m_invIA,y=this.m_invIB;var P=v+m+g*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,H=0;P!=0?H=-D/P:H=0,_.x=H,_.y=0}var B=_.x*this.m_perp.x+_.y*this.m_axis.x,j=_.x*this.m_perp.y+_.y*this.m_axis.y,F=_.x*this.m_s1+_.y*this.m_a1,I=_.x*this.m_s2+_.y*this.m_a2;return a.x-=this.m_invMassA*B,a.y-=this.m_invMassA*j,l-=this.m_invIA*F,c.x+=this.m_invMassB*B,c.y+=this.m_invMassB*j,h+=this.m_invIB*I,s.m_sweep.a=l,u.m_sweep.a=h,s.SynchronizeTransform(),u.SynchronizeTransform(),b<=r.b2_linearSlop&&w<=r.b2_angularSlop},e.inherit(S,e.Dynamics.Joints.b2JointDef),S.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype,S.b2LineJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new f,this.localAnchorB=new f,this.localAxisA=new f},S.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},S.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r)},e.inherit(x,e.Dynamics.Joints.b2Joint),x.prototype.__super=e.Dynamics.Joints.b2Joint.prototype,x.b2MouseJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new i,this.K1=new i,this.K2=new i,this.m_localAnchor=new f,this.m_target=new f,this.m_impulse=new f,this.m_mass=new i,this.m_C=new f},x.prototype.GetAnchorA=function(){return this.m_target},x.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},x.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new f(e*this.m_impulse.x,e*this.m_impulse.y)},x.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),0},x.prototype.GetTarget=function(){return this.m_target},x.prototype.SetTarget=function(e){this.m_bodyB.IsAwake()==0&&this.m_bodyB.SetAwake(!0),this.m_target=e},x.prototype.GetMaxForce=function(){return this.m_maxForce},x.prototype.SetMaxForce=function(e){e===undefined&&(e=0),this.m_maxForce=e},x.prototype.GetFrequency=function(){return this.m_frequencyHz},x.prototype.SetFrequency=function(e){e===undefined&&(e=0),this.m_frequencyHz=e},x.prototype.GetDampingRatio=function(){return this.m_dampingRatio},x.prototype.SetDampingRatio=function(e){e===undefined&&(e=0),this.m_dampingRatio=e},x.prototype.b2MouseJoint=function(e){this.__super.b2Joint.call(this,e),this.m_target.SetV(e.target);var t=this.m_target.x-this.m_bodyB.m_xf.position.x,n=this.m_target.y-this.m_bodyB.m_xf.position.y,r=this.m_bodyB.m_xf.R;this.m_localAnchor.x=t*r.col1.x+n*r.col1.y,this.m_localAnchor.y=t*r.col2.x+n*r.col2.y,this.m_maxForce=e.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_beta=0,this.m_gamma=0},x.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyB,n=t.GetMass(),r=2*Math.PI*this.m_frequencyHz,i=2*n*this.m_dampingRatio*r,s=n*r*r;this.m_gamma=e.dt*(i+e.dt*s),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_beta=e.dt*s*this.m_gamma;var o;o=t.m_xf.R;var u=this.m_localAnchor.x-t.m_sweep.localCenter.x,a=this.m_localAnchor.y-t.m_sweep.localCenter.y,f=o.col1.x*u+o.col2.x*a;a=o.col1.y*u+o.col2.y*a,u=f;var l=t.m_invMass,c=t.m_invI;this.K1.col1.x=l,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=l,this.K2.col1.x=c*a*a,this.K2.col2.x=-c*u*a,this.K2.col1.y=-c*u*a,this.K2.col2.y=c*u*u,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=t.m_sweep.c.x+u-this.m_target.x,this.m_C.y=t.m_sweep.c.y+a-this.m_target.y,t.m_angularVelocity*=.98,this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,t.m_linearVelocity.x+=l*this.m_impulse.x,t.m_linearVelocity.y+=l*this.m_impulse.y,t.m_angularVelocity+=c*(u*this.m_impulse.y-a*this.m_impulse.x)},x.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyB,n,r=0,i=0;n=t.m_xf.R;var s=this.m_localAnchor.x-t.m_sweep.localCenter.x,o=this.m_localAnchor.y-t.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*o,o=n.col1.y*s+n.col2.y*o,s=r;var u=t.m_linearVelocity.x+ -t.m_angularVelocity*o,a=t.m_linearVelocity.y+t.m_angularVelocity*s;n=this.m_mass,r=u+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,i=a+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var f=-(n.col1.x*r+n.col2.x*i),l=-(n.col1.y*r+n.col2.y*i),c=this.m_impulse.x,h=this.m_impulse.y;this.m_impulse.x+=f,this.m_impulse.y+=l;var p=e.dt*this.m_maxForce;this.m_impulse.LengthSquared()>p*p&&this.m_impulse.Multiply(p/this.m_impulse.Length()),f=this.m_impulse.x-c,l=this.m_impulse.y-h,t.m_linearVelocity.x+=t.m_invMass*f,t.m_linearVelocity.y+=t.m_invMass*l,t.m_angularVelocity+=t.m_invI*(s*l-o*f)},x.prototype.SolvePositionConstraints=function(e){return e===undefined&&(e=0),!0},e.inherit(T,e.Dynamics.Joints.b2JointDef),T.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype,T.b2MouseJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new f},T.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},e.inherit(N,e.Dynamics.Joints.b2Joint),N.prototype.__super=e.Dynamics.Joints.b2Joint.prototype,N.b2PrismaticJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new f,this.m_localAnchor2=new f,this.m_localXAxis1=new f,this.m_localYAxis1=new f,this.m_axis=new f,this.m_perp=new f,this.m_K=new s,this.m_impulse=new l},N.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},N.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},N.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new f(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},N.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.y},N.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n,r=e.GetWorldPoint(this.m_localAnchor1),i=t.GetWorldPoint(this.m_localAnchor2),s=i.x-r.x,o=i.y-r.y,u=e.GetWorldVector(this.m_localXAxis1),a=u.x*s+u.y*o;return a},N.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s;var a=e.m_sweep.c.x+r,f=e.m_sweep.c.y+i,l=t.m_sweep.c.x+o,c=t.m_sweep.c.y+u,h=l-a,p=c-f,d=e.GetWorldVector(this.m_localXAxis1),v=e.m_linearVelocity,m=t.m_linearVelocity,g=e.m_angularVelocity,y=t.m_angularVelocity,b=h*-g*d.y+p*g*d.x+(d.x*(m.x+ -y*u-v.x- -g*i)+d.y*(m.y+y*o-v.y-g*r));return b},N.prototype.IsLimitEnabled=function(){return this.m_enableLimit},N.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},N.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},N.prototype.GetUpperLimit=function(){return this.m_upperTranslation},N.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},N.prototype.IsMotorEnabled=function(){return this.m_enableMotor},N.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},N.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},N.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},N.prototype.SetMaxMotorForce=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},N.prototype.GetMotorForce=function(){return this.m_motorImpulse},N.prototype.b2PrismaticJoint=function(e){this.__super.b2Joint.call(this,e);var t,n=0,r=0;this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=y.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},N.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,i,s=0;this.m_localCenterA.SetV(t.GetLocalCenter()),this.m_localCenterB.SetV(n.GetLocalCenter());var u=t.GetTransform(),a=n.GetTransform();i=t.m_xf.R;var f=this.m_localAnchor1.x-this.m_localCenterA.x,l=this.m_localAnchor1.y-this.m_localCenterA.y;s=i.col1.x*f+i.col2.x*l,l=i.col1.y*f+i.col2.y*l,f=s,i=n.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y;s=i.col1.x*c+i.col2.x*h,h=i.col1.y*c+i.col2.y*h,c=s;var p=n.m_sweep.c.x+c-t.m_sweep.c.x-f,d=n.m_sweep.c.y+h-t.m_sweep.c.y-l;this.m_invMassA=t.m_invMass,this.m_invMassB=n.m_invMass,this.m_invIA=t.m_invI,this.m_invIB=n.m_invI,this.m_axis.SetV(o.MulMV(u.R,this.m_localXAxis1)),this.m_a1=(p+f)*this.m_axis.y-(d+l)*this.m_axis.x,this.m_a2=c*this.m_axis.y-h*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(o.MulMV(u.R,this.m_localYAxis1)),this.m_s1=(p+f)*this.m_perp.y-(d+l)*this.m_perp.x,this.m_s2=c*this.m_perp.y-h*this.m_perp.x;var v=this.m_invMassA,m=this.m_invMassB,g=this.m_invIA,b=this.m_invIB;this.m_K.col1.x=v+m+g*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,this.m_K.col1.y=g*this.m_s1+b*this.m_s2,this.m_K.col1.z=g*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=g+b,this.m_K.col2.z=g*this.m_a1+b*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=v+m+g*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2;if(this.m_enableLimit){var w=this.m_axis.x*p+this.m_axis.y*d;o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*r.b2_linearSlop?this.m_limitState=y.e_equalLimits:w<=this.m_lowerTranslation?this.m_limitState!=y.e_atLowerLimit&&(this.m_limitState=y.e_atLowerLimit,this.m_impulse.z=0):w>=this.m_upperTranslation?this.m_limitState!=y.e_atUpperLimit&&(this.m_limitState=y.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=y.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=y.e_inactiveLimit;this.m_enableMotor==0&&(this.m_motorImpulse=0);if(e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var E=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,S=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,x=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,T=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;t.m_linearVelocity.x-=this.m_invMassA*E,t.m_linearVelocity.y-=this.m_invMassA*S,t.m_angularVelocity-=this.m_invIA*x,n.m_linearVelocity.x+=this.m_invMassB*E,n.m_linearVelocity.y+=this.m_invMassB*S,n.m_angularVelocity+=this.m_invIB*T}else this.m_impulse.SetZero(),this.m_motorImpulse=0},N.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=t.m_linearVelocity,i=t.m_angularVelocity,s=n.m_linearVelocity,u=n.m_angularVelocity,a=0,c=0,h=0,p=0;if(this.m_enableMotor&&this.m_limitState!=y.e_equalLimits){var d=this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*u-this.m_a1*i,v=this.m_motorMass*(this.m_motorSpeed-d),m=this.m_motorImpulse,g=e.dt*this.m_maxMotorForce;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+v,-g,g),v=this.m_motorImpulse-m,a=v*this.m_axis.x,c=v*this.m_axis.y,h=v*this.m_a1,p=v*this.m_a2,r.x-=this.m_invMassA*a,r.y-=this.m_invMassA*c,i-=this.m_invIA*h,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*c,u+=this.m_invIB*p}var b=this.m_perp.x*(s.x-r.x)+this.m_perp.y*(s.y-r.y)+this.m_s2*u-this.m_s1*i,w=u-i;if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){var E=this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*u-this.m_a1*i,S=this.m_impulse.Copy(),x=this.m_K.Solve33(new l,-b,-w,-E);this.m_impulse.Add(x),this.m_limitState==y.e_atLowerLimit?this.m_impulse.z=o.Max(this.m_impulse.z,0):this.m_limitState==y.e_atUpperLimit&&(this.m_impulse.z=o.Min(this.m_impulse.z,0));var T=-b-(this.m_impulse.z-S.z)*this.m_K.col3.x,N=-w-(this.m_impulse.z-S.z)*this.m_K.col3.y,C=this.m_K.Solve22(new f,T,N);C.x+=S.x,C.y+=S.y,this.m_impulse.x=C.x,this.m_impulse.y=C.y,x.x=this.m_impulse.x-S.x,x.y=this.m_impulse.y-S.y,x.z=this.m_impulse.z-S.z,a=x.x*this.m_perp.x+x.z*this.m_axis.x,c=x.x*this.m_perp.y+x.z*this.m_axis.y,h=x.x*this.m_s1+x.y+x.z*this.m_a1,p=x.x*this.m_s2+x.y+x.z*this.m_a2,r.x-=this.m_invMassA*a,r.y-=this.m_invMassA*c,i-=this.m_invIA*h,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*c,u+=this.m_invIB*p}else{var k=this.m_K.Solve22(new f,-b,-w);this.m_impulse.x+=k.x,this.m_impulse.y+=k.y,a=k.x*this.m_perp.x,c=k.x*this.m_perp.y,h=k.x*this.m_s1+k.y,p=k.x*this.m_s2+k.y,r.x-=this.m_invMassA*a,r.y-=this.m_invMassA*c,i-=this.m_invIA*h,s.x+=this.m_invMassB*a,s.y+=this.m_invMassB*c,u+=this.m_invIB*p}t.m_linearVelocity.SetV(r),t.m_angularVelocity=i,n.m_linearVelocity.SetV(s),n.m_angularVelocity=u},N.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t=0,n=0,s=this.m_bodyA,u=this.m_bodyB,a=s.m_sweep.c,c=s.m_sweep.a,h=u.m_sweep.c,p=u.m_sweep.a,d,v=0,m=0,g=0,y=0,b=0,w=0,E=0,S=!1,x=0,T=i.FromAngle(c),N=i.FromAngle(p);d=T;var C=this.m_localAnchor1.x-this.m_localCenterA.x,k=this.m_localAnchor1.y-this.m_localCenterA.y;v=d.col1.x*C+d.col2.x*k,k=d.col1.y*C+d.col2.y*k,C=v,d=N;var L=this.m_localAnchor2.x-this.m_localCenterB.x,A=this.m_localAnchor2.y-this.m_localCenterB.y;v=d.col1.x*L+d.col2.x*A,A=d.col1.y*L+d.col2.y*A,L=v;var O=h.x+L-a.x-C,M=h.y+A-a.y-k;if(this.m_enableLimit){this.m_axis=o.MulMV(T,this.m_localXAxis1),this.m_a1=(O+C)*this.m_axis.y-(M+k)*this.m_axis.x,this.m_a2=L*this.m_axis.y-A*this.m_axis.x;var _=this.m_axis.x*O+this.m_axis.y*M;o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*r.b2_linearSlop?(x=o.Clamp(_,-r.b2_maxLinearCorrection,r.b2_maxLinearCorrection),w=o.Abs(_),S=!0):_<=this.m_lowerTranslation?(x=o.Clamp(_-this.m_lowerTranslation+r.b2_linearSlop,-r.b2_maxLinearCorrection,0),w=this.m_lowerTranslation-_,S=!0):_>=this.m_upperTranslation&&(x=o.Clamp(_-this.m_upperTranslation+r.b2_linearSlop,0,r.b2_maxLinearCorrection),w=_-this.m_upperTranslation,S=!0)}this.m_perp=o.MulMV(T,this.m_localYAxis1),this.m_s1=(O+C)*this.m_perp.y-(M+k)*this.m_perp.x,this.m_s2=L*this.m_perp.y-A*this.m_perp.x;var D=new l,P=this.m_perp.x*O+this.m_perp.y*M,H=p-c-this.m_refAngle;w=o.Max(w,o.Abs(P)),E=o.Abs(H);if(S)m=this.m_invMassA,g=this.m_invMassB,y=this.m_invIA,b=this.m_invIB,this.m_K.col1.x=m+g+y*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,this.m_K.col1.y=y*this.m_s1+b*this.m_s2,this.m_K.col1.z=y*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=y+b,this.m_K.col2.z=y*this.m_a1+b*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=m+g+y*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2,this.m_K.Solve33(D,-P,-H,-x);else{m=this.m_invMassA,g=this.m_invMassB,y=this.m_invIA,b=this.m_invIB;var B=m+g+y*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,j=y*this.m_s1+b*this.m_s2,F=y+b;this.m_K.col1.Set(B,j,0),this.m_K.col2.Set(j,F,0);var I=this.m_K.Solve22(new f,-P,-H);D.x=I.x,D.y=I.y,D.z=0}var q=D.x*this.m_perp.x+D.z*this.m_axis.x,R=D.x*this.m_perp.y+D.z*this.m_axis.y,U=D.x*this.m_s1+D.y+D.z*this.m_a1,z=D.x*this.m_s2+D.y+D.z*this.m_a2;return a.x-=this.m_invMassA*q,a.y-=this.m_invMassA*R,c-=this.m_invIA*U,h.x+=this.m_invMassB*q,h.y+=this.m_invMassB*R,p+=this.m_invIB*z,s.m_sweep.a=c,u.m_sweep.a=p,s.SynchronizeTransform(),u.SynchronizeTransform(),w<=r.b2_linearSlop&&E<=r.b2_angularSlop},e.inherit(C,e.Dynamics.Joints.b2JointDef),C.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype,C.b2PrismaticJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new f,this.localAnchorB=new f,this.localAxisA=new f},C.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},C.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},e.inherit(k,e.Dynamics.Joints.b2Joint),k.prototype.__super=e.Dynamics.Joints.b2Joint.prototype,k.b2PulleyJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new f,this.m_groundAnchor2=new f,this.m_localAnchor1=new f,this.m_localAnchor2=new f,this.m_u1=new f,this.m_u2=new f},k.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},k.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},k.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new f(e*this.m_impulse*this.m_u2.x,e*this.m_impulse*this.m_u2.y)},k.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),0},k.prototype.GetGroundAnchorA=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor1),e},k.prototype.GetGroundAnchorB=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor2),e},k.prototype.GetLength1=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),t=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,n=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,r=e.x-t,i=e.y-n;return Math.sqrt(r*r+i*i)},k.prototype.GetLength2=function(){var e=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),t=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,n=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,r=e.x-t,i=e.y-n;return Math.sqrt(r*r+i*i)},k.prototype.GetRatio=function(){return this.m_ratio},k.prototype.b2PulleyJoint=function(e){this.__super.b2Joint.call(this,e);var t,n=0,r=0;this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=e.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=e.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=e.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=e.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_ratio=e.ratio,this.m_constant=e.lengthA+this.m_ratio*e.lengthB,this.m_maxLength1=o.Min(e.maxLengthA,this.m_constant-this.m_ratio*k.b2_minPulleyLength),this.m_maxLength2=o.Min(e.maxLengthB,(this.m_constant-k.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},k.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,i;i=t.m_xf.R;var s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,u=i.col1.x*s+i.col2.x*o;o=i.col1.y*s+i.col2.y*o,s=u,i=n.m_xf.R;var a=this.m_localAnchor2.x-n.m_sweep.localCenter.x,f=this.m_localAnchor2.y-n.m_sweep.localCenter.y;u=i.col1.x*a+i.col2.x*f,f=i.col1.y*a+i.col2.y*f,a=u;var l=t.m_sweep.c.x+s,c=t.m_sweep.c.y+o,h=n.m_sweep.c.x+a,p=n.m_sweep.c.y+f,d=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,v=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,m=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,g=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(l-d,c-v),this.m_u2.Set(h-m,p-g);var b=this.m_u1.Length(),w=this.m_u2.Length();b>r.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero(),w>r.b2_linearSlop?this.m_u2.Multiply(1/w):this.m_u2.SetZero();var E=this.m_constant-b-this.m_ratio*w;E>0?(this.m_state=y.e_inactiveLimit,this.m_impulse=0):this.m_state=y.e_atUpperLimit,b<this.m_maxLength1?(this.m_limitState1=y.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=y.e_atUpperLimit,w<this.m_maxLength2?(this.m_limitState2=y.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=y.e_atUpperLimit;var S=s*this.m_u1.y-o*this.m_u1.x,x=a*this.m_u2.y-f*this.m_u2.x;this.m_limitMass1=t.m_invMass+t.m_invI*S*S,this.m_limitMass2=n.m_invMass+n.m_invI*x*x,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass;if(e.warmStarting){this.m_impulse*=e.dtRatio,this.m_limitImpulse1*=e.dtRatio,this.m_limitImpulse2*=e.dtRatio;var T=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,N=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,C=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,k=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;t.m_linearVelocity.x+=t.m_invMass*T,t.m_linearVelocity.y+=t.m_invMass*N,t.m_angularVelocity+=t.m_invI*(s*N-o*T),n.m_linearVelocity.x+=n.m_invMass*C,n.m_linearVelocity.y+=n.m_invMass*k,n.m_angularVelocity+=n.m_invI*(a*k-f*C)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},k.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r;r=t.m_xf.R;var i=this.m_localAnchor1.x-t.m_sweep.localCenter.x,s=this.m_localAnchor1.y-t.m_sweep.localCenter.y,u=r.col1.x*i+r.col2.x*s;s=r.col1.y*i+r.col2.y*s,i=u,r=n.m_xf.R;var a=this.m_localAnchor2.x-n.m_sweep.localCenter.x,f=this.m_localAnchor2.y-n.m_sweep.localCenter.y;u=r.col1.x*a+r.col2.x*f,f=r.col1.y*a+r.col2.y*f,a=u;var l=0,c=0,h=0,p=0,d=0,v=0,m=0,g=0,b=0,w=0,E=0;this.m_state==y.e_atUpperLimit&&(l=t.m_linearVelocity.x+ -t.m_angularVelocity*s,c=t.m_linearVelocity.y+t.m_angularVelocity*i,h=n.m_linearVelocity.x+ -n.m_angularVelocity*f,p=n.m_linearVelocity.y+n.m_angularVelocity*a,b=-(this.m_u1.x*l+this.m_u1.y*c)-this.m_ratio*(this.m_u2.x*h+this.m_u2.y*p),w=this.m_pulleyMass*-b,E=this.m_impulse,this.m_impulse=o.Max(0,this.m_impulse+w),w=this.m_impulse-E,d=-w*this.m_u1.x,v=-w*this.m_u1.y,m=-this.m_ratio*w*this.m_u2.x,g=-this.m_ratio*w*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*d,t.m_linearVelocity.y+=t.m_invMass*v,t.m_angularVelocity+=t.m_invI*(i*v-s*d),n.m_linearVelocity.x+=n.m_invMass*m,n.m_linearVelocity.y+=n.m_invMass*g,n.m_angularVelocity+=n.m_invI*(a*g-f*m)),this.m_limitState1==y.e_atUpperLimit&&(l=t.m_linearVelocity.x+ -t.m_angularVelocity*s,c=t.m_linearVelocity.y+t.m_angularVelocity*i,b=-(this.m_u1.x*l+this.m_u1.y*c),w=-this.m_limitMass1*b,E=this.m_limitImpulse1,this.m_limitImpulse1=o.Max(0,this.m_limitImpulse1+w),w=this.m_limitImpulse1-E,d=-w*this.m_u1.x,v=-w*this.m_u1.y,t.m_linearVelocity.x+=t.m_invMass*d,t.m_linearVelocity.y+=t.m_invMass*v,t.m_angularVelocity+=t.m_invI*(i*v-s*d)),this.m_limitState2==y.e_atUpperLimit&&(h=n.m_linearVelocity.x+ -n.m_angularVelocity*f,p=n.m_linearVelocity.y+n.m_angularVelocity*a,b=-(this.m_u2.x*h+this.m_u2.y*p),w=-this.m_limitMass2*b,E=this.m_limitImpulse2,this.m_limitImpulse2=o.Max(0,this.m_limitImpulse2+w),w=this.m_limitImpulse2-E,m=-w*this.m_u2.x,g=-w*this.m_u2.y,n.m_linearVelocity.x+=n.m_invMass*m,n.m_linearVelocity.y+=n.m_invMass*g,n.m_angularVelocity+=n.m_invI*(a*g-f*m))},k.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t=this.m_bodyA,n=this.m_bodyB,i,s=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,u=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,a=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,f=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,l=0,c=0,h=0,p=0,d=0,v=0,m=0,g=0,b=0,w=0,E=0,S=0,x=0,T=0,N=0,C=0;return this.m_state==y.e_atUpperLimit&&(i=t.m_xf.R,l=this.m_localAnchor1.x-t.m_sweep.localCenter.x,c=this.m_localAnchor1.y-t.m_sweep.localCenter.y,N=i.col1.x*l+i.col2.x*c,c=i.col1.y*l+i.col2.y*c,l=N,i=n.m_xf.R,h=this.m_localAnchor2.x-n.m_sweep.localCenter.x,p=this.m_localAnchor2.y-n.m_sweep.localCenter.y,N=i.col1.x*h+i.col2.x*p,p=i.col1.y*h+i.col2.y*p,h=N,d=t.m_sweep.c.x+l,v=t.m_sweep.c.y+c,m=n.m_sweep.c.x+h,g=n.m_sweep.c.y+p,this.m_u1.Set(d-s,v-u),this.m_u2.Set(m-a,g-f),b=this.m_u1.Length(),w=this.m_u2.Length(),b>r.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero(),w>r.b2_linearSlop?this.m_u2.Multiply(1/w):this.m_u2.SetZero(),E=this.m_constant-b-this.m_ratio*w,C=o.Max(C,-E),E=o.Clamp(E+r.b2_linearSlop,-r.b2_maxLinearCorrection,0),S=-this.m_pulleyMass*E,d=-S*this.m_u1.x,v=-S*this.m_u1.y,m=-this.m_ratio*S*this.m_u2.x,g=-this.m_ratio*S*this.m_u2.y,t.m_sweep.c.x+=t.m_invMass*d,t.m_sweep.c.y+=t.m_invMass*v,t.m_sweep.a+=t.m_invI*(l*v-c*d),n.m_sweep.c.x+=n.m_invMass*m,n.m_sweep.c.y+=n.m_invMass*g,n.m_sweep.a+=n.m_invI*(h*g-p*m),t.SynchronizeTransform(),n.SynchronizeTransform()),this.m_limitState1==y.e_atUpperLimit&&(i=t.m_xf.R,l=this.m_localAnchor1.x-t.m_sweep.localCenter.x,c=this.m_localAnchor1.y-t.m_sweep.localCenter.y,N=i.col1.x*l+i.col2.x*c,c=i.col1.y*l+i.col2.y*c,l=N,d=t.m_sweep.c.x+l,v=t.m_sweep.c.y+c,this.m_u1.Set(d-s,v-u),b=this.m_u1.Length(),b>r.b2_linearSlop?(this.m_u1.x*=1/b,this.m_u1.y*=1/b):this.m_u1.SetZero(),E=this.m_maxLength1-b,C=o.Max(C,-E),E=o.Clamp(E+r.b2_linearSlop,-r.b2_maxLinearCorrection,0),S=-this.m_limitMass1*E,d=-S*this.m_u1.x,v=-S*this.m_u1.y,t.m_sweep.c.x+=t.m_invMass*d,t.m_sweep.c.y+=t.m_invMass*v,t.m_sweep.a+=t.m_invI*(l*v-c*d),t.SynchronizeTransform()),this.m_limitState2==y.e_atUpperLimit&&(i=n.m_xf.R,h=this.m_localAnchor2.x-n.m_sweep.localCenter.x,p=this.m_localAnchor2.y-n.m_sweep.localCenter.y,N=i.col1.x*h+i.col2.x*p,p=i.col1.y*h+i.col2.y*p,h=N,m=n.m_sweep.c.x+h,g=n.m_sweep.c.y+p,this.m_u2.Set(m-a,g-f),w=this.m_u2.Length(),w>r.b2_linearSlop?(this.m_u2.x*=1/w,this.m_u2.y*=1/w):this.m_u2.SetZero(),E=this.m_maxLength2-w,C=o.Max(C,-E),E=o.Clamp(E+r.b2_linearSlop,-r.b2_maxLinearCorrection,0),S=-this.m_limitMass2*E,m=-S*this.m_u2.x,g=-S*this.m_u2.y,n.m_sweep.c.x+=n.m_invMass*m,n.m_sweep.c.y+=n.m_invMass*g,n.m_sweep.a+=n.m_invI*(h*g-p*m),n.SynchronizeTransform()),C<r.b2_linearSlop},e.postDefs.push(function(){e.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),e.inherit(L,e.Dynamics.Joints.b2JointDef),L.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype,L.b2PulleyJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new f,this.groundAnchorB=new f,this.localAnchorA=new f,this.localAnchorB=new f},L.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},L.prototype.Initialize=function(e,t,n,r,i,s,o){o===undefined&&(o=0),this.bodyA=e,this.bodyB=t,this.groundAnchorA.SetV(n),this.groundAnchorB.SetV(r),this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(s);var u=i.x-n.x,a=i.y-n.y;this.lengthA=Math.sqrt(u*u+a*a);var f=s.x-r.x,l=s.y-r.y;this.lengthB=Math.sqrt(f*f+l*l),this.ratio=o;var c=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=c-this.ratio*k.b2_minPulleyLength,this.maxLengthB=(c-k.b2_minPulleyLength)/this.ratio},e.inherit(A,e.Dynamics.Joints.b2Joint),A.prototype.__super=e.Dynamics.Joints.b2Joint.prototype,A.b2RevoluteJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new i,this.K1=new i,this.K2=new i,this.K3=new i,this.impulse3=new l,this.impulse2=new f,this.reduced=new f,this.m_localAnchor1=new f,this.m_localAnchor2=new f,this.m_impulse=new l,this.m_mass=new s},A.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},A.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},A.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new f(e*this.m_impulse.x,e*this.m_impulse.y)},A.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.z},A.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},A.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},A.prototype.IsLimitEnabled=function(){return this.m_enableLimit},A.prototype.EnableLimit=function(e){this.m_enableLimit=e},A.prototype.GetLowerLimit=function(){return this.m_lowerAngle},A.prototype.GetUpperLimit=function(){return this.m_upperAngle},A.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_lowerAngle=e,this.m_upperAngle=t},A.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},A.prototype.EnableMotor=function(e){this.m_enableMotor=e},A.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},A.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},A.prototype.SetMaxMotorTorque=function(e){e===undefined&&(e=0),this.m_maxMotorTorque=e},A.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},A.prototype.b2RevoluteJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=e.lowerAngle,this.m_upperAngle=e.upperAngle,this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=y.e_inactiveLimit},A.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,i,s=0;this.m_enableMotor||this.m_enableLimit,i=t.m_xf.R;var u=this.m_localAnchor1.x-t.m_sweep.localCenter.x,a=this.m_localAnchor1.y-t.m_sweep.localCenter.y;s=i.col1.x*u+i.col2.x*a,a=i.col1.y*u+i.col2.y*a,u=s,i=n.m_xf.R;var f=this.m_localAnchor2.x-n.m_sweep.localCenter.x,l=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=i.col1.x*f+i.col2.x*l,l=i.col1.y*f+i.col2.y*l,f=s;var c=t.m_invMass,h=n.m_invMass,p=t.m_invI,d=n.m_invI;this.m_mass.col1.x=c+h+a*a*p+l*l*d,this.m_mass.col2.x=-a*u*p-l*f*d,this.m_mass.col3.x=-a*p-l*d,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=c+h+u*u*p+f*f*d,this.m_mass.col3.y=u*p+f*d,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=p+d,this.m_motorMass=1/(p+d),this.m_enableMotor==0&&(this.m_motorImpulse=0);if(this.m_enableLimit){var v=n.m_sweep.a-t.m_sweep.a-this.m_referenceAngle;o.Abs(this.m_upperAngle-this.m_lowerAngle)<2*r.b2_angularSlop?this.m_limitState=y.e_equalLimits:v<=this.m_lowerAngle?(this.m_limitState!=y.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=y.e_atLowerLimit):v>=this.m_upperAngle?(this.m_limitState!=y.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=y.e_atUpperLimit):(this.m_limitState=y.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=y.e_inactiveLimit;if(e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var m=this.m_impulse.x,g=this.m_impulse.y;t.m_linearVelocity.x-=c*m,t.m_linearVelocity.y-=c*g,t.m_angularVelocity-=p*(u*g-a*m+this.m_motorImpulse+this.m_impulse.z),n.m_linearVelocity.x+=h*m,n.m_linearVelocity.y+=h*g,n.m_angularVelocity+=d*(f*g-l*m+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},A.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r,i=0,s=0,u=0,a=0,f=0,l=0,c=t.m_linearVelocity,h=t.m_angularVelocity,p=n.m_linearVelocity,d=n.m_angularVelocity,v=t.m_invMass,m=n.m_invMass,g=t.m_invI,b=n.m_invI;if(this.m_enableMotor&&this.m_limitState!=y.e_equalLimits){var w=d-h-this.m_motorSpeed,E=this.m_motorMass*-w,S=this.m_motorImpulse,x=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=o.Clamp(this.m_motorImpulse+E,-x,x),E=this.m_motorImpulse-S,h-=g*E,d+=b*E}if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){r=t.m_xf.R,u=this.m_localAnchor1.x-t.m_sweep.localCenter.x,a=this.m_localAnchor1.y-t.m_sweep.localCenter.y,i=r.col1.x*u+r.col2.x*a,a=r.col1.y*u+r.col2.y*a,u=i,r=n.m_xf.R,f=this.m_localAnchor2.x-n.m_sweep.localCenter.x,l=this.m_localAnchor2.y-n.m_sweep.localCenter.y,i=r.col1.x*f+r.col2.x*l,l=r.col1.y*f+r.col2.y*l,f=i;var T=p.x+ -d*l-c.x- -h*a,N=p.y+d*f-c.y-h*u,C=d-h;this.m_mass.Solve33(this.impulse3,-T,-N,-C),this.m_limitState==y.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==y.e_atLowerLimit?(s=this.m_impulse.z+this.impulse3.z,s<0&&(this.m_mass.Solve22(this.reduced,-T,-N),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==y.e_atUpperLimit&&(s=this.m_impulse.z+this.impulse3.z,s>0&&(this.m_mass.Solve22(this.reduced,-T,-N),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),c.x-=v*this.impulse3.x,c.y-=v*this.impulse3.y,h-=g*(u*this.impulse3.y-a*this.impulse3.x+this.impulse3.z),p.x+=m*this.impulse3.x,p.y+=m*this.impulse3.y,d+=b*(f*this.impulse3.y-l*this.impulse3.x+this.impulse3.z)}else{r=t.m_xf.R,u=this.m_localAnchor1.x-t.m_sweep.localCenter.x,a=this.m_localAnchor1.y-t.m_sweep.localCenter.y,i=r.col1.x*u+r.col2.x*a,a=r.col1.y*u+r.col2.y*a,u=i,r=n.m_xf.R,f=this.m_localAnchor2.x-n.m_sweep.localCenter.x,l=this.m_localAnchor2.y-n.m_sweep.localCenter.y,i=r.col1.x*f+r.col2.x*l,l=r.col1.y*f+r.col2.y*l,f=i;var k=p.x+ -d*l-c.x- -h*a,L=p.y+d*f-c.y-h*u;this.m_mass.Solve22(this.impulse2,-k,-L),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,c.x-=v*this.impulse2.x,c.y-=v*this.impulse2.y,h-=g*(u*this.impulse2.y-a*this.impulse2.x),p.x+=m*this.impulse2.x,p.y+=m*this.impulse2.y,d+=b*(f*this.impulse2.y-l*this.impulse2.x)}t.m_linearVelocity.SetV(c),t.m_angularVelocity=h,n.m_linearVelocity.SetV(p),n.m_angularVelocity=d},A.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t=0,n=0,i,s=this.m_bodyA,u=this.m_bodyB,a=0,f=0,l=0,c=0,h=0;if(this.m_enableLimit&&this.m_limitState!=y.e_inactiveLimit){var p=u.m_sweep.a-s.m_sweep.a-this.m_referenceAngle,d=0;this.m_limitState==y.e_equalLimits?(n=o.Clamp(p-this.m_lowerAngle,-r.b2_maxAngularCorrection,r.b2_maxAngularCorrection),d=-this.m_motorMass*n,a=o.Abs(n)):this.m_limitState==y.e_atLowerLimit?(n=p-this.m_lowerAngle,a=-n,n=o.Clamp(n+r.b2_angularSlop,-r.b2_maxAngularCorrection,0),d=-this.m_motorMass*n):this.m_limitState==y.e_atUpperLimit&&(n=p-this.m_upperAngle,a=n,n=o.Clamp(n-r.b2_angularSlop,0,r.b2_maxAngularCorrection),d=-this.m_motorMass*n),s.m_sweep.a-=s.m_invI*d,u.m_sweep.a+=u.m_invI*d,s.SynchronizeTransform(),u.SynchronizeTransform()}i=s.m_xf.R;var v=this.m_localAnchor1.x-s.m_sweep.localCenter.x,m=this.m_localAnchor1.y-s.m_sweep.localCenter.y;l=i.col1.x*v+i.col2.x*m,m=i.col1.y*v+i.col2.y*m,v=l,i=u.m_xf.R;var g=this.m_localAnchor2.x-u.m_sweep.localCenter.x,b=this.m_localAnchor2.y-u.m_sweep.localCenter.y;l=i.col1.x*g+i.col2.x*b,b=i.col1.y*g+i.col2.y*b,g=l;var w=u.m_sweep.c.x+g-s.m_sweep.c.x-v,E=u.m_sweep.c.y+b-s.m_sweep.c.y-m,S=w*w+E*E,x=Math.sqrt(S);f=x;var T=s.m_invMass,N=u.m_invMass,C=s.m_invI,k=u.m_invI,L=10*r.b2_linearSlop;if(S>L*L){var O=w/x,M=E/x,_=T+N,D=1/_;c=D*-w,h=D*-E;var P=.5;s.m_sweep.c.x-=P*T*c,s.m_sweep.c.y-=P*T*h,u.m_sweep.c.x+=P*N*c,u.m_sweep.c.y+=P*N*h,w=u.m_sweep.c.x+g-s.m_sweep.c.x-v,E=u.m_sweep.c.y+b-s.m_sweep.c.y-m}return this.K1.col1.x=T+N,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=T+N,this.K2.col1.x=C*m*m,this.K2.col2.x=-C*v*m,this.K2.col1.y=-C*v*m,this.K2.col2.y=C*v*v,this.K3.col1.x=k*b*b,this.K3.col2.x=-k*g*b,this.K3.col1.y=-k*g*b,this.K3.col2.y=k*g*g,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(A.tImpulse,-w,-E),c=A.tImpulse.x,h=A.tImpulse.y,s.m_sweep.c.x-=s.m_invMass*c,s.m_sweep.c.y-=s.m_invMass*h,s.m_sweep.a-=s.m_invI*(v*h-m*c),u.m_sweep.c.x+=u.m_invMass*c,u.m_sweep.c.y+=u.m_invMass*h,u.m_sweep.a+=u.m_invI*(g*h-b*c),s.SynchronizeTransform(),u.SynchronizeTransform(),f<=r.b2_linearSlop&&a<=r.b2_angularSlop},e.postDefs.push(function(){e.Dynamics.Joints.b2RevoluteJoint.tImpulse=new f}),e.inherit(O,e.Dynamics.Joints.b2JointDef),O.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype,O.b2RevoluteJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new f,this.localAnchorB=new f},O.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},O.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},e.inherit(M,e.Dynamics.Joints.b2Joint),M.prototype.__super=e.Dynamics.Joints.b2Joint.prototype,M.b2WeldJoint=function(){e.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new f,this.m_localAnchorB=new f,this.m_impulse=new l,this.m_mass=new s},M.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},M.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},M.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new f(e*this.m_impulse.x,e*this.m_impulse.y)},M.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.z},M.prototype.b2WeldJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new s},M.prototype.InitVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x,o=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n,t=i.m_xf.R;var u=this.m_localAnchorB.x-i.m_sweep.localCenter.x,a=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n;var f=r.m_invMass,l=i.m_invMass,c=r.m_invI,h=i.m_invI;this.m_mass.col1.x=f+l+o*o*c+a*a*h,this.m_mass.col2.x=-o*s*c-a*u*h,this.m_mass.col3.x=-o*c-a*h,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=f+l+s*s*c+u*u*h,this.m_mass.col3.y=s*c+u*h,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=c+h,e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_impulse.z*=e.dtRatio,r.m_linearVelocity.x-=f*this.m_impulse.x,r.m_linearVelocity.y-=f*this.m_impulse.y,r.m_angularVelocity-=c*(s*this.m_impulse.y-o*this.m_impulse.x+this.m_impulse.z),i.m_linearVelocity.x+=l*this.m_impulse.x,i.m_linearVelocity.y+=l*this.m_impulse.y,i.m_angularVelocity+=h*(u*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},M.prototype.SolveVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,i=this.m_bodyB,s=r.m_linearVelocity,o=r.m_angularVelocity,u=i.m_linearVelocity,a=i.m_angularVelocity,f=r.m_invMass,c=i.m_invMass,h=r.m_invI,p=i.m_invI;t=r.m_xf.R;var d=this.m_localAnchorA.x-r.m_sweep.localCenter.x,v=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*d+t.col2.x*v,v=t.col1.y*d+t.col2.y*v,d=n,t=i.m_xf.R;var m=this.m_localAnchorB.x-i.m_sweep.localCenter.x,g=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*m+t.col2.x*g,g=t.col1.y*m+t.col2.y*g,m=n;var y=u.x-a*g-s.x+o*v,b=u.y+a*m-s.y-o*d,w=a-o,E=new l;this.m_mass.Solve33(E,-y,-b,-w),this.m_impulse.Add(E),s.x-=f*E.x,s.y-=f*E.y,o-=h*(d*E.y-v*E.x+E.z),u.x+=c*E.x,u.y+=c*E.y,a+=p*(m*E.y-g*E.x+E.z),r.m_angularVelocity=o,i.m_angularVelocity=a},M.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t,n=0,i=this.m_bodyA,s=this.m_bodyB;t=i.m_xf.R;var u=this.m_localAnchorA.x-i.m_sweep.localCenter.x,a=this.m_localAnchorA.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n,t=s.m_xf.R;var f=this.m_localAnchorB.x-s.m_sweep.localCenter.x,c=this.m_localAnchorB.y-s.m_sweep.localCenter.y;n=t.col1.x*f+t.col2.x*c,c=t.col1.y*f+t.col2.y*c,f=n;var h=i.m_invMass,p=s.m_invMass,d=i.m_invI,v=s.m_invI,m=s.m_sweep.c.x+f-i.m_sweep.c.x-u,g=s.m_sweep.c.y+c-i.m_sweep.c.y-a,y=s.m_sweep.a-i.m_sweep.a-this.m_referenceAngle,b=10*r.b2_linearSlop,w=Math.sqrt(m*m+g*g),E=o.Abs(y);w>b&&(d*=1,v*=1),this.m_mass.col1.x=h+p+a*a*d+c*c*v,this.m_mass.col2.x=-a*u*d-c*f*v,this.m_mass.col3.x=-a*d-c*v,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=h+p+u*u*d+f*f*v,this.m_mass.col3.y=u*d+f*v,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=d+v;var S=new l;return this.m_mass.Solve33(S,-m,-g,-y),i.m_sweep.c.x-=h*S.x,i.m_sweep.c.y-=h*S.y,i.m_sweep.a-=d*(u*S.y-a*S.x+S.z),s.m_sweep.c.x+=p*S.x,s.m_sweep.c.y+=p*S.y,s.m_sweep.a+=v*(f*S.y-c*S.x+S.z),i.SynchronizeTransform(),s.SynchronizeTransform(),w<=r.b2_linearSlop&&E<=r.b2_angularSlop},e.inherit(_,e.Dynamics.Joints.b2JointDef),_.prototype.__super=e.Dynamics.Joints.b2JointDef.prototype,_.b2WeldJointDef=function(){e.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new f,this.localAnchorB=new f},_.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=y.e_weldJoint,this.referenceAngle=0},_.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var t=e.Dynamics.b2DebugDraw;t.b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var e=this;this.m_sprite={graphics:{clear:function(){e.m_ctx.clearRect(0,0,e.m_ctx.canvas.width,e.m_ctx.canvas.height)}}}},t.prototype._color=function(e,t){return"rgba("+((e&16711680)>>16)+","+((e&65280)>>8)+","+(e&255)+","+t+")"},t.prototype.b2DebugDraw=function(){this.m_drawFlags=0},t.prototype.SetFlags=function(e){e===undefined&&(e=0),this.m_drawFlags=e},t.prototype.GetFlags=function(){return this.m_drawFlags},t.prototype.AppendFlags=function(e){e===undefined&&(e=0),this.m_drawFlags|=e},t.prototype.ClearFlags=function(e){e===undefined&&(e=0),this.m_drawFlags&=~e},t.prototype.SetSprite=function(e){this.m_ctx=e},t.prototype.GetSprite=function(){return this.m_ctx},t.prototype.SetDrawScale=function(e){e===undefined&&(e=0),this.m_drawScale=e},t.prototype.GetDrawScale=function(){return this.m_drawScale},t.prototype.SetLineThickness=function(e){e===undefined&&(e=0),this.m_lineThickness=e,this.m_ctx.strokeWidth=e},t.prototype.GetLineThickness=function(){return this.m_lineThickness},t.prototype.SetAlpha=function(e){e===undefined&&(e=0),this.m_alpha=e},t.prototype.GetAlpha=function(){return this.m_alpha},t.prototype.SetFillAlpha=function(e){e===undefined&&(e=0),this.m_fillAlpha=e},t.prototype.GetFillAlpha=function(){return this.m_fillAlpha},t.prototype.SetXFormScale=function(e){e===undefined&&(e=0),this.m_xformScale=e},t.prototype.GetXFormScale=function(){return this.m_xformScale},t.prototype.DrawPolygon=function(e,t,n){if(!t)return;var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.moveTo(e[0].x*i,e[0].y*i);for(var s=1;s<t;s++)r.lineTo(e[s].x*i,e[s].y*i);r.lineTo(e[0].x*i,e[0].y*i),r.closePath(),r.stroke()},t.prototype.DrawSolidPolygon=function(e,t,n){if(!t)return;var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.fillStyle=this._color(n.color,this.m_fillAlpha),r.moveTo(e[0].x*i,e[0].y*i);for(var s=1;s<t;s++)r.lineTo(e[s].x*i,e[s].y*i);r.lineTo(e[0].x*i,e[0].y*i),r.closePath(),r.fill(),r.stroke()},t.prototype.DrawCircle=function(e,t,n){if(!t)return;var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.arc(e.x*i,e.y*i,t*i,0,Math.PI*2,!0),r.closePath(),r.stroke()},t.prototype.DrawSolidCircle=function(e,t,n,r){if(!t)return;var i=this.m_ctx,s=this.m_drawScale,o=e.x*s,u=e.y*s;i.moveTo(0,0),i.beginPath(),i.strokeStyle=this._color(r.color,this.m_alpha),i.fillStyle=this._color(r.color,this.m_fillAlpha),i.arc(o,u,t*s,0,Math.PI*2,!0),i.moveTo(o,u),i.lineTo((e.x+n.x*t)*s,(e.y+n.y*t)*s),i.closePath(),i.fill(),i.stroke()},t.prototype.DrawSegment=function(e,t,n){var r=this.m_ctx,i=this.m_drawScale;r.strokeStyle=this._color(n.color,this.m_alpha),r.beginPath(),r.moveTo(e.x*i,e.y*i),r.lineTo(t.x*i,t.y*i),r.closePath(),r.stroke()},t.prototype.DrawTransform=function(e){var t=this.m_ctx,n=this.m_drawScale;t.beginPath(),t.strokeStyle=this._color(16711680,this.m_alpha),t.moveTo(e.position.x*n,e.position.y*n),t.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*n,(e.position.y+this.m_xformScale*e.R.col1.y)*n),t.strokeStyle=this._color(65280,this.m_alpha),t.moveTo(e.position.x*n,e.position.y*n),t.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*n,(e.position.y+this.m_xformScale*e.R.col2.y)*n),t.closePath(),t.stroke()}}();var r;for(r=0;r<e.postDefs.length;++r)e.postDefs[r]();return delete e.postDefs,e}),define("box2d",["crafty","box2dweb"],function(e,t){var n=t.Common.Math.b2Vec2,r=t.Dynamics.b2BodyDef,s=t.Dynamics.b2Body,o=t.Dynamics.b2FixtureDef,u=t.Dynamics.b2Fixture,a=t.Dynamics.b2World,f=t.Collision.Shapes.b2MassData,l=t.Collision.Shapes.b2PolygonShape,c=t.Collision.Shapes.b2CircleShape,h=t.Dynamics.b2DebugDraw,p=t.Dynamics.Joints.b2MouseJointDef,d=t.Dynamics.Joints.b2PrismaticJointDef,v=t.Dynamics.b2ContactListener,m=t.Dynamics.b2FilterData;return e.c("Box2D",{body:null,fixtures:null,init:function(){this.requires("2D"),e.box2D.world||e.box2D.init(0,10,55,!0)},box2d:function(t){var n=e.box2D.world,i=e.box2D.PTM_RATIO,o,u=0;this.fixtures=[];var a=new r;return t.bodyType==="dynamic"?a.type=s.b2_dynamicBody:t.bodyType==="static"?a.type=s.b2_staticBody:a.type=s.b2_kinematicBody,t.rotation!==undefined&&(a.fixedRotation=!t.rotation),a.position.Set(this._x/i,this._y/i),a.userData=this,this.body=n.CreateBody(a),this.addFixture(t),this},addFixture:function(t){var r=e.box2D.PTM_RATIO;if(!t.fixDef){fixDef=new o,fixDef.density=isNaN(t.density)?1:t.density,fixDef.friction=isNaN(t.friction)?.5:t.friction,fixDef.restitution=isNaN(t.restitution)?.2:t.restitution,fixDef.shape=new l,fixDef.filter=new m,fixDef.filter.categoryBits=isNaN(t.categoryBits)?1:t.categoryBits,fixDef.filter.maskBits=isNaN(t.maskBits)?65535:t.maskBits,fixDef.filter.groupIndex=isNaN(t.groupIndex)?0:t.groupIndex;if(!t.shape||typeof t.shape=="string")t.shape==="circle"?(fixDef.shape=new c(this._w/r/2),fixDef.shape.SetLocalPosition(new n(this._w/r/2,this._h/r/2))):(vertexCount=2,fixDef.shape.SetAsOrientedBox(this._w/r/2,this._h/r/2,new n(this._w/r/2,this._h/r/2)));else{vertexCount=t.shape.length;var i=[];for(var s=0;s<vertexCount;s++){var u=t.shape[s];i.push(new n(u[0]/r,u[1]/r))}fixDef.shape.SetAsArray(i,vertexCount)}return this.fixtures.push(this.body.CreateFixture(fixDef)),this}fixDef=obj.fixDef},contact:function(t){var n=[],r=e(t);for(entity in r)if(!isNaN(entity)){var s=e(r[entity]);if(!s.__c.Box2D)return!1;for(_contact in e.box2D.contacts){var o=e.box2D.contacts[_contact];for(i in this.fixtures){var u=this.fixtures[i];for(j in s.fixtures){var a=s.fixtures[j];(o.fixtureA===u&&o.fixtureB===a||o.fixtureA===a&&o.fixtureB===u)&&n.push({obj:s,contact:o})}}}}return n.length?n:!1},onContact:function(e,t){return this.bind("EnterFrame",function(){var n=this.contact(e);n&&t.call(this,n)}),this}}),e.extend({box2D:{ShowBox2DDebug:!1,contacts:null,world:null,PTM_RATIO:null,init:function(t,r,i,s){var o=new a(new n(t,r),s),u=i,f=[],l=new v;l.BeginContact=function(e){var t={fixtureA:e.GetFixtureA(),fixtureB:e.GetFixtureB()};for(e in f)if(f[e].fixtureA==t.fixtureA&&f[e].fixtureB==t.fixtureB)return;f.push(t)},l.EndContact=function(e){var t={fixtureA:e.GetFixtureA(),fixtureB:e.GetFixtureB()};for(e in f)if(f[e].fixtureA==t.fixtureA&&f[e].fixtureB==t.fixtureB){f.splice(e,1);return}},o.SetContactListener(l),e.bind("EnterFrame",function(){o.Step(1/30,8,3);for(var t=o.GetBodyList();t;t=t.GetNext())if(t.GetUserData()){var n=t.GetUserData();n.attr({x:t.GetPosition().x*u,y:t.GetPosition().y*u}),n.rotation=e.math.radToDeg(t.GetAngle())}e.box2D.ShowBox2DDebug&&o.DrawDebugData(),o.ClearForces()}),e.box2D.world=o,e.box2D.PTM_RATIO=u,e.box2D.contacts=f},showDebugInfo:function(){var t=e.box2D.world,n=e.box2D.PTM_RATIO;if(e.support.canvas){var r=document.createElement("canvas");r.id="Box2DCanvasDebug",r.width=e.viewport.width,r.height=e.viewport.height,r.style.position="absolute",r.style.left="0px",r.style.top="0px",e.stage.elem.appendChild(r);var i=new h;i.SetSprite(r.getContext("2d")),i.SetDrawScale(n),i.SetFillAlpha(.7),i.SetLineThickness(1),i.SetFlags(h.e_shapeBit|h.e_jointBit),t.SetDebugDraw(i),e.box2D.ShowBox2DDebug=!0}else e.box2D.ShowBox2DDebug=!1}}}),{Vec2:n,BodyDef:r,Body:s,FixtureDef:o,Fixture:u,World:a,MassData:f,PolygonShape:l,CircleShape:c,DebugDraw:h,MouseJointDef:p,PrismaticJointDef:d,ContactListener:v,FilterData:m}}),define("clone",["crafty","config","box2d"],function(e,t){e.c("Clone",{init:function(){var e;this.addComponent("2D, Canvas, Color, Box2D"),e=t.pixelPerMeter,this.color("#000"),this.attr({x:400,y:500,w:32,h:32}),this.box2d({bodyType:"dynamic",density:3,friction:1,rotation:!1})}})}),define("box2dtwoway",["crafty","box2d","config","clone"],function(e,t,n){var r,i,s,o,u;e.c("b2Twoway",{init:function(){var r,i,s,o;o=n.pixelPerMeter,this.requires("Keyboard, Box2D"),this._currentClone=0,this._clones=[],this._hasDoubleJumped=!1,this._impluse=new t.Vec2(0,0),this._inAir=!1,this._jump=0,this._speed=0,s=new t.Vec2(0,500/o);for(r=0;r<2;r++)i=this._clones.length,this._clones.push(e.e("Clone")),this._clones[i].body.SetPosition(s),this._clones[i].visible=!1},twoway:function(e,t){var n,r;return this._speed=e,this._jump=-t,n=this.w,r=this.h,this.addFixture({bodyType:"dynamic",density:0,friction:0,shape:[[1,r],[n-2,r]]}),this.fixtures[1].SetSensor(!0),this.bind("EnterFrame",function(){this._impluse.x=o.call(this),this._impluse.y=i.call(this),(this._impluse.x!==0||this._impluse.y!==0)&&this.body.ApplyImpulse(this._impluse,this.body.GetWorldCenter())}),this}}),r=function(e){var t,n,r,i;i=e.length,r=!1;for(n=0;n<i;n++)t=e[n],r|=t.contact.fixtureA.IsSensor();return!!r},i=function(){var e,t,n,i,o,a;return t=this._currentClone,e=this._clones[t],n=0,i=0,o=!1,a=this.body.GetLinearVelocity(),this.isDown("W")&&(o=!0,i=this._jump),r(this.contact("Box2D"))&&(this._inAir=!1,this._hasDoubleJumped=!1),o&&!this._inAir?(this._inAir=!0,n=i):o&&!this._hasDoubleJumped&&a.y>0&&(this._hasDoubleJumped=!0,n=i*2,s(e,this.x,this.y),this._currentClone=u(t)),n},u=function(e){return e!==1?e+1:e-1},o=function(){var e,t,n,r;return e=!1,n=0,r=this.body.GetLinearVelocity(),this.isDown("D")?(e=!0,n=this._inAir&&r.x<0?Math.min(r.x+.4,this._speed/5):Math.min(r.x+.5,this._speed)):this.isDown("A")?(e=!0,n=this._inAir&&r.x>0?Math.max(r.x-.4,-this._speed/5):Math.max(r.x-.5,-this._speed)):this._inAir&&(n=r.x*.98),t=this.body.GetMass()*(n-r.x),t},s=function(e,r,i){var s;e.visible=!1,s=n.pixelPerMeter,r/=s,i/=s,e.body.SetPosition(new t.Vec2(r,i+20/s)),e.visible=!0}}),define("camera",["crafty"],function(e){e.c("Camera",{init:function(){e.viewport.follow(this,0,0)}})}),define("platform",["crafty","box2d"],function(e){e.c("Platform",{init:function(){this.addComponent("2D, Canvas, Color, Box2D")},platform:function(e,t){return t.bodyType||(t.bodyType="solid"),this.attr(e),this.color(t.color),this.box2d({bodyType:t.bodyType}),this}})}),define("winplatform",["crafty","platform"],function(e){e.c("WinPlatform",{init:function(){this.addComponent("Platform")}})}),define("mainclone",["crafty","box2d","config","box2dtwoway","camera","clone","entry","winplatform"],function(e,t,n){e.c("MainClone",{init:function(){this.addComponent("Clone, Camera, b2Twoway"),this.twoway(10,10),this.text=e.e("2D, Canvas, Text"),this.bind("Change",function(e){var r,i,s,o,u;o=n.pixelPerMeter;if(e._y>n.canvas.height){u=new t.Vec2(400/o,500/o),this.body.SetPosition(u),s=this._clones.length,u.x=0,u.y=500/o;for(i=0;i<s;i++)r=this._clones[i],r.visible=!1,r.body.SetPosition(u)}}),this.onContact("WinPlatform",function(){this.text.attr({x:this.x+16,y:this.y-16}).textFont({family:"Arial",weight:"bold",size:"20px"}).text("Win!")})}})}),define("entry",["crafty","box2d","mainclone","platform"],function(e){e.scene("entry",function(){var t,n,r,i;e.e("Platform").platform({x:0,y:624,w:1600,h:16},{color:"#ffff00"}),e.e("Platform").platform({x:2050,y:624,w:500,h:16},{color:"#ffff00"}),e.e("Platform").platform({x:750,y:570,w:50,h:16},{color:"#ffff00"}),e.e("Platform").platform({x:1050,y:465,w:700,h:175},{color:"#ffff00"}),e.e("Platform").platform({x:2050,y:465,w:150,h:16},{color:"#ffff00"}),e.e("Platform").platform({x:0,y:550,w:16,h:75},{color:"#ffff00"}),r=2500,i=590,n=50;for(t=0;t<5;t++)e.e("Platform").platform({x:r,y:i,w:50,h:n},{color:"#ffff00"}),r+=50,i-=25,n+=25;e.e("Platform").platform({x:r+200,y:400,w:150,h:16},{color:"#ffff00"}),r+=350;for(t=0;t<4;t++)e.e("Platform").platform({x:r,y:550,w:50,h:16},{color:"#ffff00"}),r+=150;e.e("WinPlatform").platform({x:r,y:550,w:50,h:16},{color:"#ff0000"}),e.e("MainClone")})}),require.config({paths:{crafty:"lib/crafty",box2dweb:"lib/box2dweb",box2d:"components/box2d",box2dtwoway:"components/box2dTwoway",camera:"components/camera",clone:"components/clone",mainclone:"components/mainclone",platform:"components/platform",winplatform:"components/winplatform",entry:"scenes/entry",config:"config"}}),require(["crafty","config","entry"],function(e,t){e.init(t.canvas.width,t.canvas.height),e.viewport.clampToEntities=!1,e.canvas.init(),e.box2D.init(0,10,t.pixelPerMeter,!0),e.scene("entry")}),define("main",function(){});